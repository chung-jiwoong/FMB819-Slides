---
title: "FMB819: Rì„ ì´ìš©í•œ ë°ì´í„°ë¶„ì„"
subtitle: "<span style='font-size:1.5em; color:#a01616;'>Difference-in-Differences</span>"
# date: "`r Sys.Date()`"
format:
  revealjs:
    slide-number: true
    # smaller: true
    scrollable: true
    chalkboard: true
    transition: fade
    transition-speed: fast
    #incremental: true
    #lib_dir: libs
    css: [default, "../css/kubs.css", "../css/kubs-fonts.css"]
    #nature:
      # beforeInit: ["../js/ru_xaringan.js"]
      #highlightStyle: github
      #highlightLines: true
      #countIncrementalSlides: false
    #  ratio: "16:9"
    # includes:
    #   in_header: "../libs/partials/header.html"
revealjs-plugins:
  - revealjs-text-resizer
---


```{r setup, include=FALSE,warning=FALSE,message=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  dev = "svg",
  cache = TRUE,
  fig.align = "center"
  #fig.width = 11,
  #fig.height = 5
)

# library(emo)
library(tidyverse)
library(ggplot2)
library(kableExtra)
library(zoo)
library(scales)
library(grid)
library(pBrackets)
library(formattable)


library(countdown)

# countdown style
countdown(
  color_border              = "#d90502",
  color_text                = "black",
  color_running_background  = "#d90502",
  color_running_text        = "white",
  color_finished_background = "white",
  color_finished_text       = "#d90502",
  color_finished_border     = "#d90502"
)

  # set seed
set.seed(1234)
```




------------------------------------------------------------------------

## Today's Agenda

***ì´ì¤‘ì°¨ë¶„ë²• (Differences-in-Differences)***

- ì‹œê°„ì— ë”°ë¥¸ ì •ì±… ë³€í™”ê°€ ëª¨ë“  ì‚¬ëŒì—ê²Œ ë™ì¼í•˜ê²Œ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•ŠëŠ” ì ì„ í™œìš©í•¨.
- ì ì ˆí•œ ëŒ€ì¡°êµ°(control group)ì„ ì°¾ì•„ì•¼ í•˜ê±°ë‚˜ êµ¬ì„±í•´ì•¼ í•¨.
- *í•µì‹¬ ê°€ì •:* í‰í–‰ ì¶”ì„¸ ê°€ì • (Parallel Trends Assumption)
- *ì‹¤ì¦ì  ì ìš©:* ***ìµœì €ì„ê¸ˆ***ì´ ***ê³ ìš©***ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ë¶„ì„

---

## Evaluation methods

- ë‹¤ì¤‘ íšŒê·€ ë¶„ì„ì€ ì¢…ì¢… ***ê´€ì°°ë˜ì§€ ì•Šì€ ìš”ì¸ì— ì˜í•œ ì„ íƒ(selection on unobservables)*** ë•Œë¬¸ì— ì¸ê³¼ì  ì¶”ì •ì¹˜ë¥¼ ì œê³µí•˜ì§€ ëª»í•¨.

- RCT(ë¬´ì‘ìœ„ ëŒ€ì¡° ì‹¤í—˜)ëŠ” ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” í•œ ê°€ì§€ ë°©ë²•ì´ì§€ë§Œ, í˜„ì‹¤ì ìœ¼ë¡œ ì‹œí–‰ì´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°ê°€ ë§ìŒ.

- ê²½ì œí•™ì—ì„œ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ë„¤ ê°€ì§€ ì£¼ìš” ì¸ê³¼ì  í‰ê°€ ë°©ë²•:
  - ***ë„êµ¬ë³€ìˆ˜ë²• (Instrumental Variables, IV)***,
  - ***ì„±í–¥ ì ìˆ˜ ë§¤ì¹­ (Propensity-Score Matching)***,
  - ***ì´ì¤‘ì°¨ë¶„ë²• (Differences-in-Differences, DiD)***, ë°
  - ***íšŒê·€ ë¶ˆì—°ì† ì„¤ê³„ (Regression Discontinuity Designs, RDD)***.

- ì´ëŸ¬í•œ ë°©ë²•ë“¤ì€ **ì²˜ì¹˜(treatment)**ì™€ **ê²°ê³¼(outcome)** ê°„ì˜ __ì¸ê³¼ ê´€ê³„__ë¥¼ ì‹ë³„í•˜ëŠ” ë° ì‚¬ìš©ë¨.

- ì´ë²ˆ ê°•ì˜ì—ì„œëŠ” ë„ë¦¬ ì‚¬ìš©ë˜ë©° ì—„ê²©í•œ í”„ë¡œê·¸ë¨ í‰ê°€ ë°©ë²•ì¸ __ì´ì¤‘ì°¨ë¶„ë²•(Differences-in-Differences)__ì„ ë‹¤ë£° ê²ƒì„.


---


## Differences-in-Differences (DiD)

***DiDì˜ ìš”êµ¬ì‚¬í•­***

- **ë‘ ê°œì˜ ì‹œì :** ì²˜ì¹˜ ì „ê³¼ ì²˜ì¹˜ í›„.

- **ë‘ ê°œì˜ ê·¸ë£¹:**
  - ***ëŒ€ì¡°êµ°(Control group):*** ì²˜ì¹˜ë¥¼ ì „í˜€ ë°›ì§€ ì•ŠëŠ” ì§‘ë‹¨.
  - ***ì²˜ì¹˜êµ°(Treatment group):*** ì´ˆê¸°ì—ëŠ” ì²˜ì¹˜ë¥¼ ë°›ì§€ ì•Šë‹¤ê°€ ì´í›„ ì™„ì „íˆ ì²˜ì¹˜ë¥¼ ë°›ëŠ” ì§‘ë‹¨.

- íŠ¹ì • ê°€ì •í•˜ì—ì„œ, ëŒ€ì¡°êµ°ì„ ì²˜ì¹˜êµ°ì˜ ë°˜ì‚¬ì‹¤ì (counterfactual) ë¹„êµ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.

---


## ì˜ˆì œ: ìµœì €ì„ê¸ˆê³¼ ê³ ìš©

- ìµœì €ì„ê¸ˆ ì¸ìƒì´ (ì‹¤ì—…ì„ í¬í•¨í•œ) ê³ ìš©ì— ë¯¸ì¹˜ëŠ” __ì¸ê³¼ì __ ì˜í–¥ì„ í‰ê°€í•˜ê³ ì í•œë‹¤ê³  ê°€ì •í•˜ì.

- í•˜ì§€ë§Œ ì´ëŠ” ë‹¨ìˆœí•˜ì§€ ì•ŠìŒ. ì ì ˆí•œ ëŒ€ì¡°êµ°ì€ ë¬´ì—‡ì´ì–´ì•¼ í• ê¹Œ?

- ë…¸ë™ê²½ì œí•™ì ë°ì´ë¹„ë“œ ì¹´ë“œ(David Card)ì™€ ì•¨ëŸ° í¬ë£¨ê±°(Alan Krueger)ì˜ 1994ë…„ ëŒ€í‘œ ë…¼ë¬¸ [(ë§í¬)](http://davidcard.berkeley.edu/papers/njmin-aer.pdf)

  - ë…¼ë¬¸ ì œëª©: "ìµœì €ì„ê¸ˆê³¼ ê³ ìš©: ë‰´ì €ì§€ì™€ íœì‹¤ë² ì´ë‹ˆì•„ íŒ¨ìŠ¤íŠ¸í‘¸ë“œ ì‚°ì—… ì‚¬ë¡€ ì—°êµ¬"

- ì´ ì—°êµ¬ëŠ” ìµœì €ì„ê¸ˆ ì¸ìƒì´ íŒ¨ìŠ¤íŠ¸í‘¸ë“œ ì‚°ì—…ì˜ ê³ ìš©ë¥ ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì¶”ì •í•¨. ì™œ í•˜í•„ ì´ ì‚°ì—…ì„ ì„ íƒí–ˆì„ê¹Œ?

---


## ì œë„ì  ë°°ê²½

- ë¯¸êµ­ì—ëŠ” ì—°ë°© ìµœì €ì„ê¸ˆì´ ìˆì§€ë§Œ, ê° ì£¼ëŠ” ì´ë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•  ìˆ˜ ìˆìŒ.

- **1992ë…„ 4ì›” 1ì¼:** ë‰´ì €ì§€ì˜ ìµœì €ì„ê¸ˆì´ ì‹œê°„ë‹¹ $4.25ì—ì„œ $5.05ë¡œ ì¸ìƒë¨.

- ë°˜ë©´, ì¸ì ‘í•œ íœì‹¤ë² ì´ë‹ˆì•„ëŠ” ìµœì €ì„ê¸ˆì„ ë³€ê²½í•˜ì§€ ì•ŠìŒ.

:::: columns

::: {.column width="50%"}

```{r, echo=FALSE, out.width="600px"}
knitr::include_graphics("../img/photos/nj_penn_map.png")
```

:::

::: {.column width="50%"}

<br>
<br>
íœì‹¤ë² ì´ë‹ˆì•„ì™€ ë‰´ì €ì§€ëŠ” ***ë§¤ìš° ìœ ì‚¬í•¨***: ì œë„, ìƒí™œìŠµê´€, ì†Œë¹„ì, ì†Œë“ ìˆ˜ì¤€, ê¸°í›„ ë“± ë§ì€ ë©´ì—ì„œ ë¹„ìŠ·í•¨.

:::

::::

---

##  Card and Krueger (1994): ë°©ë²•ë¡ 

- ë‰´ì €ì§€(NJ)ì™€ ë™ë¶€ íœì‹¤ë² ì´ë‹ˆì•„ì˜ íŒ¨ìŠ¤íŠ¸í‘¸ë“œì  410ê³³ì„ ì¡°ì‚¬í•¨.

- **ì¡°ì‚¬ ì‹œì :**
  - ë‰´ì €ì§€ ìµœì €ì„ê¸ˆ ì¸ìƒ ì „ ì¡°ì‚¬: 1992ë…„ 2~3ì›”
  - ë‰´ì €ì§€ ìµœì €ì„ê¸ˆ ì¸ìƒ í›„ ì¡°ì‚¬: 1992ë…„ 11~12ì›”

- ì—°êµ¬ìë“¤ì€ ì–´ë–¤ ë¹„êµë¥¼ ìˆ˜í–‰í–ˆì„ê¹Œ?

:::: columns

::: {.column width="50%"}

ì¢€ ë” ìì„¸íˆ ë°ì´í„°ë¥¼ ì‚´í´ë³´ì

```{r, echo=FALSE, eval=TRUE, results="hide"}
# íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° ë°ì´í„° ë¡œë“œ
remotes::install_github("b-rodrigues/diffindiff")
library(diffindiff)
ck1994 <- njmin
```

```{r, echo=TRUE, eval=FALSE}
# íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° ë°ì´í„° ë¡œë“œ
remotes::install_github("b-rodrigues/diffindiff")
library(diffindiff)
ck1994 <- njmin
```

:::

::: {.column width="50%"}

```{r}
ck1994 %>%
  select(sheet, chain, state, observation, empft, emppt) %>%
  head()
```

:::

::::

---


## Task 1 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::


1. ë°ì´í„°ì…‹ì„ ì‚´í´ë³´ê³  ë³€ìˆ˜ ëª©ë¡ì„ í™•ì¸í•˜ë¼. ë³€ìˆ˜ ì •ì˜ëŠ” `?njmin`ì„ ì‚¬ìš©í•˜ì—¬ í™•ì¸í•˜ë¼.
```{r}
?njmin
```

1. `state` ë° ì„¤ë¬¸ì¡°ì‚¬ ì‹œì (`observation`)ë³„ë¡œ ë§¤ì¥ì˜ ê°œìˆ˜ë¥¼ í‘œë¡œ ì •ë¦¬í•˜ë¼. í•´ë‹¹ ê²°ê³¼ê°€ [ë…¼ë¬¸](http://davidcard.berkeley.edu/papers/njmin-aer.pdf)ì˜ *í‘œ 1*ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ë¼.

1. ì¹´ë“œì™€ í¬ë£¨ê±°(1994)ì˜ ë°©ì‹ì— ë”°ë¼, ì •ê·œì§ ìƒë‹¹(full-time equivalent, FTE) ê³ ìš© ë³€ìˆ˜ë¥¼ ìƒì„±í•˜ë¼. `empfte` ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ê³  ë‹¤ìŒ ì‹ì„ ì‚¬ìš©í•˜ë¼:
   ```
   empfte = empft + 0.5 * emppt + nmgrs
   ```
   ì—¬ê¸°ì„œ `empft`ëŠ” ì •ê·œì§ ì§ì› ìˆ˜, `emppt`ëŠ” ì‹œê°„ì œ ì§ì› ìˆ˜, `nmgrs`ëŠ” ë§¤ë‹ˆì € ìˆ˜ë¥¼ ì˜ë¯¸í•¨.

1. `state` ë° ì„¤ë¬¸ì¡°ì‚¬ ì‹œì (`observation`)ë³„ë¡œ ë‹¤ìŒ ì§€í‘œë“¤ì˜ í‰ê· ì„ ê³„ì‚°í•˜ë¼.
   - FTE ê³ ìš© ì¸ì› ìˆ˜
   - ì •ê·œì§ ì§ì› ë¹„ìœ¨(FTE ì§ì› ëŒ€ë¹„ ì •ê·œì§ ë¹„ìœ¨)
   - í‰ê·  ì´ˆë´‰(`wage_st`)
   ê³„ì‚°í•œ ê²°ê³¼ë¥¼ ë…¼ë¬¸ì˜ *í‘œ 2*ì™€ ë¹„êµí•˜ë¼.

1. ìµœì €ì„ê¸ˆ ì¸ìƒ ì „, ë‰´ì €ì§€ì™€ íœì‹¤ë² ì´ë‹ˆì•„ì˜ íŒ¨ìŠ¤íŠ¸í‘¸ë“œì ì—ëŠ” ì–´ë–¤ ì°¨ì´ê°€ ìˆì—ˆëŠ”ê°€?

---


## Card and Krueger DiD: ê²°ê³¼


**ë‰´ì €ì§€ ìµœì €ì„ê¸ˆ ì¸ìƒ ì „í›„ í‰ê·  ê³ ìš©**


```{r, echo = FALSE, eval = TRUE}
# create average of FTE employment by state by survey wage
ck1994 <- ck1994 %>%
  mutate(empfte = empft + 0.5*emppt + nmgrs) %>%
  group_by(state,observation) %>%
  summarise(mean_fte = mean(empfte, na.rm = T))
# change to data.frame format
ck1994 <- as.data.frame(ck1994)

# recode ck1994 to look nice
ck_mw <- data.frame(
  Variable = c("FTE employment before","FTE employment after","Change in mean FTE
employment"),
  PA = c(
    ck1994[ck1994$state == "Pennsylvania" & ck1994$observation == "February 1992", "mean_fte"],
    ck1994[ck1994$state == "Pennsylvania" & ck1994$observation == "November 1992", "mean_fte"],
    ck1994[ck1994$state == "Pennsylvania" & ck1994$observation == "November 1992", "mean_fte"] -
      ck1994[ck1994$state == "Pennsylvania" & ck1994$observation == "February 1992", "mean_fte"]),
  NJ = c(
    ck1994[ck1994$state == "New Jersey" & ck1994$observation == "February 1992", "mean_fte"],
    ck1994[ck1994$state == "New Jersey" & ck1994$observation == "November 1992", "mean_fte"],
    ck1994[ck1994$state == "New Jersey" & ck1994$observation == "November 1992", "mean_fte"] -
      ck1994[ck1994$state == "New Jersey" & ck1994$observation == "February 1992", "mean_fte"]))

# present in table form
ck_mw %>%
  mutate(
    PA = round(PA, 2),
    NJ = round(NJ, 2)
  ) %>%
  mutate(
    PA = ifelse(PA<0,
                cell_spec(PA, "html", background = viridis_pal()(2)[2], color = "white", bold = T, align = "c"),
                cell_spec(PA, "html", background = NULL, color = NULL, align = "c")),
    NJ = ifelse(NJ<1,
                cell_spec(NJ, "html", background = viridis_pal()(2)[1], color = "white", bold = T, align = "center"),
                cell_spec(NJ, "html", background = NULL, color = NULL, align = "c"))
  ) %>%
  kable(format = "html", digits = 2, escape = F,
        col.names = c("Variables", "Pennsylvania", "New Jersey")) %>%
  kable_styling("striped", full_width = F)
```


***DiD ì¶”ì •ì¹˜***

- ì´ì¤‘ì°¨ë¶„(DiD) ì¸ê³¼ ì¶”ì •ì¹˜: $0.59 - (-2.17) = 2.76$

- **í•´ì„:** ìµœì €ì„ê¸ˆ ì¸ìƒì€ ë§¤ì¥ë‹¹ í‰ê·  **FTE ê³ ìš© ì¦ê°€**ë¥¼ 2.76ëª… ì´ˆë˜í•¨.

- ì´ì¤‘ì°¨ë¶„(DiD)ì˜ í•µì‹¬ ê°œë…ì€ ì´ì²˜ëŸ¼ ê°„ë‹¨í•¨! ğŸ˜ƒ

- ì´ì œ ì´ëŸ¬í•œ ê²°ê³¼ë¥¼ ê·¸ë˜í”½ìœ¼ë¡œ ì‚´í´ë³´ì.


---


## DiD ê·¸ë˜í”„ë¡œ í‘œí˜„

```{r, echo = F, fig.width = 10, fig.height = 5}
ck_mw <- data.frame(
  date = as.Date(c("010292","010292","011192","011192"), format = "%d%m%y"),
  state = c("Pennsylvania","New Jersey","Pennsylvania","New Jersey"),
  fte_emp = c(23.33,20.44,21.17,21.03)
)

gg_did <- ggplot(ck_mw, aes(x = date, y = fte_emp, color = state)) +
    geom_vline(xintercept = as.Date("010492", format = "%d%m%y"), linetype = "longdash",
               color  = viridis_pal()(3)[2]) +
    geom_vline(xintercept = as.Date("010292", format = "%d%m%y"), linetype = "solid") +
    geom_vline(xintercept = as.Date("011192", format = "%d%m%y"), linetype = "solid") +
    ylim(17,24) +
    scale_x_date(labels = date_format("%h %y"),
                 limits = c(min(ck_mw$date),as.Date("011292", format = "%d%m%y")),
                 date_breaks = "1 month",
                 minor_breaks = NULL) +
    labs(x = NULL, y = "Average number of FTE employees per store", color = NULL) +
    scale_colour_viridis_d() +
    theme_bw(base_size = 16) + 
    theme(legend.position="none") +
    annotate("label", x = as.Date("1992-05-28"), y = 23.99,
             label = "New Jersey minimum wage increases", 
             color =  viridis_pal()(3)[2], size = 4.5) +
    annotate("label", x = as.Date("1992-02-26"), y = 23.99,
             label = "Survey before", color = "black", size = 4.5) +
    annotate("label", x = as.Date("1992-11-22"), y = 23.99,
             label = "Survey after", color = "black", size = 4.5)
gg_did
```

---


## DiD ê·¸ë˜í”„ë¡œ í‘œí˜„

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_2 <- gg_did +
    geom_point(size = 3) +
    annotate("label", x = as.Date("1992-03-01"), y = 22.8, 
             label = "Pennsylvania - feb. 92", color = viridis_pal()(2)[2], size = 4) +
    annotate("label", x = as.Date("1992-03-01"), y = 20, 
             label = "New Jersey - feb. 92", color = viridis_pal()(2)[1], size = 4) +
    annotate("label", x = as.Date("1992-10-01"), y = 21.75, 
             label = "Pennsylvania - nov. 92", color = viridis_pal()(2)[2], size = 4) +
    annotate("label", x = as.Date("1992-10-01"), y = 20.5, 
             label = "New Jersey - nov. 92", color = viridis_pal()(2)[1], size = 4)
gg_did_2
```

---

## DiD ê·¸ë˜í”„ë¡œ í‘œí˜„

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_3 <- gg_did +
    geom_point(size = 3) +
    annotate("label", x = as.Date("1992-05-15"), y = 23, 
             label = "Pennsylvania", color = viridis_pal()(2)[2], size = 4) +
    geom_line(data = ck_mw[ck_mw$state == "Pennsylvania",],
              aes(x = date, y = fte_emp), linetype = "solid")
gg_did_3
```

---

## DiD ê·¸ë˜í”„ë¡œ í‘œí˜„

```{r, echo = F, fig.width = 10, fig.height = 5}
new_jersey_counterfactual <- data.frame(
    date = as.Date(c("010292","011192"), format = "%d%m%y"),
    state = c("New Jersey","New Jersey"),
    fte_emp = c(20.44, 18.28)
)

gg_did_4 = gg_did_3 +
    geom_line(data = new_jersey_counterfactual, aes(x = date, y = fte_emp), 
              linetype = "longdash") +
    annotate("label", x = as.Date("1992-07-15"), y = 18.5, 
             label = "New Jersey Counterfactual", color = viridis_pal()(2)[1], size = 4.5)
gg_did_4

```

---

## DiD ê·¸ë˜í”„ë¡œ í‘œí˜„

```{r, echo = F, fig.width = 10, fig.height = 5}
# real path 
new_jersey_real <- data.frame(
    date = as.Date(c("010292","010492","011192"), format = "%d%m%y"),
    state = c("New Jersey","New Jersey","New Jersey"),
    fte_emp = c(20.44, 19.95,21.03)
)

gg_did_5 = gg_did_3 +
    geom_line(data = new_jersey_counterfactual, aes(x = date, y = fte_emp), 
              linetype = "longdash") +
    geom_line(data = new_jersey_real, aes(x = date, y = fte_emp), linetype = "solid") +
    annotate("label", x = as.Date("1992-05-15"), y = 20.75, 
             label = "New Jersey", color = viridis_pal()(2)[1], size = 4)
gg_did_5
```

---

## DiD ê·¸ë˜í”„ë¡œ í‘œí˜„

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_5 +
  annotate("text", x = as.Date("1992-11-26"), y = 19.7, label = "Treatment\nEffect", color = "black", size = 5)
x = 623
ymin = 150
ymax = ymin+114
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")
```

---

## ë§Œì•½ ë‹¨ìˆœí•œ ì‚¬í›„/ì‚¬ì „ ë¹„êµë¥¼ í–ˆë‹¤ë©´ ì–´ë–»ê²Œ ë˜ì—ˆì„ê¹Œ?


```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_3 +
  annotate("text", x = as.Date("1992-11-26"), y = 20.9, label = "Naive\nTreatment\nEffect",
           color = "black", size = 5) +
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[2,"fte_emp"], 
                   xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]),
               color = viridis_pal()(2)[1], linetype = "dashed") +
  annotate("label", x = as.Date("1992-06-08"), y = 20.1, 
           label = "Naive New Jersey counterfactual", 
           color = viridis_pal()(2)[1], size = 5)
x = 623
ymin = 150
ymax = ymin+24
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")

```

---

## ë§Œì•½ ë‹¨ìˆœí•œ ì‚¬í›„/ì‚¬ì „ ë¹„êµë¥¼ í–ˆë‹¤ë©´ ì–´ë–»ê²Œ ë˜ì—ˆì„ê¹Œ?

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_3 +
  geom_line(data = new_jersey_real, aes(x = date, y = fte_emp), linetype = "solid") +
  geom_line(data = new_jersey_counterfactual, aes(x = date, y = fte_emp), 
            linetype = "longdash") +
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[2,"fte_emp"], 
                   xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]),
               color = viridis_pal()(2)[1], linetype = "dashed") +
  annotate("text", x = as.Date("1992-11-26"), y = 21.1, label = "Naive\nTreatment\nEffect",
           color = "black", size = 5) +
  annotate("text", x = as.Date("1992-11-26"), y = 19.45, label = "Real\nTreatment\nEffect",
           color = "black", size = 5) +
  annotate("label", x = as.Date("1992-09-01"), y = 21.1, 
           label = "New Jersey", 
           color = viridis_pal()(2)[1], size = 5) +
  annotate("label", x = as.Date("1992-05-01"), y = 20.75, 
           label = "Naive New Jersey counterfactual", 
           color = viridis_pal()(2)[1], size = 4) +
  annotate("label", x = as.Date("1992-06-08"), y = 18.75, 
           label = "New Jersey counterfactual", 
           color = viridis_pal()(2)[1], size = 5)
x = 635
ymin = 150
ymax = ymin+24
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")
x = 623
ymin = 150
ymax = ymin+114
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")

```

---

## ë§Œì•½ ë‹¨ìˆœí•œ ì‚¬í›„/ì‚¬ì „ ë¹„êµë¥¼ í–ˆë‹¤ë©´ ì–´ë–»ê²Œ ë˜ì—ˆì„ê¹Œ?

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_3 +
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[3,"fte_emp"], 
                   xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[3,"fte_emp"]),
               color = viridis_pal()(2)[1], linetype = "dashed") +
  annotate("label", x = as.Date("1992-06-08"), y = 21.5, 
           label = "Naive New Jersey counterfactual", 
           color = viridis_pal()(2)[1], size = 5) +
  annotate("text", x = as.Date("1992-11-26"), y = 20.9, label = "Naive\nTreatment\nEffect", color = "black", size = 5)
x = 623
ymin = 142
ymax = ymin+6
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")

```

---

## ë§Œì•½ ë‹¨ìˆœí•œ ì‚¬í›„/ì‚¬ì „ ë¹„êµë¥¼ í–ˆë‹¤ë©´ ì–´ë–»ê²Œ ë˜ì—ˆì„ê¹Œ?

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_3 +
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[3,"fte_emp"], 
                   xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[3,"fte_emp"]),
               color = viridis_pal()(2)[1], linetype = "dashed") +
  annotate("label", x = as.Date("1992-06-08"), y = 21.5, 
           label = "Naive New Jersey counterfactual", 
           color = viridis_pal()(2)[1], size = 4) +
  geom_line(data = new_jersey_real, aes(x = date, y = fte_emp), linetype = "solid") +
  annotate("text", x = as.Date("1992-11-26"), y = 21.1, label = "Naive\nTreatment\nEffect", color = "black", size = 5) +
  annotate("text", x = as.Date("1992-11-26"), y = 19.45, label = "Real\nTreatment\nEffect", color = "black", size = 5) +
  geom_line(data = new_jersey_counterfactual, aes(x = date, y = fte_emp), 
            linetype = "longdash") +
    annotate("label", x = as.Date("1992-09-01"), y = 20.3, 
           label = "New Jersey", 
           color = viridis_pal()(2)[1], size = 5) +
  annotate("label", x = as.Date("1992-06-08"), y = 18.75, 
           label = "New Jersey counterfactual", 
           color = viridis_pal()(2)[1], size = 5)

x = 623
ymin = 142
ymax = ymin+6
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")
x = 623
ymin = 150
ymax = ymin+114
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")

```



# Estimation


---

## íšŒê·€ ë¶„ì„ì„ í†µí•œ DiD

- ì‹¤ì œ ë¶„ì„ì—ì„œëŠ”, DiDëŠ” ë³´í†µ ë‹¨ 2ê°œì˜ ì‹œì (4ê°œì˜ ê´€ì¸¡ì¹˜)ë³´ë‹¤ ë” ë§ì€ ê¸°ê°„ì„ í¬í•¨í•˜ì—¬ ì¶”ì •ë¨.

- ì •ì±… ë³€í™” ì „í›„ë¡œ ë” ë§ì€ ë°ì´í„°ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ê°€ ë§ìŒ.

***DiD íšŒê·€ ë¶„ì„ì˜ 3ê°€ì§€ í•µì‹¬ ìš”ì†Œ***

1. **ì²˜ì¹˜ ë”ë¯¸ ë³€ìˆ˜ (Treatment Dummy Variable)**: $TREAT_s$ (ì²¨ì $s$ëŠ” ì²˜ì¹˜ê°€ ì£¼(state) ìˆ˜ì¤€ì—ì„œ ì´ë£¨ì–´ì§ì„ ë‚˜íƒ€ëƒ„)

2. **ì •ì±… ì‹œí–‰ ì´í›„ ê¸°ê°„ì„ ë‚˜íƒ€ë‚´ëŠ” ë”ë¯¸ ë³€ìˆ˜ (Post-Treatment Periods Dummy Variable)**: $POST_t$ (ì²¨ì $t$ëŠ” ì´ ë³€ìˆ˜ê°€ ì‹œê°„ì— ë”°ë¼ ë³€í™”í•¨ì„ ë‚˜íƒ€ëƒ„)

3. **ë‘ ë³€ìˆ˜ì˜ ìƒí˜¸ì‘ìš©í•­ (Interaction Term)**: $TREAT_s \times POST_t$ ğŸ‘‰ ***ì´ í•­ì˜ ê³„ìˆ˜ê°€ ë°”ë¡œ DiD ì¸ê³¼ íš¨ê³¼ë¥¼ ì˜ë¯¸í•¨!***

---

## íšŒê·€ ë¶„ì„ì„ í†µí•œ DiD


1. **ì²˜ì¹˜ ë”ë¯¸ ë³€ìˆ˜ (Treatment Dummy Variable)**:
   $$
   TREAT_s = \begin{cases}
   0 \quad \text{if } s = \text{Pennsylvania} \\
   1 \quad \text{if } s = \text{New Jersey}
   \end{cases}
   $$

2. **ì •ì±… ì‹œí–‰ ì´í›„ ê¸°ê°„ì„ ë‚˜íƒ€ë‚´ëŠ” ë”ë¯¸ ë³€ìˆ˜ (Post-Treatment Periods Dummy Variable)**:
   $$
   POST_t = \begin{cases}
   0 \quad \text{if } t < \text{April 1, 1992} \\
   1 \quad \text{if } t \geq \text{April 1, 1992}
   \end{cases}
   $$

3. **ë‘ ë³€ìˆ˜ì˜ ìƒí˜¸ì‘ìš©í•­ (Interaction Term)**: $TREAT_s \times POST_t$ ğŸ‘‰ ***ì´ í•­ì˜ ê³„ìˆ˜ê°€ ë°”ë¡œ DiD ì¸ê³¼ íš¨ê³¼ë¥¼ ì˜ë¯¸í•¨!***


***ì–´ë–¤ ê´€ì¸¡ì¹˜ì—ì„œ $TREAT_s \times POST_t = 1$ì´ ë˜ëŠ”ê°€?***

- ìœ„ ìš”ì†Œë“¤ì„ ëª¨ë‘ ê²°í•©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ DiD íšŒê·€ì‹ì„ ì–»ìŒ:
   $$
   EMP_{st} = \alpha + \beta TREAT_s + \gamma POST_t + \delta(TREAT_s \times POST_t) + \varepsilon_{st}
   $$

- $\delta$: ìµœì €ì„ê¸ˆ ì¸ìƒì´ ê³ ìš©ì— ë¯¸ì¹˜ëŠ” ì¸ê³¼ì  íš¨ê³¼

---


## íšŒê·€ ë¶„ì„ ì´í•´í•˜ê¸°

$$EMP_{st} = \color{#d96502}\alpha + \color{#027D83}\beta TREAT_s + \color{#02AB0D}\gamma POST_t + \color{#d90502}\delta(TREAT_s \times POST_t) + \varepsilon_{st}$$

***ì£¼ì–´ì§„ ì¡°ê±´ì—ì„œ ê¸°ëŒ€ê°’:***

- $\mathbb{E}(EMP_{st} \; | \; TREAT_s = 0, POST_t = 0) = \color{#d96502}\alpha$

- $\mathbb{E}(EMP_{st} \; | \; TREAT_s = 0, POST_t = 1) = \color{#d96502}\alpha + \color{#02AB0D}\gamma$

- $\mathbb{E}(EMP_{st} \; | \; TREAT_s = 1, POST_t = 0) = \color{#d96502}\alpha + \color{#027D83}\beta$

- $\mathbb{E}(EMP_{st} \; | \; TREAT_s = 1, POST_t = 1) = \color{#d96502}\alpha + \color{#027D83}\beta + \color{#02AB0D}\gamma + \color{#d90502}\delta$

***DiD ê³„ì‚° ê³¼ì •***

$$[\mathbb{E}(EMP_{st} \; | \; TREAT_s = 1, POST_t = 1)-\mathbb{E}(EMP_{st} \; | \; TREAT_s = 1, POST_t = 0)] - \\
[\mathbb{E}(EMP_{st} \; | \; TREAT_s = 0, POST_t = 1)-\mathbb{E}(EMP_{st} \; | \; TREAT_s = 0, POST_t = 0)] = \color{#d90502}\delta$$

---

## íšŒê·€ ë¶„ì„ ì´í•´í•˜ê¸°

$$EMP_{st} = \color{#d96502}\alpha + \color{#027D83}\beta TREAT_s + \color{#02AB0D}\gamma POST_t + \color{#d90502}\delta(TREAT_s \times POST_t) + \varepsilon_{st}$$


***í‘œ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬:***

|  | ì‚¬ì „ í‰ê·  | ì‚¬í›„ í‰ê·  | ë³€í™” (ì‚¬í›„ - ì‚¬ì „) |
|:-:|:--:|:--:|:--:|
| íœì‹¤ë² ì´ë‹ˆì•„ (PA) | $\color{#d96502}\alpha$ | $\color{#d96502}\alpha + \color{#02AB0D}\gamma$ | $\color{#02AB0D}\gamma$ |
| ë‰´ì €ì§€ (NJ) | $\color{#d96502}\alpha + \color{#027D83}\beta$ | $\color{#d96502}\alpha + \color{#027D83}\beta + \color{#02AB0D}\gamma + \color{#d90502}\delta$ | $\color{#02AB0D}\gamma + \color{#d90502}\delta$ |
| ë³€í™” (NJ - PA) | $\color{#027D83}\beta$ | $\color{#027D83}\beta + \color{#d90502}\delta$ | $\color{#d90502}\delta$ |

- ì´ í‘œëŠ” *íœì‹¤ë² ì´ë‹ˆì•„*ë¥¼ *ëŒ€ì¡°êµ°(Control)*ìœ¼ë¡œ, *ë‰´ì €ì§€*ë¥¼ *ì²˜ì¹˜êµ°(Treatment)*ìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ì¼ë°˜ì ì¸ ì„¤ì •ìœ¼ë¡œ í™•ì¥í•  ìˆ˜ ìˆìŒ.


---


## Task 2 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::

1. ë”ë¯¸ ë³€ìˆ˜ `treat`ë¥¼ ìƒì„±í•˜ë¼. `state`ê°€ íœì‹¤ë² ì´ë‹ˆì•„ì´ë©´ `FALSE`, ë‰´ì €ì§€ì´ë©´ `TRUE`ë¡œ ì„¤ì •í•˜ë¼.

2. ë”ë¯¸ ë³€ìˆ˜ `post`ë¥¼ ìƒì„±í•˜ë¼. `observation`ì´ 1992ë…„ 2ì›”ì´ë©´ `FALSE`, ê·¸ ì™¸ì˜ ê²½ìš° `TRUE`ë¡œ ì„¤ì •í•˜ë¼.

3. ë‹¤ìŒ íšŒê·€ ëª¨í˜•ì„ ì¶”ì •í•˜ë¼. ìŠ¬ë¼ì´ë“œ 9ì˜ ê²°ê³¼ì™€ ë™ì¼í•œ ê²°ê³¼ë¥¼ ì–»ëŠ”ê°€?

   $$empfte_{st} = \alpha + \beta treat_s + \gamma post_t + \delta(treat_s \times post_t) + \varepsilon_{st}$$





# Identifying Assumptions

---

## DiDì˜ í•µì‹¬ ê°€ì •: í‰í–‰ ì¶”ì„¸ (Parallel Trends)

> __ê³µí†µ ë˜ëŠ” í‰í–‰ ì¶”ì„¸ ê°€ì •__: ìµœì €ì„ê¸ˆì´ ì¸ìƒë˜ì§€ ì•Šì•˜ë‹¤ë©´, íœì‹¤ë² ì´ë‹ˆì•„ì˜ íŒ¨ìŠ¤íŠ¸í‘¸ë“œ ê³ ìš© ì¶”ì„¸ëŠ” ë‰´ì €ì§€ì—ì„œ ê¸°ëŒ€í•  ìˆ˜ ìˆì—ˆë˜ ì¶”ì„¸ì™€ ê°™ì•„ì•¼ í•¨.

- ì´ ê°€ì •ì€ 1992ë…„ 2ì›”ë¶€í„° 11ì›”ê¹Œì§€ íœì‹¤ë² ì´ë‹ˆì•„ì˜ íŒ¨ìŠ¤íŠ¸í‘¸ë“œ ê³ ìš© ì¶”ì„¸ê°€ ë‰´ì €ì§€ì˜ ë°˜ì‚¬ì‹¤ì (counterfactual) ê³ ìš© ì¶”ì„¸ë¥¼ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê¸°ì¤€ìœ¼ë¡œ ì œê³µí•´ì•¼ í•¨ì„ ì˜ë¯¸í•¨.

- ì´ ê°€ì •ì„ ì™„ì „íˆ ê²€ì¦í•˜ê±°ë‚˜ ê¸°ê°í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•¨.

- ***ì§ê´€ì ì¸ í™•ì¸ ë°©ë²•:*** ì •ì±… ë³€í™” ì´ì „ì˜ ì¶”ì„¸ë¥¼ ë¹„êµí•´ë³´ê³ , ì¤‘ê¸°ì  íš¨ê³¼ê°€ ì—†ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë  ê²½ìš° ì •ì±… ë³€í™” ì´í›„ì˜ ì¶”ì„¸ë„ ë¹„êµí•´ë³¼ ìˆ˜ ìˆìŒ.

---

##  í‰í–‰ ì¶”ì„¸: ëˆˆìœ¼ë¡œ í™•ì¸

```{r, echo = FALSE, eval = TRUE, fig.width = 10, fig.height = 5}
gg_did_5
```

---


## í‰í–‰ ì¶”ì„¸ ê°€ì •ì„ í™•ì¸í•˜ëŠ” ë°©ë²•


```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend <- ggplot(ck_mw, aes(x = date, y = fte_emp, color = state)) +
    geom_vline(xintercept = as.Date("010492", format = "%d%m%y"), linetype = "longdash",
               color  = viridis_pal()(3)[2]) +
    geom_vline(xintercept = as.Date("010292", format = "%d%m%y"), linetype = "solid") +
    geom_vline(xintercept = as.Date("011192", format = "%d%m%y"), linetype = "solid") +
    ylim(17,24) +
  scale_x_date(labels = date_format("%h %y"),
               limits = c(as.Date("011091", format = "%d%m%y"),as.Date("011292", format = "%d%m%y")),
               date_breaks = "1 month",
               minor_breaks = NULL) +
  labs(x = NULL, y = "Average number of FTE employees per store", color = NULL) +
  scale_colour_viridis_d() +
  theme_bw(base_size = 16) + theme(legend.position="none") +
    annotate("label", x = as.Date("1992-05-28"), y = 23.99,
             label = "New Jersey minimum wage increases",
             color =  viridis_pal()(3)[2], size = 4.5) +
  annotate("label", x = as.Date("1991-12-28"), y = 23.99, label = "Survey before", color = "black", size = 4.5) +
  annotate("label", x = as.Date("1992-11-23"), y = 23.99, label = "Survey after", color = "black", size = 4.5)

gg_did_trend +
      geom_point(size = 3) +
    annotate("label", x = as.Date("1992-03-01"), y = 22.8, 
             label = "Pennsylvania - feb. 92", color = viridis_pal()(2)[2], size = 4) +
    annotate("label", x = as.Date("1992-03-01"), y = 20, 
             label = "New Jersey - feb. 92", color = viridis_pal()(2)[1], size = 4) +
    annotate("label", x = as.Date("1992-10-01"), y = 21.75, 
             label = "Pennsylvania - nov. 92", color = viridis_pal()(2)[2], size = 4) +
    annotate("label", x = as.Date("1992-10-01"), y = 20.5, 
             label = "New Jersey - nov. 92", color = viridis_pal()(2)[1], size = 4) +
  annotate("label", x = as.Date("1992-01-15"), y = 21.5, label = "What was happening\nbefore April 92?", color = "black", size = 6)
```

---

## í‰í–‰ ì¶”ì„¸ ê°€ì •ì„ í™•ì¸í•˜ëŠ” ë°©ë²•

```{r, echo = F, fig.width = 10, fig.height = 5}
new_jersey_counterfactual <- data.frame(
    date = as.Date(c("151191","010292","011192"), format = "%d%m%y"),
    state = c("New Jersey","New Jersey","New Jersey"),
    fte_emp = c(21.05489,20.44,18.28)
)

new_jersey_counterfactual_1 <- data.frame(
    date = as.Date(c("151191","010292","010492","011192"), format = "%d%m%y"),
    state = c("New Jersey","New Jersey","New Jersey","New Jersey"),
    fte_emp = c(20.44,20.44,20.44,20.44)
)

new_jersey_counterfactual_2 <- data.frame(
    date = as.Date(c("151191","010292","010492","011192"), format = "%d%m%y"),
    state = c("New Jersey","New Jersey","New Jersey","New Jersey"),
    fte_emp = c(20,20.44,20.77846,21.98564)
)

pennsylvania_before =  data.frame(
    date = as.Date(c("151191","010292"), format = "%d%m%y"),
    state = c("Pennsylvania","Pennsylvania"),
    fte_emp = c(23.94489,23.33))

gg_did_trend +
      annotate("label", x = as.Date("1992-05-15"), y = 23, 
             label = "Pennsylvania", color = viridis_pal()(2)[2], size = 4) +
    geom_line(data = ck_mw[ck_mw$state == "Pennsylvania",],
              aes(x = date, y = fte_emp), linetype = "solid") +
  geom_point(size = 3) +
  geom_line(data = pennsylvania_before, aes(x = date, y = fte_emp), 
            linetype = "longdash",color = viridis_pal()(2)[2]) +
  geom_line(data = new_jersey_counterfactual, aes(x = date, y = fte_emp), 
            linetype = "longdash") +
  geom_line(data = new_jersey_counterfactual_1, aes(x = date, y = fte_emp), 
            linetype = "longdash") +
  geom_line(data = new_jersey_counterfactual_2, aes(x = date, y = fte_emp), 
            linetype = "longdash") +
  annotate("label", x = as.Date("1992-05-15"), y = 19, label = "New Jersey possible counterfactuals", color = viridis_pal()(2)[1], size = 4)

```


---

## í‰í–‰ ì¶”ì„¸ ê°€ì • âŸ¶ ê²€ì¦ë¨ âœ…

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend_val = gg_did_trend +
  geom_line(data = pennsylvania_before, aes(x = date, y = fte_emp), 
            linetype = "longdash",color = viridis_pal()(2)[2]) +
  annotate("label", x = as.Date("1992-05-15"), y = 23, 
             label = "Pennsylvania", color = viridis_pal()(2)[2], size = 4) +
  geom_line(data = ck_mw[ck_mw$state == "Pennsylvania",],
              aes(x = date, y = fte_emp), linetype = "solid") +
  geom_point(size = 3) +
  geom_line(data = new_jersey_counterfactual, aes(x = date, y = fte_emp), 
            linetype = "longdash") +
  geom_line(data = new_jersey_real, aes(x = date, y = fte_emp), 
            linetype = "solid")  +
  annotate("label", x = as.Date("1992-05-15"), y = 19, label = "New Jersey counterfactual", color = viridis_pal()(2)[1], size = 4) +
    annotate("label", x = as.Date("1992-05-15"), y = 20.75, label = "New Jersey", color = viridis_pal()(2)[1], size = 4) +
    annotate("rect", xmin=as.Date("011091", format = "%d%m%y"), xmax=as.Date("010492", format = "%d%m%y"), ymin=20 , ymax=23.5, alpha=0.4, color="#21908CFF", fill="#21908CFF") +
  annotate("text", x=as.Date("011291", format = "%d%m%y"), y=22, label = "Employment trends\nare similar", color = "black", size = 5)
gg_did_trend_val

```

---

## í‰í–‰ ì¶”ì„¸ ê°€ì • âŸ¶ ê²€ì¦ë¨ âœ…

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend_val +
  geom_line(data = new_jersey_counterfactual, aes(x = date, y = fte_emp), 
              linetype = "dashed", color = viridis_pal()(2)[2]) +
  annotate("label", x = as.Date("1992-07-15"), y = 18.5, 
             label = "New Jersey DID Counterfactual", color = viridis_pal()(2)[2], size = 4.5) +
   annotate("text", x = as.Date("1992-11-28"), y = 19.6, 
           label = "Real\nTreatment\nEffect\n=\nDID\nTreatment\nEffect", color = "black", size = 4)

x = 640
ymin = 150
ymax = ymin+114
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")
```

---

## í‰í–‰ ì¶”ì„¸ ê°€ì • âŸ¶ ê²€ì¦ë˜ì§€ ì•ŠìŒ âŒ

```{r, echo = F, fig.width = 10, fig.height = 5}

new_jersey_real_2 <- data.frame(
    date = as.Date(c("010292","010492","011192"), format = "%d%m%y"),
    state = c("New Jersey","New Jersey","New Jersey"),
    fte_emp = c(20.44,20.77846,21.03)
)

gg_did_trend_not_val = gg_did_trend +
  geom_line(data = pennsylvania_before, aes(x = date, y = fte_emp), 
            linetype = "longdash",color = viridis_pal()(2)[2]) +
  annotate("label", x = as.Date("1992-05-15"), y = 23, 
             label = "Pennsylvania", color = viridis_pal()(2)[2], size = 4) +
  geom_line(data = ck_mw[ck_mw$state == "Pennsylvania",],
              aes(x = date, y = fte_emp), linetype = "solid") +
  geom_point(size = 3) +
  geom_line(data = new_jersey_counterfactual_2, aes(x = date, y = fte_emp), 
            linetype = "longdash") +
  geom_line(data = new_jersey_real_2, aes(x = date, y = fte_emp), 
            linetype = "solid")  +
  annotate("label", x = as.Date("1992-05-01"), y = 21.6, label = "New Jersey counterfactual", color = viridis_pal()(2)[1], size = 4) +
    annotate("label", x = as.Date("1992-05-15"), y = 20.4, label = "New Jersey", color = viridis_pal()(2)[1], size = 4) +
    annotate("rect", xmin=as.Date("011091", format = "%d%m%y"), xmax=as.Date("010492", format = "%d%m%y"), ymin=20 , ymax=23.5, alpha=0.4, color="#21908CFF", fill="#21908CFF") +
  annotate("text", x=as.Date("011291", format = "%d%m%y"), y=22, label = "Employment trends\nare not similar", color = "black", size = 5)
gg_did_trend_not_val
```

---

## í‰í–‰ ì¶”ì„¸ ê°€ì • âŸ¶ ê²€ì¦ë˜ì§€ ì•ŠìŒ âŒ

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend_not_val + 
  geom_line(data = pennsylvania_before, aes(x = date, y = fte_emp), 
            linetype = "longdash",color = viridis_pal()(2)[2]) +
  geom_line(data = new_jersey_counterfactual, aes(x = date, y = fte_emp), 
              linetype = "longdash", color = viridis_pal()(2)[2]) +
  annotate("label", x = as.Date("1992-07-15"), y = 18.5, 
             label = "New Jersey DID Counterfactual", 
             color = viridis_pal()(2)[2], size = 4.5) +
  annotate("text", x = as.Date("1992-11-28"), y = 19.45, 
           label = "DiD\nTreatment\nEffect", color = "black", size = 4) +
  annotate("text", x = as.Date("1992-11-28"), y = 21.4, 
           label = "Real\nTreatment\nEffect", color = "black", size = 4)

x = 640
ymin = 108
ymax = ymin+42
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")
x = 640
ymin = 150
ymax = ymin+114
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")
```

---

## í‰í–‰ ì¶”ì„¸ ê°€ì •: [Card and Krueger (2000)](https://inequality.stanford.edu/sites/default/files/media/_media/pdf/Reference%20Media/Card%20and%20Krueger_2000_Policy.pdf)

íœì‹¤ë² ì´ë‹ˆì•„ì™€ ë‰´ì €ì§€ì˜ ì‹¤ì œ ê³ ìš© ì¶”ì„¸ë¥¼ ì‚´í´ë³´ì.

```{r, echo=FALSE, out.width="600px"}
knitr::include_graphics("../img/photos/min_wage_parallel_trends.png")
```

- ê³µí†µ ì¶”ì„¸ ê°€ì •ì´ ê²€ì¦ë  ê°€ëŠ¥ì„±ì´ ë†’ì€ê°€?

---


## í‰í–‰ ì¶”ì„¸ ê°€ì •: ê³µì‹ì  ì •ì˜

ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•˜ì:

- $Y_{ist}^1$: ì‹œì  $t$ì—ì„œ ì£¼(state) $s$ì˜ ì‹ë‹¹ $i$ì—ì„œ ë†’ì€ ìµœì €ì„ê¸ˆì´ ì ìš©ë  ê²½ìš° íŒ¨ìŠ¤íŠ¸í‘¸ë“œ ê³ ìš© ìˆ˜ì¤€

- $Y_{ist}^0$: ì‹œì  $t$ì—ì„œ ì£¼(state) $s$ì˜ ì‹ë‹¹ $i$ì—ì„œ ë‚®ì€ ìµœì €ì„ê¸ˆì´ ì ìš©ë  ê²½ìš° íŒ¨ìŠ¤íŠ¸í‘¸ë“œ ê³ ìš© ìˆ˜ì¤€

ì´ëŠ” **ì ì¬ì  ê²°ê³¼(Potential Outcomes)**ì´ë©°, ë‘ ê°œ ì¤‘ í•˜ë‚˜ë§Œ ê´€ì°°í•  ìˆ˜ ìˆìŒ.

DiD ì¶”ì •ì˜ í•µì‹¬ ê°€ì •ì€, ì²˜ì¹˜(treatment)ê°€ ì—†ì„ ê²½ìš° ì‹ë‹¹ $i$ì˜ ê²°ê³¼ê°€ ë‹¤ìŒê³¼ ê°™ì´ ì£¼ì–´ì§„ë‹¤ëŠ” ê²ƒì„:

$$\mathbb{E}[Y_{ist}^0|s,t] = \gamma_s + \lambda_t$$

ì´ ê°€ì •ì€ ë‘ ê°€ì§€ ì•”ë¬µì  ê°€ì •ì„ í¬í•¨í•¨:

1. ***ì„ íƒ í¸í–¥ (Selection Bias)***: ê³ ì •ëœ ì£¼(state) íŠ¹ì„± $(\gamma)$ê³¼ ê´€ë ¨ë¨.
2. ***ì‹œê°„ ì¶”ì„¸ (Time Trend)***: ì²˜ì¹˜êµ°ê³¼ ëŒ€ì¡°êµ°ì´ ë™ì¼í•œ ì‹œê°„ ì¶”ì„¸ $(\lambda)$ë¥¼ ê°€ì§.


---

## í‰í–‰ ì¶”ì„¸ ê°€ì •: ê³µì‹ì  ì •ì˜

ë¹„êµ ê·¸ë£¹ì—ì„œì˜ ê²°ê³¼:

$$\mathbb{E}[Y_{ist}| s = \text{Pennsylvania},t = \text{Feb}] = \gamma_{PA} + \lambda_{Feb}$$

$$\mathbb{E}[Y_{ist}|s = \text{Pennsylvania},t = \text{Nov}] = \gamma_{PA} + \lambda_{Nov}$$

$$
\begin{align}
\mathbb{E}[Y_{ist}&|s = \text{Pennsylvania},t = \text{Nov}] - \mathbb{E}[Y_{ist}| s = \text{Pennsylvania},t = \text{Feb}] \\
&= \gamma_{PA} + \lambda_{Nov} - (\gamma_{PA} + \lambda_{Feb}) \\
&= \lambda_{Nov} - \lambda_{Feb}
\end{align}
$$

---

## í‰í–‰ ì¶”ì„¸ ê°€ì •: ê³µì‹ì  ì •ì˜

ë¹„êµ ê·¸ë£¹ì—ì„œì˜ ê²°ê³¼:

$$\mathbb{E}[Y_{ist}| s = \text{Pennsylvania},t = \text{Feb}] = \gamma_{PA} + \lambda_{Feb}$$

$$\mathbb{E}[Y_{ist}|s = \text{Pennsylvania},t = \text{Nov}] = \gamma_{PA} + \lambda_{Nov}$$

$$
\begin{align}
\mathbb{E}[Y_{ist}&|s = \text{Pennsylvania},t = \text{Nov}] - \mathbb{E}[Y_{ist}| s = \text{Pennsylvania},t = \text{Feb}] \\
&= \gamma_{PA} + \lambda_{Nov} - (\gamma_{PA} + \lambda_{Feb}) \\
&= \underbrace{\lambda_{Nov} - \lambda_{Feb}}_{\text{ì‹œê°„ ì¶”ì„¸ (time trend)}}
\end{align}
$$

$\rightarrow$ ë¹„êµ ê·¸ë£¹ì„ ì´ìš©í•˜ì—¬ ***ì‹œê°„ ì¶”ì„¸ (time trend)***ë¥¼ ì¶”ì •í•  ìˆ˜ ìˆìŒ.

---

## í‰í–‰ ì¶”ì„¸ ê°€ì •: ê³µì‹ì  ì •ì˜

ë¹„êµ ê·¸ë£¹ì—ì„œì˜ ê²°ê³¼:

$$\mathbb{E}[Y_{ist}| s = \text{Pennsylvania},t = \text{Feb}] = \gamma_{PA} + \lambda_{Feb}$$

$$\mathbb{E}[Y_{ist}|s = \text{Pennsylvania},t = \text{Nov}] = \gamma_{PA} + \lambda_{Nov}$$

$$
\begin{align}
\mathbb{E}[Y_{ist}&|s = \text{Pennsylvania},t = \text{Nov}] - \mathbb{E}[Y_{ist}| s = \text{Pennsylvania},t = \text{Feb}] \\
&= \gamma_{PA} + \lambda_{Nov} - (\gamma_{PA} + \lambda_{Feb}) \\
&= \underbrace{\lambda_{Nov} - \lambda_{Feb}}_{\text{ì‹œê°„ ì¶”ì„¸ (time trend)}}
\end{align}
$$

$\rightarrow$ ë¹„êµ ê·¸ë£¹ì„ ì´ìš©í•˜ì—¬ ***ì‹œê°„ ì¶”ì„¸ (time trend)***ë¥¼ ì¶”ì •í•  ìˆ˜ ìˆìŒ.

---


## í‰í–‰ ì¶”ì„¸ ê°€ì •: ì²˜ì¹˜êµ°ì˜ ê²°ê³¼

ìµœì €ì„ê¸ˆ ì¸ìƒì˜ **ì§„ì§œ íš¨ê³¼(true impact)**ë¥¼ $\delta$ë¼ê³  í•˜ì:

$$\mathbb{E}[Y_{ist}^1 - Y_{ist}^0|s,t] = \delta$$

ì²˜ì¹˜êµ°ì—ì„œì˜ ê²°ê³¼:

$$\mathbb{E}[Y_{ist}|s = \text{New Jersey}, t = \text{Feb}] = \gamma_{NJ} + \lambda_{Feb}$$

$$\mathbb{E}[Y_{ist}|s = \text{New Jersey}, t = \text{Nov}] = \gamma_{NJ} + \delta + \lambda_{Nov}$$

$$
\begin{align}
\mathbb{E}[Y_{ist}&|s = \text{New Jersey}, t = \text{Nov}] - \mathbb{E}[Y_{ist}|s = \text{New Jersey}, t = \text{Feb}] \\
&= \gamma_{NJ} + \delta + \lambda_{Nov} - (\gamma_{NJ} + \lambda_{Feb}) \\
&= \delta + \underbrace{\lambda_{Nov} - \lambda_{Feb}}_{\text{ì‹œê°„ ì¶”ì„¸ (time trend)}}
\end{align}
$$

---

## í‰í–‰ ì¶”ì„¸ ê°€ì •: ìµœì¢… ë„ì¶œ

ê²°ê³¼ì ìœ¼ë¡œ:

$$
\begin{align}
\mathbb{E}[Y_{ist}&|s = \text{PA},t = \text{Nov}] - \mathbb{E}[Y_{ist}| s = \text{PA},t = \text{Feb}] = \underbrace{\lambda_{Nov} - \lambda_{Feb}}_{\text{ì‹œê°„ ì¶”ì„¸ (time trend)}}
\end{align}
$$

$$
\begin{align}
\mathbb{E}[Y_{ist}&|s = \text{NJ},t = \text{Nov}] - \mathbb{E}[Y_{ist}| s = \text{NJ},t = \text{Feb}] = \delta + \underbrace{\lambda_{Nov} - \lambda_{Feb}}_{\text{ì‹œê°„ ì¶”ì„¸ (time trend)}}
\end{align}
$$

$$
\begin{align}
DD &= \mathbb{E}[Y_{ist}|s = \text{NJ}, t = \text{Nov}] - \mathbb{E}[Y_{ist}|s = \text{NJ}, t = \text{Feb}] \\
& \qquad \qquad - \Big(\mathbb{E}[Y_{ist}|s = \text{PA},t = \text{Nov}] - \mathbb{E}[Y_{ist}| s = \text{PA},t = \text{Feb}]\Big) \\
&= \delta + \lambda_{Nov} - \lambda_{Feb} - (\lambda_{Nov} - \lambda_{Feb}) \\
&= \delta
\end{align}
$$




------------------------------------------------------------------------

## ğŸ” ì¸ê³¼ ê´€ê³„ë¥¼ ì°¾ì•„ê°€ëŠ” ê¸¸

âœ… ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ë‹¤ë£°ê¹Œ?: ì½ê¸°(Read), ì •ë¦¬(Tidy), ì‹œê°í™”(Visualize)...

âœ… ë³€ìˆ˜ê°„ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ ìš”ì•½í• ê¹Œ? ë‹¨ìˆœ / ë‹¤ì¤‘ ì„ í˜• íšŒê·€...ë¹„ì„ í˜•íšŒê·€, êµì°¨ë³€ìˆ˜...

âœ… ì¸ê³¼ ê´€ê³„(Causality)ë€ ë¬´ì—‡ì¸ê°€?

âœ… ì „ì²´ ëª¨ì§‘ë‹¨ì„ ê´€ì¸¡í•˜ì§€ ëª»í•˜ë©´ ì–´ë–»ê²Œ í• ê¹Œ? Sampling!

âœ… ìš°ë¦¬ì˜ ì—°êµ¬ ê²°ê³¼ê°€ ë‹¨ìˆœí•œ ë¬´ì‘ìœ„(Randomness) ë•Œë¬¸ì¼ ìˆ˜ë„ ìˆì„ê¹Œ? ì‹ ë¢°êµ¬ê°„ê³¼ ê°€ì„¤ê²€ì •. í†µê³„ì  ì¶”ë¡ 

ğŸš§ ***ì‹¤ì œë¡œ ì™¸ìƒì„±ì„ ì–´ë–»ê²Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆì„ê¹Œ?***: ì´ì¤‘ ì°¨ë¶„

------------------------------------------------------------------------


<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

::: {style="display: flex; justify-content: center; align-items: center; height: 70vh;"}
<h2 style="color: #ff6666; text-align: center; font-family: &#39;Pacifico&#39;, cursive; font-size: 50px;">

THE END!

</h2>
:::