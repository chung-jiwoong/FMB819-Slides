---
title: "FMB819: Rì„ ì´ìš©í•œ ë°ì´í„°ë¶„ì„"
subtitle: "<span style='font-size:1.5em; color:#a01616;'>Linear Regression Extensions</span>"
# date: "`r Sys.Date()`"
format:
  revealjs:
    slide-number: true
    # smaller: true
    scrollable: true
    chalkboard: true
    transition: fade
    transition-speed: fast
    #incremental: true
    #lib_dir: libs
    css: [default, "../css/kubs.css", "../css/kubs-fonts.css"]
    #nature:
      # beforeInit: ["../js/ru_xaringan.js"]
      #highlightStyle: github
      #highlightLines: true
      #countIncrementalSlides: false
    #  ratio: "16:9"
    # includes:
    #   in_header: "../libs/partials/header.html"
revealjs-plugins:
  - revealjs-text-resizer
---

```{r setup, include=FALSE,warning=FALSE,message=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  dev = "svg",
  cache = TRUE,
  fig.align = "center"
  #fig.width = 11,
  #fig.height = 5
)

# define vars
om = par("mar")
lowtop = c(om[1],om[2],0.1,om[4])
library(magrittr)
library(plotly)
library(reshape2)
library(haven)
library(tidyverse)
library(AER)
library(gtools)
library(countdown)

# countdown style
countdown(
  color_border              = "#d90502",
  color_text                = "black",
  color_running_background  = "#d90502",
  color_running_text        = "white",
  color_finished_background = "white",
  color_finished_text       = "#d90502",
  color_finished_border     = "#d90502"
)
```

------------------------------------------------------------------------

## Today's Agenda

-   ë°ì´í„°ì˜ íŠ¹ì„±ê³¼ ë³€ìˆ˜ ê°„ ê´€ê³„ì— ë”°ë¼, **ê¸°ë³¸ ëª¨ë¸ì—ì„œ ë²—ì–´ë‚˜ì•¼ í•˜ëŠ” ê²½ìš°**ê°€ ìˆìŒ.

-   3ê°€ì§€ ì¤‘ìš”í•œ ë³€í˜•ì„ ì‚´í´ë³¼ ê²ƒì„:

    1.  ***ë¹„ì„ í˜• ê´€ê³„ (Non-linear relationships)***: ë¡œê·¸ ë° ë‹¤í•­ì‹ ëª¨ë¸
    2.  ***ë³€ìˆ˜ ê°„ êµì°¨ (Interaction terms)***
    3.  ***í‘œì¤€í™” íšŒê·€ (Standardized regression)***

-   ì´ ê²½ìš°ì—ë„ **OLS(ìµœì†ŒììŠ¹ë²•)** ì¶”ì • ë°©ë²• ì‚¬ìš©

-   ì‹¤ì¦ ë¶„ì„ ì˜ˆì œ: (i) *ëŒ€í•™ ë“±ë¡ê¸ˆ*ê³¼ *ì†Œë“ ì ì¬ë ¥*, (ii) *ì„ê¸ˆ*, *êµìœ¡ ìˆ˜ì¤€* ë° *ì„±ë³„*, (iii) *í•™ê¸‰ ê·œëª¨*ì™€ *í•™ìƒ ì„±ì·¨ë„*

# Non-Linear Relationships

------------------------------------------------------------------------

## Accounting for Non-Linear Relationships

2 ê°€ì§€ ëª¨í˜•:

1.  ***Log*** models

2.  ***Polynomial*** models

------------------------------------------------------------------------

## Log ëª¨ë¸

-   ì§€ê¸ˆê¹Œì§€ ë³¸ ëª¨ë¸ë“¤ì€ ***ìˆ˜ì¤€-ìˆ˜ì¤€(Level-Level)*** ëª¨ë¸ë¡œ ë³¼ ìˆ˜ ìˆìŒ. ì¢…ì† ë³€ìˆ˜ì™€ ë…ë¦½ ë³€ìˆ˜ê°€ ì›ë˜ ë‹¨ìœ„(ìˆ˜ì¤€)ë¡œ ì¸¡ì •ë¨.

    -   í™”íë‹¨ìœ„(ì›), ì—°ë„, í•™ìƒ ìˆ˜, í¼ì„¼íŠ¸(%) ë“±

-   ì¢…ì† ë³€ìˆ˜ ë°/ë˜ëŠ” ë…ë¦½ ë³€ìˆ˜ì— **ìì—°ë¡œê·¸(Natural Logarithm)** ë¥¼ ì·¨í•˜ë©´ 3ê°€ì§€ ìœ í˜•ì˜ íšŒê·€ ëª¨ë¸ì„ ì •ì˜í•  ìˆ˜ ìˆìŒ\
    (í‘œê¸° ë‚¨ìš©: $\ln(x) = \log_{e}(x) = \log(x)$)

    -   ***ë¡œê·¸ - ìˆ˜ì¤€(Log - Level)***: $\quad \log(y_i) = b_0 + b_1 x_{1,i} + ... + e_i$

    -   ***ìˆ˜ì¤€ - ë¡œê·¸(Level - Log)***: $\quad y_i = b_0 + b_1 \log(x_{1,i}) + ... + e_i$

    -   ***ë¡œê·¸ - ë¡œê·¸(Log - Log)***: $\quad \log(y_i) = b_0 + b_1 \log(x_{1,i}) + ... + e_i$

------------------------------------------------------------------------

## (ìì—°)ë¡œê·¸ í•¨ìˆ˜: ê¸°ë³¸ ê°œë…

```{r, echo = FALSE, fig.height = 5, fig.width = 10}
data <- data.frame(x = seq(0, 10000, .1))

data %>%
  ggplot(aes(x = x, y = log(x))) +
  geom_line() +
  theme_bw(base_size = 20)
```

------------------------------------------------------------------------

## (ìì—°)ë¡œê·¸ í•¨ìˆ˜: ê¸°ë³¸ ê°œë…

-   [ìì—°ë¡œê·¸ í•¨ìˆ˜](https://en.wikipedia.org/wiki/Natural_logarithm)ëŠ” ì§€ìˆ˜ í•¨ìˆ˜ì˜ ì—­í•¨ìˆ˜ë¡œ ì •ì˜ë¨, ì¦‰ $\log(\exp(x))=x$

$\rightarrow$ ëª¨ë“  $x$ì— ëŒ€í•´ $\exp(x)>0$ ì´ë¯€ë¡œ, **ìì—°ë¡œê·¸ í•¨ìˆ˜ëŠ” 0ë³´ë‹¤ í° ê°’ì—ì„œë§Œ ì •ì˜ë¨**! (ì¦‰, 0ì—ì„œëŠ” ì •ì˜ë˜ì§€ ì•ŠìŒ)

-   ë³€ìˆ˜ì— ë¡œê·¸ë¥¼ ì·¨í•˜ë ¤ë©´ ê°’ì´ 0 ë˜ëŠ” ìŒìˆ˜ê°€ ì•„ë‹Œì§€ í™•ì¸í•´ì•¼ í•¨! ì¢…ì† ë³€ìˆ˜ ë˜ëŠ” ë…ë¦½ ë³€ìˆ˜ì— ë¡œê·¸ë¥¼ ì ìš©í•  ë•Œ í•­ìƒ ìœ ì˜í•´ì•¼ í•¨.

------------------------------------------------------------------------

## (ìì—°)ë¡œê·¸ í•¨ìˆ˜: ê¸°ë³¸ ê°œë…

-   ë°ì´í„° ë¶„í¬ê°€ **í•œìª½ìœ¼ë¡œ ì¹˜ìš°ì¹œ ê²½ìš°(Skewed Distributions)**, ë¡œê·¸ë¥¼ ì·¨í•˜ë©´ ë” ì •ê·œ ë¶„í¬(Normal Distribution)ì— ê°€ê¹Œì›Œì§.

::::: columns
::: {.column width="50%"}
```{r, echo = FALSE, fig.height = 6}
data <- data.frame(x = rlnorm(1000, meanlog = log(100), sdlog = log(5)))

data %>%
  ggplot(aes(x = x)) +
  geom_density() +
  scale_x_continuous(labels = scales::comma) +
  theme_bw(base_size = 20)
```
:::

::: {.column width="50%"}
```{r, echo = FALSE, fig.height = 6}
data %>%
  ggplot(aes(x = log(x))) +
  geom_density() +
  scale_x_continuous(labels = scales::comma) +
  theme_bw(base_size = 20)
```
:::
:::::

------------------------------------------------------------------------

## ë¡œê·¸ ëª¨ë¸: ê°„ë‹¨í•œ í•´ì„

| ëª¨ë¸ | íšŒê·€ ëª¨ë¸ | $b_1$ í•´ì„ |
|-------------------|:--------------:|:----------------------------------:|
| **ìˆ˜ì¤€ - ìˆ˜ì¤€** | $y = b_0 + b_1 x + e$ | $x$ê°€ 1 ë‹¨ìœ„ ì¦ê°€í•˜ë©´, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $b_1$ ë‹¨ìœ„ ë³€í™” |
| **ë¡œê·¸ - ìˆ˜ì¤€** | $\log(y) = b_0 + b_1 x + e$ | $x$ê°€ 1 ë‹¨ìœ„ ì¦ê°€í•˜ë©´, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $b_1 \times 100$% ë³€í™” |
| **ìˆ˜ì¤€ - ë¡œê·¸** | $y = b_0 + b_1 \log(x)  + e$ | $x$ê°€ 1% ì¦ê°€í•˜ë©´, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $b_1 / 100$ ë‹¨ìœ„ ë³€í™” |
| **ë¡œê·¸ - ë¡œê·¸** | $\log(y) = b_0 + b_1 \log(x) + e$ | $x$ê°€ 1% ì¦ê°€í•˜ë©´, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $b_1$% ë³€í™” |

-   ì´ëŠ” í•´ì„ì€ [ìˆ˜í•™ì ìœ¼ë¡œ ì‰½ê²Œ ë„ì¶œ ê°€ëŠ¥](https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faqhow-do-i-interpret-a-regression-model-when-some-variables-are-log-transformed/)í•©ë‹ˆë‹¤.

-   âš ï¸ **ìœ„ í•´ì„ì€** $x$ì˜ ì‘ì€ ë³€í™”ì™€ $b_1$ì´ ì‘ì€ ê²½ìš°ì—ë§Œ ìœ íš¨: $x$ì˜ ë³€í™”ê°€ í´ ê²½ìš° ë˜ëŠ” $b_1$ ê°’ì´ í¬ë‹¤ë©´, í•´ì„ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ.

------------------------------------------------------------------------

## ë¡œê·¸ ëª¨ë¸: ì¼ë°˜ì ì¸ í•´ì„ {#gen_log}

$x$ì˜ ì„ì˜ì˜ ì¦ê°€ $\Delta x$ ì™€ ì„ì˜ì˜ $b_1$ì— ëŒ€í•´\
$(\Delta x = 5\% = 0.05 \implies 1 + \Delta x = 1.05)$

| ëª¨ë¸ | íšŒê·€ ëª¨ë¸ | $b_1$ í•´ì„ |
|-------------------|:--------------:|:----------------------------------:|
| **ìˆ˜ì¤€ - ìˆ˜ì¤€** | $y = b_0 + b_1 x + e$ | $x$ê°€ 1 ë‹¨ìœ„ ì¦ê°€í•˜ë©´, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $b_1$ ë‹¨ìœ„ ë³€í™” |
| **ë¡œê·¸ - ìˆ˜ì¤€** | $\log(y) = b_0 + b_1 x + e$ | $x$ê°€ 1 ë‹¨ìœ„ ì¦ê°€í•˜ë©´, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $(e^{b_1} - 1) \times 100$% ë³€í™” |
| **ìˆ˜ì¤€ - ë¡œê·¸** | $y = b_0 + b_1 \log(x)  + e$ | $\Delta x$% ì¦ê°€í•˜ë©´, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $b_1 \times \log(1 + \Delta x)$ ë‹¨ìœ„ ë³€í™” |
| **ë¡œê·¸ - ë¡œê·¸** | $\log(y) = b_0 + b_1 \log(x) + e$ | $\Delta x$% ì¦ê°€í•˜ë©´, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $((1 + \Delta x)^{b_1} - 1) \times 100$% ë³€í™” |

-   ìœ„ í•´ì„ì´ ì™œ ìœ íš¨í•œì§€ ì•Œê³  ì‹¶ë‹¤ë©´? [**ë¶€ë¡: ë¡œê·¸ ê·¼ì‚¬ (Appendix: Log Approximation)**](#log_approx) ì°¸ê³ 

------------------------------------------------------------------------

## ë¡œê·¸ ëª¨ë¸ì„ ì–¸ì œ ì‚¬ìš©í•´ì•¼ í• ê¹Œ?

1.  $x$ì™€ $y$ì˜ ê´€ê³„ê°€ ë¡œê·¸ ë˜ëŠ” ì§€ìˆ˜ í•¨ìˆ˜ì²˜ëŸ¼ ë³´ì´ëŠ” ê²½ìš°

::::: columns
::: {.column width="50%"}
```{r, echo = FALSE, fig.height = 6}
gapminder <- dslabs::gapminder

gapminder %>%
    filter(year == 2011) %>%
    ggplot(aes(x = gdp, y = life_expectancy)) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE) +
    scale_y_continuous(lim = c(40,100)) +
    labs(x = "GDP",
         y = "Life Expectancy",
         title = "Relationship between Life Expectancy and GDP in 2011",
         caption = "Data from gapminder data in dslabs package.") +
    theme_bw(base_size = 20) +
  theme(plot.title = element_text(size = 15))
```
:::

::: {.column width="50%"}
```{r, echo = FALSE, fig.height = 6}
gapminder %>%
    filter(year == 2011) %>%
    ggplot(aes(x = log(gdp), y = life_expectancy)) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE) +
    scale_y_continuous(lim = c(40,100)) +
    labs(x = "Log GDP",
         y = "Life Expectancy",
         title = "Relationship between Life Expectancy and log GDP in 2011",
         caption = "Data from gapminder data in dslabs package.") +
    theme_bw(base_size = 20) +
  theme(plot.title = element_text(size = 15))
```
:::
:::::

------------------------------------------------------------------------

## ë¡œê·¸ ëª¨ë¸ì„ ì–¸ì œ ì‚¬ìš©í•´ì•¼ í• ê¹Œ?

1.  $x$ì™€ $y$ì˜ ê´€ê³„ê°€ ë¡œê·¸ ë˜ëŠ” ì§€ìˆ˜ í•¨ìˆ˜ì²˜ëŸ¼ ë³´ì´ëŠ” ê²½ìš°

::::: columns
::: {.column width="50%"}
```{r, echo = FALSE, fig.height = 6}
gapminder <- dslabs::gapminder

gapminder %>%
    filter(year == 2011) %>%
    ggplot(aes(x = fertility, y = gdp)) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE) +
    scale_x_continuous(lim = c(0,8)) +
    labs(x = "Fertility Rate",
         y = "GDP",
         title = "Relationship between GDP and Fertility in 2011",
         caption = "Data from gapminder data in dslabs package.") +
    theme_bw(base_size = 20) +
  theme(plot.title = element_text(size = 15))
```
:::

::: {.column width="50%"}
```{r, echo = FALSE, fig.height = 6}
gapminder %>%
    filter(year == 2011) %>%
    ggplot(aes(x = fertility, y = log(gdp))) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE) +
    scale_x_continuous(lim = c(0,8)) +
    labs(x = "Fertility Rate",
         y = "GDP",
         title = "Relationship between log GDP and Fertility in 2011",
         caption = "Data from gapminder data in dslabs package.") +
    theme_bw(base_size = 20) +
  theme(plot.title = element_text(size = 15))
```
:::
:::::

------------------------------------------------------------------------

## ë¡œê·¸ ëª¨ë¸ì„ ì–¸ì œ ì‚¬ìš©í•´ì•¼ í• ê¹Œ?

1.  $x$ì™€ $y$ì˜ ê´€ê³„ê°€ **ë¡œê·¸ í•¨ìˆ˜** ë˜ëŠ” **ì§€ìˆ˜ í•¨ìˆ˜**ì²˜ëŸ¼ ë³´ì´ëŠ” ê²½ìš°

2.  <a href="https://en.wikipedia.org/wiki/Elasticity_(economics)">***íƒ„ë ¥ì„±(elasticity)***</a>ì„ ì‰½ê²Œ í•´ì„í•˜ê¸° ìœ„í•´

$x$ì— ëŒ€í•œ $y$ì˜ íƒ„ë ¥ì„±:\
$x$ê°€ **1% ì¦ê°€**í•  ë•Œ, $y$ê°€ **ëª‡ % ë³€í™”í•˜ëŠ”ì§€**ë¥¼ ë‚˜íƒ€ëƒ„

------------------------------------------------------------------------

## ë‹¤ë¥¸ í˜•íƒœì˜ ë¹„ì„ í˜• ê´€ê³„ë¥¼ ê³ ë ¤

$x$ì™€ $y$ì˜ ê´€ê³„ê°€ **ì§€ìˆ˜ í•¨ìˆ˜(exponential) ë˜ëŠ” ë¡œê·¸ í•¨ìˆ˜(logarithm)**ê°€ ì•„ë‹ˆë¼ë©´?

$\rightarrow$ ***ë‹¤í•­ íšŒê·€(polynomial regression)***: íšŒê·€ ë³€ìˆ˜ì— ë‹¤í•­ì‹ì„ ì ìš©!

------------------------------------------------------------------------

## ë‹¤í•­ì‹(polynomial)? ğŸ¤”

::::: columns
::: {.column width="50%"}
```{r, echo = FALSE, fig.height=6}
x <- runif(10000, min = -20, max = 20)
y = 2 + 3*x + 5*x^2

data <- data.frame(x = x, y = y)

data %>%
    ggplot(aes(x,y)) +
    geom_line() +
    annotate("text", x = 0, y = 1850, label = "y == 2 + 3 * x + 5 * x^2", parse = TRUE, size = 8) +
    labs(title = "Second Order Polynomial") +
    theme_bw(base_size = 20)
```
:::

::: {.column width="50%"}
```{r, echo = FALSE, fig.height=6}
x <- runif(10000, min = -20, max = 20)
y = 2 + 3*x - 10*x^2 - 5*x^3

data <- data.frame(x = x, y = y)

data %>%
    ggplot(aes(x,y)) +
    geom_line() +
    scale_y_continuous(labels = scales::comma) +
    annotate("text", x = 0, y = 28000, label = "y == 2 + 3 * x  - 10 * x^2 - 5 * x^3", parse = TRUE, size = 8) +
    labs(title = "Third Order Polynomial") +
    theme_bw(base_size = 20)
```
:::
:::::

------------------------------------------------------------------------

## ë‹¤í•­ì‹ íšŒê·€ (Polynomial Regressions)

-   ì‹œê°ì  ë˜ëŠ” ì˜ˆìƒë˜ëŠ” ê´€ê³„ì— ë”°ë¼ **íšŒê·€ì‹ì— ë†’ì€ ì°¨ìˆ˜ì˜ ë…ë¦½ ë³€ìˆ˜ë¥¼ ì¶”ê°€**

-   `R`ì—ì„œ ë‹¤í•­ì‹ íšŒê·€ ì‚¬ìš©ë²•

::::: columns
::: {.column width="50%"}
```{r, eval = F}
lm(y ~ x + I(x^2) + I(x^3), data)
```
:::

::: {.column width="50%"}
```{r, eval = F}
lm(y ~ poly(x, 3, raw = TRUE), data)
```
:::
:::::

------------------------------------------------------------------------

## ë‹¤í•­ì‹ íšŒê·€ (Polynomial Regressions)

::::: columns
::: {.column width="50%"}
***2ì°¨ ë‹¤í•­ì‹ íšŒê·€***

```{r, echo = FALSE, fig.height = 6}
gapminder <- dslabs::gapminder

gapminder %>%
    filter(year == 2011) %>%
    ggplot(aes(x = fertility, y = log(gdp))) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE, formula = y ~ poly(x, 2, raw = TRUE)) +
    scale_x_continuous(lim = c(0,8)) +
    labs(x = "ì¶œì‚°ìœ¨",
         y = "GDP",
         title = "2011ë…„ GDPì™€ ì¶œì‚°ìœ¨ì˜ ê´€ê³„",
         caption = "ì¶œì²˜: dslabs íŒ¨í‚¤ì§€ì˜ gapminder ë°ì´í„°") +
    theme_bw(base_size = 20) +
    theme(plot.title = element_text(size = 15))
```
:::

::: {.column width="50%"}
***3ì°¨ ë‹¤í•­ì‹ íšŒê·€***

```{r, echo = FALSE, fig.height = 6}
gapminder %>%
    filter(year == 2011) %>%
    mutate(log_gdp = log(gdp)) %>%
    ggplot(aes(x = log_gdp, y = life_expectancy)) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE, formula = y ~ poly(x, 3, raw = T)) +
    scale_y_continuous(lim = c(40,100)) +
    labs(x = "ë¡œê·¸ GDP",
         y = "ê¸°ëŒ€ ìˆ˜ëª…",
         title = "2011ë…„ ê¸°ëŒ€ ìˆ˜ëª…ê³¼ ë¡œê·¸ GDPì˜ ê´€ê³„",
         caption = "ì¶œì²˜: dslabs íŒ¨í‚¤ì§€ì˜ gapminder ë°ì´í„°") +
    theme_bw(base_size = 20) +
    theme(plot.title = element_text(size = 15))
```
:::
:::::

------------------------------------------------------------------------

## 

```{r, echo = F, out.height = "600px", out.width = "378px"}
knitr::include_graphics("chapter_regext_files/figure-html/curve_fitting.png") 
```

------------------------------------------------------------------------

## Task 1 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::

1.  ë°ì´í„°ë¥¼ [ì—¬ê¸°](https://www.dropbox.com/s/2v5mb04nzw2u7bd/college_tuition_income.csv?dl=1)ì—ì„œ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë¶ˆëŸ¬ì˜¤ì‹œì˜¤. ì´ ë°ì´í„°ì…‹ì€ ë¯¸êµ­ ëŒ€í•™ì˜ ë“±ë¡ê¸ˆê³¼ ì¡¸ì—…ìƒì˜ ì˜ˆìƒ ì†Œë“ ì •ë³´ë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤. ë°ì´í„°ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ [ì—¬ê¸°](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-03-10/readme.md)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŒ.

2.  ì˜ˆìƒ ì¤‘ê°„ ê²½ë ¥ ì†Œë“(`mid_career_pay`)ì„ ì¢…ì† ë³€ìˆ˜(ğ‘¦ì¶•)ë¡œ í•˜ê³ , ì£¼ ì™¸ ë“±ë¡ê¸ˆ(`out_of_state_tuition`)ì„ ë…ë¦½ ë³€ìˆ˜(ğ‘¥ì¶•)ë¡œ í•˜ëŠ” ì‚°ì ë„ë¥¼ ìƒì„±í•˜ì‹œì˜¤. ê´€ê³„ê°€ ëŒ€ì²´ë¡œ ì„ í˜•ì ì´ë¼ê³  ë³¼ ìˆ˜ ìˆëŠ”ê°€, ì•„ë‹ˆë©´ ë¹„ì„ í˜•ì ì¸ê°€? ì„ í˜• íšŒê·€ì„ ê³¼ 2ì°¨ ë‹¤í•­ íšŒê·€ì„ ì„ í•¨ê»˜ ì í•©í•˜ê¸° ìœ„í•´ `geom_smooth(method = "lm", se = F) + geom_smooth(method = "lm", se = F, formula = y ~ poly(x, 2, raw= T))`ì„ ì‚¬ìš©í•˜ì‹œì˜¤. ì´ë²ˆ ê²½ìš° ì–´ëŠ ëª¨ë¸ì´ ë” ì ì ˆí•œê°€?

3.  ì£¼ ì™¸ ë“±ë¡ê¸ˆì„ 1000ìœ¼ë¡œ ë‚˜ëˆˆ ìƒˆë¡œìš´ ë³€ìˆ˜ë¥¼ ìƒì„±í•˜ì‹œì˜¤. ì´ë¥¼ ì´ìš©í•˜ì—¬ ì˜ˆìƒ ì¤‘ê°„ ê²½ë ¥ ì†Œë“ì„ íšŒê·€ ë¶„ì„í•˜ì‹œì˜¤. íšŒê·€ ê³„ìˆ˜ë¥¼ í•´ì„í•˜ì‹œì˜¤.

4.  ì˜ˆìƒ ì¤‘ê°„ ê²½ë ¥ ì†Œë“ì„ ì£¼ ì™¸ ë“±ë¡ê¸ˆì„ 1000ìœ¼ë¡œ ë‚˜ëˆˆ ë³€ìˆ˜ì™€ ê·¸ ì œê³± í•­ì„ í¬í•¨í•˜ì—¬ íšŒê·€ ë¶„ì„í•˜ì‹œì˜¤. *íŒíŠ¸:* `poly(x, 2, raw = T)` ë˜ëŠ” `x + I(x^2)`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ. ì œê³± í•­ì˜ ê³„ìˆ˜ê°€ ì–‘ìˆ˜ë¼ëŠ” ê²ƒì€ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ê°€?

```{r, echo=FALSE, eval=FALSE}
ggplot(data, aes(x = out_of_state_tuition, y = mid_career_pay)) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE, colour = "blue") + # ì„ í˜• íšŒê·€ì„ 
    geom_smooth(method = "lm", se = FALSE, formula = y ~ poly(x, 2, raw=TRUE), colour = "red") # 2ì°¨ ë‹¤í•­ íšŒê·€ì„ 

data <- data %>%
    mutate(tuition_scaled = out_of_state_tuition / 1000)

lm(mid_career_pay ~ tuition_scaled, data = data)
lm(mid_career_pay ~ tuition_scaled + I(tuition_scaled^2), data = data)
lm(mid_career_pay ~ poly(tuition_scaled, 2, raw = TRUE), data = data)
```

# Interaction Terms

------------------------------------------------------------------------

## êµì°¨ ë³€ìˆ˜ (Interacting Regressors)

-   ***í•œ ë³€ìˆ˜ì˜ íš¨ê³¼ê°€ ë‹¤ë¥¸ ë³€ìˆ˜ì˜ ê°’ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ê²ƒ***ì´ë¼ê³  ê°€ì •í•˜ëŠ” ê²½ìš°.

    -   *ì˜ˆì œ:* êµìœ¡ ìˆ˜ì¤€ì´ ì„ê¸ˆì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ ì„±ë³„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ.

-   ë§Œì•½ $x_1$ê³¼ $x_2$ë¥¼ ìƒí˜¸ì‘ìš© ë³€ìˆ˜ë¡œ ì¶”ê°€í•œë‹¤ë©´, íšŒê·€ ëª¨í˜•ì„ ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¬:

$$y_i =  b_0 + b_1 x_{1,i} + b_2 x_{2,i} + b_3x_{1,i} \times x_{2,i} + ... + e_i$$

-   $b_1$, $b_2$, ê·¸ë¦¬ê³  $b_3$ì˜ í•´ì„ì€ $x_1$ê³¼ $x_2$ì˜ ìœ í˜•(ì—°ì†í˜• ë˜ëŠ” ë²”ì£¼í˜•)ì— ë”°ë¼ ë‹¬ë¼ì§.

-   ìš°ì„ , í•˜ë‚˜ì˜ ë…ë¦½ ë³€ìˆ˜ê°€ ***ë”ë¯¸(ë²”ì£¼í˜•) ë³€ìˆ˜***ì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ê°€ ***ì—°ì†í˜• ë³€ìˆ˜***ì¸ ê²½ìš°ë¥¼ ì‚´í´ë³´ê² ìŒ.

-   ì´ëŸ¬í•œ ê°œë…ì„ ìµíˆë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì—ë„ ì ìš© ê°€ëŠ¥:

    -   ë‘ ê°œì˜ ë…ë¦½ ë³€ìˆ˜ê°€ ëª¨ë‘ ë”ë¯¸(ë²”ì£¼í˜•) ë³€ìˆ˜ì¸ ê²½ìš°,

    -   ë‘ ê°œì˜ ë…ë¦½ ë³€ìˆ˜ê°€ ëª¨ë‘ ì—°ì†í˜• ë³€ìˆ˜ì¸ ê²½ìš°.

------------------------------------------------------------------------

## êµì°¨ ë³€ìˆ˜ (Interacting Regressors)

-   *STAR* ì‹¤í—˜ ë°ì´í„°: ì‘ì€ í•™ê¸‰ê³¼ ì¼ë°˜ í•™ê¸‰ì˜ íš¨ê³¼ëŠ” êµì‚¬ì˜ ê²½í—˜ì— ë”°ë¼ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ê°€?

-   íšŒê·€ ëª¨í˜•ì€ ë‹¤ìŒê³¼ ê°™ì´ ë³€í•¨:

$$ \textrm{score}_i = \color{#d96502}{b_0} + \color{#027D83}{b_1} \textrm{small}_i + \color{#02AB0D}{b_2} \textrm{experience}_i + \color{#d90502}{b_3} \textrm{small}_i \times \textrm{experience}_i + e_i$$

-   êµì‚¬ ê²½ë ¥ì´ 10ë…„ì¸ ê²½ìš° ì‘ì€ í•™ê¸‰ì˜ íš¨ê³¼ëŠ”?

$$
\mathbb{E}[\textrm{score}_i | \textrm{small}_i = 1 \textrm{ & experience}_i = 10] = \color{#d96502}{b_0} + \color{#027D83}{b_1} + \color{#02AB0D}{b_2}*10 + \color{#d90502}{b_3}*10
$$

$$
\mathbb{E}[\textrm{score}_i | \textrm{small}_i = 0 \textrm{ & experience}_i = 10] = \color{#d96502}{b_0} + \color{#02AB0D}{b_2}*10
$$

$$
\begin{split} 
\mathbb{E}[\textrm{score}_i &| \textrm{small}_i = 1 \textrm{ & experience}_i = 10] - \mathbb{E}[\textrm{score}_i | \textrm{small}_i = 0 \textrm{ & experience}_i = 10] \\ 
&= \color{#d96502}{b_0} + \color{#027D83}{b_1} + \color{#02AB0D}{b_2}*10 + \color{#d90502}{b_3}*10 - (\color{#d96502}{b_0} + \color{#02AB0D}{b_2}*10) \\ 
&= \color{#027D83}{b_1} + \color{#d90502}{b_3}*10 
\end{split}
$$

------------------------------------------------------------------------

## êµì°¨ ë³€ìˆ˜ (Interacting Regressors)

`math` ì ìˆ˜ì— ëŒ€í•œ íšŒê·€ ë¶„ì„ì„ ì‹¤í–‰í•œ ê²°ê³¼ (ëª¨ë“  í•™ë…„ í¬í•¨):

```{r, echo = FALSE}
star_df = read.csv("https://www.dropbox.com/s/bf1fog8yasw3wjj/star_data.csv?dl=1")
star_df = star_df %>% filter(star != "regular+aide")
star_df$small = star_df$star == "small"
star_df = star_df[complete.cases(star_df),]
```

```{r}
lm(math ~ small+ experience + small*experience, star_df)
```

***í•´ì„***

-   êµì°¨í•­ì€ ì‘ì€ í•™ê¸‰ì˜ íš¨ê³¼ê°€ êµì‚¬ì˜ ê²½í—˜ì— ë”°ë¼ ë‹¬ë¼ì§€ë„ë¡ í•¨.

-   ì‘ì€ í•™ê¸‰ì— ë°°ì •ë˜ëŠ” ê²ƒì´ math ì ìˆ˜ì— ê¸ì •ì ì¸ ì˜í–¥ì„ ì¤Œ.

-   ê·¸ëŸ¬ë‚˜ ì´ íš¨ê³¼ëŠ” êµì‚¬ì˜ ê²½í—˜ì´ ë§ì•„ì§ˆìˆ˜ë¡ ê°ì†Œí•¨.

------------------------------------------------------------------------

## êµì°¨ ë³€ìˆ˜: ì‹œê°í™”

$$ \textrm{score}_i = \color{#d96502}{b_0} + \color{#027D83}{b_1} \textrm{small}_i + \color{#02AB0D}{b_2} \textrm{experience}_i + \color{#d90502}{b_3} \textrm{small}_i * \textrm{experience}_i + e_i$$

```{r,echo=F, eval = F}
# graph_base <- star_df %>%
#     ggplot(aes(x = experience, y = math, group = small, color = small)) +
#     geom_point(alpha = 0.25) +
#     scale_color_viridis_d() +
#     scale_x_continuous(lim = c(-1,45), breaks = seq(0,40,10), expand = c(0,0)) +
#     theme_bw(base_size = 20) +
#     labs(x = "Teacher experience (in years)",
#          y = "Math score",
#          color = "Small class") +
#     theme(legend.position = c(1,0),
#           legend.justification = c(1,0),
#           legend.background = element_blank(),
#           legend.key = element_blank(),
#           legend.text = element_text(size = 12),
#           legend.title = element_text(size = 12, face = "italic"))
# graph_base
# ggsave("chapter_regext/chapter_regext_files/figure-html/graph_base.png", height = 5, width = 10)
```

```{r, echo = F, out.width = "90%"}
knitr::include_graphics("chapter_regext_files/figure-html/graph_base.png") 
```

------------------------------------------------------------------------

## êµì°¨ ë³€ìˆ˜: ì‹œê°í™”

$$ \textrm{score}_i = \color{#d96502}{b_0} + \color{#027D83}{b_1} \textrm{small}_i + \color{#02AB0D}{b_2} \textrm{experience}_i + \color{#d90502}{b_3} \textrm{small}_i * \textrm{experience}_i + e_i$$

```{r,echo=F, eval = F}
# graph_reg <- graph_base +
#     geom_smooth(method = "lm", se = F)
# graph_reg
# ggsave("chapter_regext/chapter_regext_files/figure-html/graph_reg.png", height = 5, width = 10)
```

```{r, echo = F, out.width = "90%"}
knitr::include_graphics("chapter_regext_files/figure-html/graph_reg.png") 
```

------------------------------------------------------------------------

## êµì°¨ ë³€ìˆ˜: ì‹œê°í™”

$$ \textrm{score}_i = \color{#d96502}{b_0} + \color{#027D83}{b_1} \textrm{small}_i + \color{#02AB0D}{b_2} \textrm{experience}_i + \color{#d90502}{b_3} \textrm{small}_i * \textrm{experience}_i + e_i$$

```{r,echo=F, eval = F}
# library(latex2exp)
# library(viridis)
# reg_coefs <- lm(math ~ small+ experience + small*experience, star_df)$coefficient
# b0 = reg_coefs[1]
# b1 = reg_coefs[2]
# b2 = reg_coefs[3]
# b3 = reg_coefs[4]
# 
# 
# graph_reg_b0 <- star_df %>%
#     ggplot(aes(x = experience, y = math, group = small, color = small)) +
#     geom_point(col = "transparent") + 
#     geom_smooth(method = "lm", se = F) +
#     geom_segment(aes(x = -1, xend = 0, y = b0, yend = b0), size = .5, linetype = 2, colour = viridis_pal()(2)[1]) +
#     scale_y_continuous(breaks = c(300,400,500,b0,600,700), labels = c("300","400","500",parse(text = TeX("$b_0$")),"600","700"), minor_breaks = seq(350,750,50)) +
#     scale_color_viridis_d() +
#     scale_x_continuous(lim = c(-1,45), breaks = seq(0,40,10), expand = c(0,0)) +
#     theme_bw(base_size = 20) +
#     labs(x = "Teacher experience (in years)",
#          y = "Math score",
#          color = "Small class") +
#     theme(legend.position = c(1,0),
#           legend.justification = c(1,0),
#           legend.background = element_blank(),
#           legend.key = element_blank(),
#           legend.text = element_text(size = 12),
#           legend.title = element_text(size = 12, face = "italic"),
#           axis.text.y = element_text(color = c("grey30", "grey30", "grey30", "#d96502", "grey30", "grey30")),
#           axis.ticks.y = element_line(color = c("grey30", "grey30", "grey30", "#d96502", "grey30", "grey30")),
#           panel.grid.minor = element_line(color = c("grey92", "grey92", "grey92", "grey92", "grey92")),
#           panel.grid.major.y = element_line(color = c("grey92", "grey92", "grey92", NA, "grey92", "grey92")))
# graph_reg_b0
# ggsave("chapter_regext/chapter_regext_files/figure-html/graph_reg_b0.png", height = 5, width = 10)
```

```{r, echo = F, out.width = "90%"}
knitr::include_graphics("chapter_regext_files/figure-html/graph_reg_b0.png") 
```

------------------------------------------------------------------------

## êµì°¨ ë³€ìˆ˜: ì‹œê°í™”

$$ \textrm{score}_i = \color{#d96502}{b_0} + \color{#027D83}{b_1} \textrm{small}_i + \color{#02AB0D}{b_2} \textrm{experience}_i + \color{#d90502}{b_3} \textrm{small}_i * \textrm{experience}_i + e_i$$

```{r,echo=F, eval = F}
# graph_reg_b0_b1 <- graph_reg_b0 +
#     geom_segment(aes(x = 0, xend = 0, y = b0, yend = b0 + b1), size = .5, linetype = 1, colour = "#027D83", arrow = arrow(length = unit(0.2, "cm"), ends = "both")) +
#     geom_curve(aes(x = 0.2, xend = 2, y = b0 + b1/2, yend = 580), size = .5, color = "#027D83", linetype = 1, arrow = arrow(length = unit(0.3, "cm"), end = "first")) +
#     annotate("text", x = 2, y = 585, hjust = 0, label = "b[1]", parse = TRUE, color = "#027D83", size = 6)
# graph_reg_b0_b1
# ggsave("chapter_regext/chapter_regext_files/figure-html/graph_reg_b0_b1.png", height = 5, width = 10)
```

```{r, echo = F, out.width = "90%"}
knitr::include_graphics("chapter_regext_files/figure-html/graph_reg_b0_b1.png") 
```

------------------------------------------------------------------------

## êµì°¨ ë³€ìˆ˜: ì‹œê°í™”

$$ \textrm{score}_i = \color{#d96502}{b_0} + \color{#027D83}{b_1} \textrm{small}_i + \color{#02AB0D}{b_2} \textrm{experience}_i + \color{#d90502}{b_3} \textrm{small}_i * \textrm{experience}_i + e_i$$

```{r,echo=F, eval = F}
# graph_reg_b0_b1_b2 <- graph_reg_b0_b1 +
#     geom_curve(aes(x = 15, xend = 20, y = b0 + b2*15 - 5, yend = 450), size = .5, color = "black", linetype = 1, arrow = arrow(length = unit(0.3, "cm"), end = "first")) +
#     annotate("text", x = 35.3, y = 450, label = "b[2]", color = "#02AB0D", hjust = 0,  parse = TRUE, size = 6) +
#     annotate("text", x = 20.5, y = 450, label = "Slope of the regular class line:", hjust = 0, size = 6)
# graph_reg_b0_b1_b2
# ggsave("chapter_regext/chapter_regext_files/figure-html/graph_reg_b0_b1_b2.png", height = 5, width = 10)
```

```{r, echo = F, out.width = "90%"}
knitr::include_graphics("chapter_regext_files/figure-html/graph_reg_b0_b1_b2.png") 
```

------------------------------------------------------------------------

## êµì°¨ ë³€ìˆ˜: ì‹œê°í™”

$$ \textrm{score}_i = \color{#d96502}{b_0} + \color{#027D83}{b_1} \textrm{small}_i + \color{#02AB0D}{b_2} \textrm{experience}_i + \color{#d90502}{b_3} \textrm{small}_i * \textrm{experience}_i + e_i$$

```{r,echo=F, eval = F}
# graph_reg_b0_b1_b2 +
#     geom_curve(aes(x = 20, xend = 15, y = 650, yend = b0 + b1 + (b2+b3)*15 + 5), size = .5, color = "black", linetype = 1, arrow = arrow(length = unit(0.3, "cm"))) +
#     annotate("text", x = 34.5, y = 650, label = "b[2]", color = "#02AB0D", hjust = 0,  parse = TRUE, size = 6) +
#     annotate("text", x = 35.75, y = 650, label = "+", hjust = 0, size = 6) +
#     annotate("text", x = 36.5, y = 650, label = "b[3]", color = "#d90502", hjust = 0,  parse = TRUE, size = 6) +
#     annotate("text", x = 20.5, y = 650, label = "Slope of the small class line:", hjust = 0, size = 6)
# ggsave("chapter_regext/chapter_regext_files/figure-html/graph_reg_b0_b1_b2_b3.png", height = 5, width = 10)
```

```{r, echo = F, out.width = "90%"}
knitr::include_graphics("chapter_regext_files/figure-html/graph_reg_b0_b1_b2_b3.png") 
```

------------------------------------------------------------------------

## Task 2 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::

**CPS1985 ë°ì´í„° ë¶„ì„**

1.  `AER` íŒ¨í‚¤ì§€ì—ì„œ `CPS1985` ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œì˜¤.

2.  ë³€ìˆ˜ì˜ ì •ì˜ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ë„ì›€ë§ì„ ì°¸ì¡°í•˜ì‹œì˜¤: `?CPS1985`

3.  í•´ë‹¹ ë°ì´í„°ì—ì„œ ì‚¬ëŒë“¤ì´ **íŒŒíŠ¸íƒ€ì„** ë˜ëŠ” **í’€íƒ€ì„**ìœ¼ë¡œ ê·¼ë¬´í•˜ëŠ”ì§€ ì—¬ë¶€ê°€ ì¤‘ìš”í•œê°€? ê·¸ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€?

4.  `wage` ë³€ìˆ˜ì˜ ìì—° ë¡œê·¸ ê°’ì„ ì €ì¥í•˜ëŠ” `log_wage` ë³€ìˆ˜ë¥¼ ìƒì„±í•˜ì‹œì˜¤.

5.  `log_wage`ë¥¼ `gender`ì™€ `education`ì— ëŒ€í•´ íšŒê·€ ë¶„ì„ì„ ìˆ˜í–‰í•˜ê³  ì´ë¥¼ `reg1`ìœ¼ë¡œ ì €ì¥í•˜ì‹œì˜¤. ê° ê³„ìˆ˜ë¥¼ í•´ì„í•˜ì‹œì˜¤.

6.  `log_wage`ë¥¼ `gender`, `education` ë° `gender*education` (ìƒí˜¸ì‘ìš© ë³€ìˆ˜)ë¡œ íšŒê·€ ë¶„ì„ì„ ìˆ˜í–‰í•˜ê³  ì´ë¥¼ `reg2`ë¡œ ì €ì¥í•˜ì‹œì˜¤. ê° ê³„ìˆ˜ë¥¼ í•´ì„í•˜ì‹œì˜¤. **ì„±ë³„ ì„ê¸ˆ ê²©ì°¨ê°€ êµìœ¡ ìˆ˜ì¤€ì´ ì¦ê°€í• ìˆ˜ë¡ ì¤„ì–´ë“œëŠ”ê°€?**

7.  í•´ë‹¹ ìƒí˜¸ì‘ìš© íš¨ê³¼ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë‚˜íƒ€ë‚´ëŠ” ê·¸ë˜í”„ë¥¼ ìƒì„±í•˜ì‹œì˜¤. (*íŒíŠ¸:* `aes`ì—ì„œ `color = gender`ë¥¼ ì‚¬ìš©í•˜ê³ , `geom_smooth(method = "lm", se = F)`ë¥¼ í™œìš©í•˜ì—¬ ì„±ë³„ë³„ íšŒê·€ì„ ì„ ê·¸ë¦¬ì‹œì˜¤.)

# Standardized Regression

------------------------------------------------------------------------

## í‘œì¤€í™” íšŒê·€ ë¶„ì„ (Standardized Regression)

-   ë³€ìˆ˜ë¥¼ **í‘œì¤€í™”(standardizing)** í•œë‹¤ëŠ” ê²ƒì´ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ì§€ ì •ì˜í•´ ë³´ì.

> ***í‘œì¤€í™”***ë€ ë³€ìˆ˜ $z$ì˜ í‰ê· ì„ ë¹¼ê³ , ê·¸ ê°’ì„ ë³€ìˆ˜ì˜ í‘œì¤€í¸ì°¨ë¡œ ë‚˜ëˆ„ëŠ” ê²ƒì„ ì˜ë¯¸í•¨:

$$ z_i^{stand} = \frac{z_i - \bar z}{\sigma(z)}$$

-   ì—¬ê¸°ì„œ, $\bar z$ëŠ” $z$ì˜ í‰ê· ì´ê³ , $\sigma(z)$ëŠ” $z$ì˜ í‘œì¤€í¸ì°¨ë¥¼ ì˜ë¯¸í•¨. ì¦‰, $\sigma(z) = \sqrt{\textrm{Var}(z)}$.

-   ì´ì œ $z^{stand}$ëŠ” í‰ê· ì´ 0ì´ê³ , í‘œì¤€í¸ì°¨ê°€ 1ì´ ë¨, ì¦‰:

$$\overline{z^{stand}} = 0, \quad \sigma(z^{stand}) = 1$$

-   ì§ê´€ì ìœ¼ë¡œ í‘œì¤€í™”ëŠ” ***ë³€ìˆ˜ë“¤ì„ ë™ì¼í•œ ì²™ë„ë¡œ ë³€í™˜***í•˜ì—¬ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ í•´ì¤Œ.

-   ìš°ë¦¬ì˜ **í•™ê¸‰ ê·œëª¨(class size)ì™€ í•™ìƒ ì„±ê³¼(student performance)** ì˜ˆì œì—ì„œ í‘œì¤€í™”ë¥¼ ì‚¬ìš©í•˜ë©´:

    -   íš¨ê³¼ì˜ **í¬ê¸°(magnitude)** í•´ì„ì´ ì‰¬ì›Œì§€ê³ ,\
    -   **ê° ë³€ìˆ˜ì˜ ìƒëŒ€ì  ì¤‘ìš”ì„±**ì„ ë¹„êµí•  ìˆ˜ ìˆìŒ.

------------------------------------------------------------------------

## í‘œì¤€í™” íšŒê·€ ë¶„ì„: ì‹œê°í™”

```{r, echo = FALSE}
# í‘œì¤€ ì •ê·œ ë¶„í¬ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì—¬ ì‹œê°í™”
# ì›ë˜ ë°ì´í„° (í‘œì¤€í™” ì´ì „)
# nrom = data.frame(x = rnorm(100000, mean = 20, sd = 6))
# nrom <- nrom %>%
#     mutate(x_stand = scale(x))
# 
# mean = mean(nrom$x)
# sd = sd(nrom$x)
# mean_stand = mean(nrom$x_stand)
# sd_stand = sd(nrom$x_stand)
# 
# í‘œì¤€í™” ì „ ê·¸ë˜í”„ ì €ì¥
# nrom %>%
#     ggplot(aes(x = x)) +
#     geom_density() +
#     geom_vline(xintercept = mean, color = "#d90502") +
#     geom_vline(xintercept = mean + sd, linetype = 2, color = "#d96502") +
#     scale_x_continuous(breaks = c(0,10,20, round(mean+sd,0), 30, 40)) +
#     geom_segment(aes(x = 14, xend = 19, y = 0.005, yend = 0.005), size = .5, linetype = 1, colour = "#d90502", arrow = arrow(length = unit(0.2, "cm"))) +
#     annotate("text", x = 8.5, y = 0.005, hjust = 0, label = "mean", color = "#d90502", size = 6) +
#     geom_segment(aes(x = mean + 1, xend = mean + sd - 1, y = 0.005, yend = 0.005), size = .5, linetype = 1, colour = "#d96502", arrow = arrow(length = unit(0.2, "cm"), ends = "both")) +
#     annotate("text", x = mean + sd/2, y = 0.008, label = "1 SD", color = "#d96502", size = 6) +
#     labs(title = " Before standardizing") +
#     theme_bw(base_size = 20)
# ggsave("chapter_regext/chapter_regext_files/figure-html/graph_before.png", height = 7, width = 8)
# 
# í‘œì¤€í™” í›„ ê·¸ë˜í”„ ì €ì¥
# nrom %>%
#     ggplot(aes(x = x_stand)) +
#     geom_density() +
#     geom_vline(xintercept = mean_stand, color = "#d90502") +
#     geom_vline(xintercept = mean_stand + sd_stand, linetype = 2, color = "#d96502") +
#     scale_x_continuous(breaks = c(-2.5,0, round(mean_stand+sd_stand,0), 2.5)) +
#     geom_segment(aes(x = -1, xend = -.15, y = 0.04, yend = 0.04), size = .5, linetype = 1, colour = "#d90502", arrow = arrow(length = unit(0.2, "cm"))) +
#     annotate("text", x = -1.8, y = 0.04, hjust = 0, label = "mean", color = "#d90502", size = 5) +
#     geom_segment(aes(x = mean_stand + .1, xend = mean_stand + sd_stand - .1, y = 0.04, yend = 0.04), size = .5, linetype = 1, colour = "#d96502", arrow = arrow(length = unit(0.2, "cm"), ends = "both")) +
#     annotate("text", x = mean_stand + sd_stand/2, y = 0.06, label = "1 SD", color = "#d96502", size = 6) +
#     labs(x = "standardized x", title = "After standardizing") +
#     theme_bw(base_size = 20)
# ggsave("chapter_regext/chapter_regext_files/figure-html/graph_after.png", height = 7, width = 8)
```

:::: columns
:::{.column width="50%"}
```{r, echo = F}
knitr::include_graphics("chapter_regext_files/figure-html/graph_before.png")
```
:::

:::{.column width="50%"}

```{r, echo = F}
knitr::include_graphics("chapter_regext_files/figure-html/graph_after.png")
```
::: 
::::

------------------------------------------------------------------------

## í‘œì¤€í™” íšŒê·€ ë¶„ì„: ì‹œê°í™”

***ì¢…ì† ë³€ìˆ˜*** $y$ê°€ í‘œì¤€í™”ëœ ê²½ìš°: $\color{#d90502}{y^{stand}} = b_0 + \sum_{k=1}^Kb_kx_k +e$

-   $b_k$ëŠ” $x_k$ê°€ í•œ ë‹¨ìœ„ ì¦ê°€í•  ë•Œ $y^{stand}$ê°€ ì–¼ë§ˆë‚˜ ë³€í•˜ëŠ”ì§€ë¥¼ ë‚˜íƒ€ëƒ„.

-   $y^{stand}$ê°€ 1 ì¦ê°€í•˜ë©´ ì´ëŠ” $y$ê°€ **í•œ í‘œì¤€í¸ì°¨ë§Œí¼ ì¦ê°€**í•œë‹¤ëŠ” ì˜ë¯¸. ë”°ë¼ì„œ $b_k$ëŠ” $y$ **í‘œì¤€í¸ì°¨ì˜ ë¹„ìœ¨ë¡œì„œ** $y$ì˜ ë³€í™”ë¥¼ ì¸¡ì •í•¨.

***ì„¤ëª… ë³€ìˆ˜*** $x_k$ê°€ í‘œì¤€í™”ëœ ê²½ìš°: $y = b_0 + \sum_{k=1}^Kb_k\color{#d90502}{x_k^{stand}} +e$

-   $b_k$ëŠ” $x_k^{stand}$ê°€ í•œ ë‹¨ìœ„ ì¦ê°€í•  ë•Œ $y$ê°€ ì–¼ë§ˆë‚˜ ë³€í•˜ëŠ”ì§€ë¥¼ ë‚˜íƒ€ëƒ„.

-   $x_k^{stand}$ê°€ 1 ì¦ê°€í•˜ë©´ ì´ëŠ” $x_k$ê°€ í•œ í‘œì¤€í¸ì°¨ë§Œí¼ ì¦ê°€í•œë‹¤ëŠ” ì˜ë¯¸. ë”°ë¼ì„œ $b_k$ëŠ” $x_k$ê°€ í•œ í‘œì¤€í¸ì°¨ ì¦ê°€í•  ë•Œ ì˜ˆì¸¡ë˜ëŠ” $y$ì˜ ë³€í™”ë¥¼ ì¸¡ì •í•¨.

------------------------------------------------------------------------

## Task 3 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::

[í•™ë…„ë³„ ì„±ì  ë°ì´í„°](https://www.dropbox.com/s/wwp2cs9f0dubmhr/grade5.dta?dl=1): ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´ì„œëŠ” `haven` íŒ¨í‚¤ì§€ì˜ `read_dta()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©. ì•„ë˜ëŠ” í‰ê·  ìˆ˜í•™ ì‹œí—˜ ì ìˆ˜ë¥¼ ì „ì²´ ë…ë¦½ ë³€ìˆ˜ ì„¸íŠ¸ì— ëŒ€í•´ íšŒê·€ ë¶„ì„í•œ ê²°ê³¼:

```{r echo = FALSE}
grades = read_dta(file = "https://www.dropbox.com/s/wwp2cs9f0dubmhr/grade5.dta?dl=1")

reg_full <- lm(avgverb ~ classize + disadvantaged + school_enrollment + female + religious, grades)
reg_full$coefficients
```

1.  í‘œì¤€í™”ëœ ìˆ˜í•™ ì ìˆ˜ ë³€ìˆ˜ ìƒì„±: `avgmath_stand`ë¼ëŠ” ìƒˆë¡œìš´ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ í‘œì¤€í™”ëœ ìˆ˜í•™ ì ìˆ˜ë¥¼ ì €ì¥í•˜ì‹œì˜¤. scale() í•¨ìˆ˜ë¥¼ (mutateì™€ í•¨ê»˜) ì‚¬ìš©í•˜ê±°ë‚˜, ê¸°ë³¸ Rì„ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ê³„ì‚°í•  ìˆ˜ ìˆìŒ.

2.  í‘œì¤€í™”ëœ ìˆ˜í•™ ì ìˆ˜ë¥¼ ì¢…ì† ë³€ìˆ˜ë¡œ íšŒê·€ ë¶„ì„: í‘œì¤€í™”ëœ ìˆ˜í•™ ì ìˆ˜ë¥¼ ì¢…ì† ë³€ìˆ˜ë¡œ ì‚¬ìš©í•˜ì—¬ ì „ì²´ íšŒê·€ ë¶„ì„ì„ ìˆ˜í–‰í•˜ì‹œì˜¤. ê° ê³„ìˆ˜ì˜ í¬ê¸°ì™€ ì˜ë¯¸ë¥¼ í•´ì„í•˜ì‹œì˜¤.

3.  ì—°ì†í˜• ë…ë¦½ ë³€ìˆ˜ í‘œì¤€í™”: ê° ì—°ì†í˜• ë…ë¦½ ë³€ìˆ˜ì— ëŒ€í•´ `ë³€ìˆ˜ëª…_stand` í˜•íƒœì˜ í‘œì¤€í™”ëœ ë³€ìˆ˜ë¥¼ ë§Œë“œì‹œì˜¤. `religious` ë³€ìˆ˜ë¥¼ í‘œì¤€í™”í•˜ëŠ” ê²ƒì´ ì ì ˆí•œê°€?

4.  í‘œì¤€í™”ëœ ë…ë¦½ ë³€ìˆ˜ë¡œ íšŒê·€ ë¶„ì„: `avgmath_stand`ë¥¼ ì¢…ì† ë³€ìˆ˜ë¡œ í•˜ê³ , í‘œì¤€í™”ëœ ëª¨ë“  ë…ë¦½ ë³€ìˆ˜ ë° `religious`ë¥¼ í¬í•¨í•˜ì—¬ íšŒê·€ ë¶„ì„ì„ ìˆ˜í–‰í•˜ì‹œì˜¤. ê° ë…ë¦½ ë³€ìˆ˜ê°€ ìƒëŒ€ì ìœ¼ë¡œ ì–¼ë§ˆë‚˜ ì¤‘ìš”í•œì§€ ë…¼ì˜í•˜ì‹œì˜¤.

------------------------------------------------------------------------

## ë‹¤ìŒ ìˆ˜ì—… ì˜ˆê³ 

-   ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ” í•­ìƒ ì „ì²´ ëª¨ì§‘ë‹¨ì—ì„œ **í‘œë³¸**ì„ ì¶”ì¶œí•˜ì—¬ ì‘ì—…í•´ ì™”ìŒ.

-   ë§¤ë²ˆ ìƒˆë¡œìš´ í‘œë³¸ì„ ëª¨ì§‘ë‹¨ì—ì„œ ë‹¤ì‹œ ì¶”ì¶œí•œë‹¤ê³  ê°€ì •í•˜ë©´:

    -   ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì„ê¹Œ?

    -   ë‹¤ì‹œ ë§í•´, ìš°ë¦¬ì˜ ì¶”ì •ì¹˜(ë¶€í˜¸, í¬ê¸°)ê°€ ë‹¨ìˆœíˆ **ë¬´ì‘ìœ„ì„±ì— ì˜í•´ ê²°ì •ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒ**ì„ ì–¼ë§ˆë‚˜ í™•ì‹ í•  ìˆ˜ ìˆì„ê¹Œ?

-   ì´ëŸ¬í•œ ì§ˆë¬¸ë“¤ì— ëŒ€í•œ ë‹µì„ ì°¾ê¸° ìœ„í•´:

    -   **í‘œë³¸ ì¶”ì¶œ(sampling)** ê°œë…ì„ ì†Œê°œí•˜ê³ ,

    -   **í†µê³„ì  ì¶”ë¡ (statistical inference)**ì´ ë¬´ì—‡ì´ë©°, ì–´ë–»ê²Œ ìˆ˜í–‰í•˜ëŠ”ì§€ ì•Œì•„ë³¼ ê²ƒì„.

------------------------------------------------------------------------

## ğŸ” ì¸ê³¼ ê´€ê³„ë¥¼ ì°¾ì•„ê°€ëŠ” ê¸¸

âœ… ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ë‹¤ë£°ê¹Œ?: ì½ê¸°(Read), ì •ë¦¬(Tidy), ì‹œê°í™”(Visualize)...

âœ… ***ë³€ìˆ˜ê°„ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ ìš”ì•½í• ê¹Œ?*** ...ë‹¨ìˆœ / ë‹¤ì¤‘ ì„ í˜• íšŒê·€...ë¹„ì„ í˜•íšŒê·€, êµì°¨ë³€ìˆ˜...

âœ… ì¸ê³¼ ê´€ê³„(Causality)ë€ ë¬´ì—‡ì¸ê°€?

âŒ ì „ì²´ ëª¨ì§‘ë‹¨ì„ ê´€ì¸¡í•˜ì§€ ëª»í•˜ë©´ ì–´ë–»ê²Œ í• ê¹Œ?

âŒ ìš°ë¦¬ì˜ ì—°êµ¬ ê²°ê³¼ê°€ ë‹¨ìˆœí•œ ë¬´ì‘ìœ„(Randomness) ë•Œë¬¸ì¼ ìˆ˜ë„ ìˆì„ê¹Œ?

âŒ ì‹¤ì œë¡œ ì™¸ìƒì„±ì„ ì–´ë–»ê²Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆì„ê¹Œ?

------------------------------------------------------------------------


<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

::: {style="display: flex; justify-content: center; align-items: center; height: 70vh;"}
<h2 style="color: #ff6666; text-align: center; font-family: &#39;Pacifico&#39;, cursive; font-size: 50px;">

THE END!

</h2>
:::




# Appendix

---


## ë¡œê·¸ ëª¨ë¸: ê·¼ì‚¬ê°’  {#log_approx}

ì´ì „ì— ì œì‹œëœ ê·¼ì‚¬ê°’ë“¤ì´ ì™œ ì„±ë¦½í•˜ëŠ”ê°€?

***ë¡œê·¸-ë ˆë²¨ (Log-Level)***

**ì¼ë°˜ì ì¸ í•´ì„:**  $x$ê°€ **1 ë‹¨ìœ„ ì¦ê°€**í•  ë•Œ, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $(e^{b_1} - 1) \times 100$ **í¼ì„¼íŠ¸ ë³€í™”**í•¨.

**ë‹¨ìˆœ í•´ì„:**  $x$ê°€ **1 ë‹¨ìœ„ ì¦ê°€**í•  ë•Œ, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $b_1 \times 100$ **í¼ì„¼íŠ¸ ë³€í™”**í•¨.


- ì´ëŠ” ì‘ì€ ê°’ì˜ $b_1$ì— ëŒ€í•´ ë‹¤ìŒ ì‹ì´ ì„±ë¦½í•˜ê¸° ë•Œë¬¸: $e^{b_1} \approx 1 + b_1 \iff b_1 \approx e^{b_1} - 1$


$\rightarrow$ $b_1 = \color{#d90502}{0.04}$ì¼ ë•Œ, $e^{b_1} - 1 = e^{0.04} - 1 = `r round(exp(0.04) - 1,4)`$


$\rightarrow$ $b_1 = \color{#d90502}{0.5}$ì¼ ë•Œ,  $e^{b_1} - 1 = e^{0.5} - 1 = `r round(exp(0.5) - 1,4)`$

---


## ë¡œê·¸ ëª¨ë¸: ê·¼ì‚¬ê°’

ì´ì „ì— ì œì‹œëœ ê·¼ì‚¬ê°’ë“¤ì´ ì™œ ì„±ë¦½í•˜ëŠ”ê°€?

***ë ˆë²¨-ë¡œê·¸ (Level-Log)***

**ì¼ë°˜ì ì¸ í•´ì„:**  $x$ê°€ **$\Delta x$ í¼ì„¼íŠ¸ ì¦ê°€**í•  ë•Œ, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $b_1 \times log(1 + \Delta x)$ **ë‹¨ìœ„ ë³€í™”**í•¨.

**ë‹¨ìˆœ í•´ì„:**  $x$ê°€ **1% ì¦ê°€**í•  ë•Œ, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $b_1 / 100$ **ë‹¨ìœ„ ë³€í™”**í•¨.


- ì´ëŠ” ì‘ì€ ê°’ì˜ $\Delta x$ì— ëŒ€í•´ ë‹¤ìŒ ì‹ì´ ì„±ë¦½í•˜ê¸° ë•Œë¬¸:  $log(1 + \Delta x) \approx \Delta x$

$\rightarrow$ $\Delta x = \color{#d90502}{1\%}=0.01$ì¼ ë•Œ,  $log(1+\Delta x) = log(1.01) = `r round(log(1.01),2)`$  (ë”°ë¼ì„œ ë‹¨ìˆœ í•´ì„ì—ì„œ $/100$ì´ ì¶”ê°€ë¨)



$\rightarrow$ $\Delta x = \color{#d90502}{20\%}=0.20$ì¼ ë•Œ,  $log(1+\Delta x) = log(1.20) = `r round(log(1.20),2)`$

---


## ë¡œê·¸ ëª¨ë¸: ê·¼ì‚¬ê°’

ì´ì „ì— ì œì‹œëœ ê·¼ì‚¬ê°’ë“¤ì´ ì™œ ì„±ë¦½í•˜ëŠ”ê°€?

***ë¡œê·¸-ë¡œê·¸ (Log-Log)***

**ì¼ë°˜ì ì¸ í•´ì„:** $x$ê°€ **$\Delta x$ í¼ì„¼íŠ¸ ì¦ê°€**í•  ë•Œ, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $((1 + \Delta x)^{b_1} - 1) \times 100$ **í¼ì„¼íŠ¸ ë³€í™”**í•¨.

**ë‹¨ìˆœ í•´ì„:** $x$ê°€ **1% ì¦ê°€**í•  ë•Œ, í‰ê· ì ìœ¼ë¡œ $y$ëŠ” $b_1$ **í¼ì„¼íŠ¸ ë³€í™”**í•¨.



- ì´ëŠ” ì‘ì€ ê°’ì˜ $|b_1| \times \Delta x$ì— ëŒ€í•´ ë‹¤ìŒ ì‹ì´ ì„±ë¦½í•˜ê¸° ë•Œë¬¸:  $(1 + \Delta x)^{b_1} \approx 1 + b_1 \times \Delta x \iff b_1 \times \Delta x \times 100 \approx ((1 + \Delta x)^{b_1} - 1) \times 100$


$\rightarrow$ $\Delta x = \color{#d90502}{1\%}=0.01$ì´ê³  $b_1 = \color{#d90502}{0.5}$ì¼ ë•Œ,  
$((1+\Delta x)^{b_1} - 1) \times 100 = (1.01^{0.5} - 1) \times 100 = `r round(((1.01)^0.5 - 1) * 100,2)`$  

$\rightarrow$ $\Delta x = \color{#d90502}{10\%}=0.10$ì´ê³  $b_1 = \color{#d90502}{10}$ì¼ ë•Œ,  
$((1+\Delta x)^{b_1} - 1) \times 100= (1.1^{10} - 1) \times 100 = `r round(((1.10)^10 -1) * 100,2)`$

[ëŒì•„ê°€ê¸°](#gen_log)

