---
title: "FMB819: Rì„ ì´ìš©í•œ ë°ì´í„°ë¶„ì„"
subtitle: "<span style='font-size:1.5em; color:#a01616;'>Regression Inference</span>"
# date: "`r Sys.Date()`"
format:
  revealjs:
    slide-number: true
    # smaller: true
    scrollable: true
    chalkboard: true
    transition: fade
    transition-speed: fast
    #incremental: true
    #lib_dir: libs
    css: [default, "../css/kubs.css", "../css/kubs-fonts.css"]
    #nature:
      # beforeInit: ["../js/ru_xaringan.js"]
      #highlightStyle: github
      #highlightLines: true
      #countIncrementalSlides: false
    #  ratio: "16:9"
    # includes:
    #   in_header: "../libs/partials/header.html"
revealjs-plugins:
  - revealjs-text-resizer
---

```{r setup, include=FALSE,warning=FALSE,message=FALSE}
options(htmltools.dir.version = FALSE)

def.chunk.hook  <- knitr::knit_hooks$get("chunk")


knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  dev = "svg",
  cache = TRUE,
  fig.align = "center"
  #fig.width = 11,
  #fig.height = 5
)

knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})

# define vars
om = par("mar")
lowtop = c(om[1],om[2],0.1,om[4])

overwrite = FALSE

library(countdown)

# countdown style
countdown(
  color_border              = "#d90502",
  color_text                = "black",
  color_running_background  = "#d90502",
  color_running_text        = "white",
  color_finished_background = "white",
  color_finished_text       = "#d90502",
  color_finished_border     = "#d90502"
)

library(jtools)
```

------------------------------------------------------------------------

## Today's Agenda

-   ***íšŒê·€ í…Œì´ë¸” (regression table)*** ì™„ì „íˆ ì´í•´í•˜ê¸°

-   ***ì´ë¡  ê¸°ë°˜ (theory-based)*** vs. ***ì‹œë®¬ë ˆì´ì…˜ ê¸°ë°˜ (simulation-based)*** ì¶”ë¡  ë¹„êµ

-   ***ê³ ì „ì  íšŒê·€ ëª¨ë¸ (Classical Regression Model)*** ê°€ì •

-   ì‹¤ì¦ì  ì‘ìš© ì‚¬ë¡€:

    -   í•™ê¸‰ í¬ê¸°ì™€ í•™ìƒ ì„±ì·¨ë„
    -   ì„±ë³„ì— ë”°ë¥¸ êµìœ¡ì˜ ìˆ˜ìµë¥ 

------------------------------------------------------------------------

## í•™ê¸‰ í¬ê¸°ì™€ í•™ìƒ ì„±ì·¨ë„ {#star_again}

-   ***STAR*** ì‹¤í—˜ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ê³  ë‹¤ìŒì— ì§‘ì¤‘í•˜ê² ìŒ:

    -   *ì†Œê·œëª¨ í•™ê¸‰ (small)* ê³¼ *ì¼ë°˜ í•™ê¸‰ (regular)*
    -   *ìœ ì¹˜ì› (Kindergarten) í•™ë…„*

-   ë‹¤ìŒ íšŒê·€ ëª¨ë¸ì„ ê³ ë ¤í•˜ê³  OLSë¡œ ì¶”ì •:

$$ \text{math score}_i = b_0 + b_1 \text{small}_i + e_i$$

::::: columns
::: {.column width="50%"}
```{r, echo = TRUE}
library(tidyverse)

star_df = read.csv("https://www.dropbox.com/s/bf1fog8yasw3wjj/star_data.csv?dl=1")
star_df = star_df[complete.cases(star_df),]
star_df = star_df %>%
  filter(star %in% c("small","regular") &
           grade == "k") %>% 
  mutate(small = (star == "small"))
```
:::

::: {.column width="50%"}
```{r, echo = TRUE}
reg_star = lm(math ~ small, star_df)
reg_star
```
:::
:::::

-   í…Œë„¤ì‹œì—ì„œ ë‹¤ë¥¸ ë¬´ì‘ìœ„ í‘œë³¸ì„ ì„ íƒí•˜ì—¬ ì‹¤í—˜ì„ ë‹¤ì‹œ ìˆ˜í–‰í•˜ë©´, $b_1$ ê°’ì´ ë‹¤ë¥´ê²Œ ë‚˜ì˜¬ê¹Œ?

-   ë‹µì€ Yes, í•˜ì§€ë§Œ ì´ ì¶”ì •ê°’ì´ ì–¼ë§ˆë‚˜ ë‹¤ë¥´ê²Œ ë‚˜ì˜¬ ê°€ëŠ¥ì„±ì´ ìˆì„ê¹Œ?

------------------------------------------------------------------------

## íšŒê·€ ì¶”ë¡ : $b_k$ vs $\beta_k$

-   $b_0, b_1$ ëŠ” ìš°ë¦¬ê°€ í‘œë³¸ì—ì„œ ê³„ì‚°í•œ ***ì  ì¶”ì •ì¹˜ (point estimates)*** ì„.

    -   ë§ˆì¹˜ íŒŒìŠ¤íƒ€ ì˜ˆì œì—ì„œ ë³¸ í‘œë³¸ ë¹„ìœ¨ $\hat{p}$ ê³¼ ê°™ìŒ!

::::: columns
::: {.column width="50%"}
-   ì‚¬ì‹¤, ëª¨ë¸ì˜ ì˜ˆì¸¡ê°’ì€...

$$\hat{y} = b_0 + b_1 x_1$$
:::

::: {.column width="50%"}
... ì•Œ ìˆ˜ ì—†ëŠ” **ì§„ì§œ ëª¨ì§‘ë‹¨ íšŒê·€ì„ **ì— ëŒ€í•œ **ì¶”ì •ì¹˜**ì„.

$$y = \beta_0 + \beta_1 x_1$$
:::
:::::

ì—¬ê¸°ì„œ $\beta_0, \beta_1$ ëŠ” ê´€ì‹¬ ìˆëŠ” ***ëª¨ì§‘ë‹¨ ëª¨ìˆ˜ (population parameters)*** ì„.

-   ë³´í†µ $b_k$ ëŒ€ì‹  $\hat{\beta_k}$ ë¥¼ ì‚¬ìš©í•˜ê¸°ë„ í•˜ë©°, ë‘˜ ë‹¤ $\beta_k$ ì— ëŒ€í•œ í‘œë³¸ ì¶”ì •ì¹˜ë¥¼ ì˜ë¯¸í•¨.

-   ì´ì œ ìš°ë¦¬ê°€ ë°°ìš´ ***ì‹ ë¢°êµ¬ê°„ (confidence intervals)***, ***ê°€ì„¤ê²€ì • (hypothesis testing)***, ê·¸ë¦¬ê³  ***í‘œì¤€ì˜¤ì°¨ (standard errors)*** ë¥¼ í™œìš©í•˜ì—¬ $\hat{\beta_k}$ ì— ì ìš©í•´ ë³´ê² ìŒ!

------------------------------------------------------------------------

## íšŒê·€ í…Œì´ë¸” ì´í•´í•˜ê¸°

-   ë‹¤ìŒì€ `tidy` ì²˜ë¦¬ëœ íšŒê·€ ê²°ê³¼ì„:

```{r}
library(broom)
tidy(lm(math ~ small, star_df))
```

```{r echo=FALSE}
reg_summary_star_df = round(summary(reg_star)$coefficients,2)
coeff_star = coef(reg_star)
```

-   ì—¬ê¸°ì„œ ìƒˆë¡œìš´ 3ê°œì˜ ì—´ì´ ì¶”ê°€ë¨: `std.error`, `statistic`, `p.value`.

| Entry | Meaning |
|----------------------------------------|--------------------------------|
| `std. error` | $b_k$ ì˜ í‘œì¤€ì˜¤ì°¨ (standard error) |
| `statistic` | ê·€ë¬´ê°€ì„¤ $H_0:\beta_k = 0$ vs ëŒ€ë¦½ê°€ì„¤ $H_A:\beta_k \neq 0$ ì— ëŒ€í•œ ê²€ì • í†µê³„ëŸ‰ |
| `p.value` | ê·€ë¬´ê°€ì„¤ $H_0:\beta_k = 0$ vs ëŒ€ë¦½ê°€ì„¤ $H_A:\beta_k \neq 0$ ì— ëŒ€í•œ p-ê°’ |

-   `small` ë³€ìˆ˜ì˜ ê³„ìˆ˜ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°ê°ì˜ í•­ëª©ì„ ì´í•´í•´ë³´ì.

------------------------------------------------------------------------

## $b_k$ì˜ í‘œì¤€ ì˜¤ì°¨ (Standard Error)

> $b_k$ì˜ í‘œì¤€ ì˜¤ì°¨ (Standard Error of $b_k$): $b_k$ì˜ ìƒ˜í”Œë§ ë¶„í¬ì˜ í‘œì¤€ í¸ì°¨.

ìš°ë¦¬ê°€ ì‹¤í—˜ì„ 1,000ë²ˆ ë°˜ë³µí•˜ê³ , 1,000ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ í‘œë³¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•˜ì:

-   ê·¸ëŸ¬ë©´ 1,000ê°œì˜ íšŒê·€ë¶„ì„ì„ ì‹¤í–‰í•˜ê³ , $\beta_k$ì— ëŒ€í•œ 1,000ê°œì˜ ì¶”ì •ì¹˜ $b_k$ë¥¼ ì–»ê²Œ ë¨.

-   $b_k$ì˜ í‘œì¤€ ì˜¤ì°¨ëŠ” (*ë¬´í•œíˆ ë§ì€*) í‘œë³¸ì—ì„œ $b_k$ê°€ ì–¼ë§ˆë‚˜ ë³€ë™í• ì§€ë¥¼ ì •ëŸ‰í™”í•¨.

------------------------------------------------------------------------

## $b_\textrm{small}$ì˜ í‘œì¤€ ì˜¤ì°¨ (Standard Error)

-   íšŒê·€ í…Œì´ë¸”ì—ì„œ ì–»ì€ ê°’: $\hat{\textrm{SE}}(b_\textrm{small}) = `r reg_summary_star_df[2,2]`$

    -   ì—¬ê¸°ì„œ $\hat{\textrm{SE}}$ë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ”, ìš°ë¦¬ê°€ ì–»ì€ `r reg_summary_star_df[2,2]` ê°’ì´ í‘œë³¸ì—ì„œ ì¶”ì •ëœ í‘œì¤€ ì˜¤ì°¨ì´ê¸° ë•Œë¬¸ì„. ì‹¤ì œ í‘œì¤€ ì˜¤ì°¨ëŠ” ${\textrm{SE}}$ë¡œ í‘œí˜„ë¨.

    -   ì‹¤ì œ í‘œì¤€ ì˜¤ì°¨ ${\textrm{SE}}$ë¥¼ ì•Œê³  ì‹¶ì§€ë§Œ, ìš°ë¦¬ëŠ” ë‹¨ í•˜ë‚˜ì˜ í‘œë³¸ë§Œ ê°€ì§€ê³  ìˆìŒ!

-   ì´ì œ $b_\textrm{small}$ì˜ ìƒ˜í”Œë§ ë¶„í¬ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ì—¬, í‘œì¤€ ì˜¤ì°¨ê°€ ì–´ë–»ê²Œ ê³„ì‚°ë˜ëŠ”ì§€ í™•ì¸í•´ ë³´ì.

------------------------------------------------------------------------

## Task 1 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::

*ë…¹ìƒ‰ íŒŒìŠ¤íƒ€ ë¹„ìœ¨*ì˜ ìƒ˜í”Œë§ ë¶„í¬ë¥¼ ìƒì„±í–ˆë˜ ê²ƒì²˜ëŸ¼, $b_\textrm{small}$ì˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ë¥¼ ìƒì„±í•˜ê³ ì í•¨.

1.  [í•™ê¸‰ í¬ê¸°ì™€ í•™ìƒ ì„±ì·¨ë„](#star_again) **ìŠ¬ë¼ì´ë“œì—ì„œ ë°ì´í„° ë¡œë”© ë° ì •ë¦¬ ì½”ë“œ**ë¥¼ ë³µì‚¬í•˜ì—¬ ì‹¤í–‰í•˜ì‹œì˜¤.

2.  **`star_df`ì—ì„œ 1,000ê°œì˜ ìƒ˜í”Œì„ ì¶”ì¶œí•˜ì—¬** $b_\textrm{small}$ì˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ë¥¼ ìƒì„±í•˜ì‹œì˜¤. ì•„ë˜ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë¨:

```{r, echo=TRUE, eval=FALSE}
bootstrap_distrib <- star_df %>% 
    mutate(small=as.numeric(small)) %>% 
    specify(response = math, explanatory = small) %>%
    generate(reps = 1000, type = "bootstrap") %>%
    calculate(stat = "slope")
```

3.  ì´ ì‹œë®¬ë ˆì´ì…˜ëœ ìƒ˜í”Œë§ ë¶„í¬ë¥¼ ì‹œê°í™”í•˜ê³ , $b_\textrm{small}$ì˜ í‰ê· ê³¼ í‘œì¤€ ì˜¤ì°¨ë¥¼ ê³„ì‚°í•˜ì‹œì˜¤.

------------------------------------------------------------------------

## ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬

```{r, echo=FALSE, eval=TRUE,  fig.height = 4.25, fig.width = 8}
library(infer)
bootstrap_distrib = star_df %>% 
    mutate(small=as.numeric(small)) %>% 
    specify(formula = math ~ small) %>%
    generate(reps = 1000, type = "bootstrap") %>%
    calculate(stat = "slope")
se_simul = round(sd(bootstrap_distrib$stat),3)

bootstrap_distrib %>%
    ggplot(aes(x = stat)) +
    geom_histogram(boundary = 9, binwidth = 0.5, col = "white", fill = "#d90502") +
    labs(
        x = "Bootstrap sample slope estimate",
        y = "Frequency"
    ) +
    theme_bw(base_size = 14)
```

***í‘œì¤€ ì˜¤ì°¨ (Standard error)***: `r round(se_simul,2)` $\rightarrow$ í…Œì´ë¸”ì˜ ê°’ (r reg_summary_star_df\[2,2\])ê³¼ ë§¤ìš° ìœ ì‚¬í•¨!

-   í•˜ì§€ë§Œ ì •í™•íˆ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ” Rì´ ì‚¬ìš©í•˜ëŠ” ì´ë¡ ì  ì ‘ê·¼ë²• ëŒ€ì‹  ë¶€íŠ¸ìŠ¤íŠ¸ë© ë°©ë²•ì„ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì„.

------------------------------------------------------------------------

## íšŒê·€ë¶„ì„ ê²°ê³¼ ë‹¤ì‹œ í™•ì¸

```{r, echo=T}
library(broom)
tidy(lm(math ~ small, star_df))
```

-   std.error ì—´ì˜ ì˜ë¯¸ë¥¼ ì´í•´í–ˆìŒ.

-   ìœ„ì—ì„œ ë‹¤ìŒ ë‘ ê°œì˜ ì—´ì€ statisticê³¼ p.valueì„.

-   ì´ì „ ìˆ˜ì—…ì—ì„œ **ê°€ì„¤ ê²€ì • (hypothesis testing)**ì— ëŒ€í•´ ë°°ì› ìŒ.

-   í•˜ì§€ë§Œ ì´ ê°’ë“¤ì€ ì–´ë–¤ ê°€ì„¤ ê²€ì •ì— í•´ë‹¹í•˜ëŠ” ê²ƒì¼ê¹Œ?

------------------------------------------------------------------------

## $\beta_k = 0$ vs $\beta_k \neq 0$ ê²€ì •

-   ê¸°ë³¸ì ìœ¼ë¡œ íšŒê·€ ë¶„ì„ ì¶œë ¥ì€ ë‹¤ìŒê³¼ ê°™ì€ ê°€ì„¤ ê²€ì • ê²°ê³¼ë¥¼ ì œê³µí•¨:

$$\begin{align}H_0:& \beta_k = 0\\H_A:& \beta_k \neq 0\end{align}$$

-   ì´ë¥¼ í†µí•´ ì¢…ì† ë³€ìˆ˜(ê²°ê³¼ ë³€ìˆ˜)ì™€ ë…ë¦½ ë³€ìˆ˜(ì„¤ëª… ë³€ìˆ˜) ê°„ì— **ì‹¤ì œ ê´€ê³„**ê°€ ìˆëŠ”ì§€ í†µê³„ì ìœ¼ë¡œ ê²€ì •í•  ìˆ˜ ìˆìŒ.

-   ë§Œì•½ $H_0$ì´ ì°¸ì´ë¼ë©´, ì¢…ì† ë³€ìˆ˜ì™€ ë…ë¦½ ë³€ìˆ˜ ê°„ì— **ê´€ê³„ê°€ ì—†ìŒ**.

    -   ì´ ê²½ìš° $b_1 \neq 0$ì„ ê´€ì¸¡í•œ ê²ƒì€ ë‹¨ìˆœí•œ ìš°ì—°ì¼ ê°€ëŠ¥ì„±ì´ ìˆìŒ.

-   ë§Œì•½ $H_0$ì´ ê±°ì§“ì´ë¼ë©´, ë‘ ë³€ìˆ˜ ì‚¬ì´ì— **ì‹¤ì œ ê´€ê³„ê°€ ìˆìŒ**.

-   ***ì¤‘ìš”:*** ì´ ê²€ì •ì€ ***ì–‘ì¸¡ ê²€ì • (two-sided test)***ì„!

------------------------------------------------------------------------

## ê²€ì • í†µê³„ëŸ‰ê³¼ p-ê°’

-   ì´ì „ ê°•ì˜ì—ì„œ ì‚´í´ë³´ì•˜ë“¯ì´, ê°€ì„¤ ê²€ì •ì„ ìˆ˜í–‰í•˜ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•´ì•¼ í•¨:

    -   **ê²€ì • í†µê³„ëŸ‰** (`statistic`)ì˜ **í‘œë³¸ ë¶„í¬**ë¥¼ ìœ ë„í•˜ì—¬ ê·€ë¬´ ê°€ì„¤ $H_0$ì´ ì°¸ì¼ ë•Œì˜ *ê·€ë¬´ ë¶„í¬*ë¥¼ ìƒì„±í•¨.

    -   ê´€ì¸¡ëœ **ê²€ì • í†µê³„ëŸ‰**ì´ ì´ ê°€ìƒì˜ ì„¸ê³„ì—ì„œ ì–¼ë§ˆë‚˜ ê·¹ë‹¨ì ì¸ì§€ë¥¼ ì •ëŸ‰í™”í•¨.

-   *ê´€ì¸¡ëœ ê²€ì • í†µê³„ëŸ‰* (`statistic`)ì€ $\frac{b}{\hat{SE}(b)}$ë¡œ ê³„ì‚°ë¨.

    -   ì™œ ë‹¨ìˆœíˆ $b$ê°€ ì•„ë‹ˆë¼ ì´ ê³µì‹ì„ ì‚¬ìš©í•˜ëŠ”ê°€? ë‚˜ì¤‘ì— ì´ì— ëŒ€í•´ ì„¤ëª…í•  ì˜ˆì •.

::::: columns
::: {.column width="50%"}
```{r, echo=T}
observed_stat = reg_star$coefficients[2]/sd(bootstrap_distrib$stat)
round(observed_stat,2)
```
:::

::: {.column width="50%"}
-   í‘œì—ì„œ ì–»ì€ ê²€ì • í†µê³„ëŸ‰ `statistic` = `r reg_summary_star_df[2,3]`ê³¼ ë§¤ìš° ìœ ì‚¬í•¨.: .
:::
:::::

-   p-ê°’ì€ ê·€ë¬´ ë¶„í¬ì—ì„œ $\pm$ ê´€ì¸¡ëœ ê²€ì • í†µê³„ëŸ‰ ë°”ê¹¥ìª½ì˜ ë©´ì ì„ ì¸¡ì •í•¨.

-   ë§ˆì§€ë§‰ìœ¼ë¡œ, ì¼ë°˜ì ì¸ ìœ ì˜ ìˆ˜ì¤€ $\alpha$ = 0.1, 0.05, 0.01ì—ì„œ $H_0$ì„ ê¸°ê°í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•¨.

------------------------------------------------------------------------

## $\beta_\textrm{small} = 0$ vs $\beta_\textrm{small} \neq 0$ ê²€ì •

-   $\frac{b_\textrm{small}}{\hat{SE}(b_\textrm{small})}$ì˜ ê·€ë¬´ ë¶„í¬(null distribution)ë¥¼ ì‹œë®¬ë ˆì´ì…˜ì„ í†µí•´ ê·¼ì‚¬í™”í•  ê²ƒì„.

-   ë§Œì•½ ìˆ˜í•™ ì ìˆ˜ì™€ í•™ê¸‰ í¬ê¸° ì‚¬ì´ì— ê´€ê³„ê°€ ì—†ë‹¤ë©´, ì¦‰ $H_0$ê°€ ì°¸ì´ê³  $\beta_\textrm{small} = 0$ì´ë¼ë©´, `small` ê°’ì„ í•™ìƒë“¤ ì‚¬ì´ì—ì„œ **ì¬ë°°ì—´(reshuffling) / ìˆœì—´(permuting)** í•˜ë”ë¼ë„ ê²°ê³¼ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šì•„ì•¼ í•¨.

::::: columns
::: {.column width="50%"}
-   1,000ê°œì˜ ìˆœì—´ëœ ìƒ˜í”Œ ìƒì„± ë° $b_\textrm{small}$ ê³„ì‚°

```{r, echo=T}
null_distribution <- star_df %>% 
  mutate(small=as.numeric(small)) %>% 
  specify(formula = math ~ small) %>%
  hypothesize(null = "independence") %>% 
  generate(reps = 1000, type = "permute") %>% 
  calculate(stat = "slope")
```
:::

::: {.column width="50%"}
-   ê·€ë¬´ ê°€ì„¤ í•˜ì—ì„œ ê²€ì • í†µê³„ëŸ‰ $\frac{b_\textrm{small}}{\hat{SE}(b_\textrm{small})}$ ê³„ì‚°

```{r, echo=T}
null_distribution <- null_distribution %>%
  mutate(test_stat = stat/sd(bootstrap_distrib$stat))
```

-   ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ì—ì„œ $\hat{SE}(b_\textrm{small})$ ê°’ì€ `r round(sd(bootstrap_distrib$stat),2)`ë¡œ ê³„ì‚°ë˜ì—ˆìŒ.
:::
:::::

------------------------------------------------------------------------

## $\beta_\textrm{small} = 0$ vs $\beta_\textrm{small} \neq 0$ ê²€ì •

```{r echo=FALSE, fig.height = 4.75, fig.width = 8}
plot_null_distrib = null_distribution %>%
  ggplot(aes(x = test_stat)) +
  geom_histogram(binwidth = 0.2, col = "white", fill = "#d90502") +
  labs(x = "Test statistic under the null hypothesis",
       y = "Frequency",
       title = "Simulation-Based Null Distribution") +
  theme_bw(base_size = 14)
plot_null_distrib
```

------------------------------------------------------------------------

## $\beta_\textrm{small} = 0$ vs $\beta_\textrm{small} \neq 0$ ê²€ì •

```{r echo=FALSE, fig.height = 4.75, fig.width = 8}
plot_null_distrib +
  geom_vline(xintercept = observed_stat, size = 1.25) +
  annotate("text", x = 4.1, y = 75, label = "observed test statistic", size = 4)

```

-   ê·€ë¬´ ê°€ì„¤($H_0$)ì´ ì°¸ì¼ ë•Œ, $b_\textrm{small}$ = r coeff_star\[2\] ê°’ì„ ì–»ì„ í™•ë¥ ì€ ë§¤ìš° ë‚®ìŒ.

------------------------------------------------------------------------

## $\beta_\textrm{small} = 0$ vs $\beta_\textrm{small} \neq 0$ ê²€ì •

-   $H_0$ë¥¼ ê¸°ê°í• ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ê¸° ìœ„í•´, **ì–‘ì¸¡ ê²€ì •**ì„ ê³ ë ¤í•´ì•¼ í•¨.

-   ì¦‰, *ë” ê·¹ë‹¨ì ì¸ ê°’*ì´ë€ `r round(-observed_stat,3)`ë³´ë‹¤ ì‘ê±°ë‚˜ **ë˜ëŠ”** `r round(observed_stat,3)`ë³´ë‹¤ í° ê²½ìš°ë¥¼ ì˜ë¯¸í•¨.

------------------------------------------------------------------------

## $\beta_\textrm{small} = 0$ vs $\beta_\textrm{small} \neq 0$ ê²€ì •

```{r echo=FALSE, fig.height = 4.75, fig.width = 8}
plot_null_distrib +
  geom_vline(xintercept = observed_stat, size = 1.25) +
  geom_vline(xintercept = -observed_stat, size = 1.25)

```

-   p-valueëŠ”?

------------------------------------------------------------------------

## $\beta_\textrm{small} = 0$ vs $\beta_\textrm{small} \neq 0$ ê²€ì •

-   ê·€ë¬´ê°€ì„¤ (H_0)ì„ ê¸°ê°í• ì§€ ê²°ì •í•˜ë ¤ë©´, **ì–‘ì¸¡ ê²€ì •**ì„ ê³ ë ¤í•´ì•¼ í•¨.\
    *ë” ê·¹ë‹¨ì ì¸ ê°’*ì´ë€ `r round(-observed_stat,2)` ì´í•˜ì´ê±°ë‚˜ `r round(observed_stat,2)` ì´ìƒì„ ì˜ë¯¸í•¨.

-   *p-ê°’*ì„ ê³„ì‚°í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŒ:

```{r, echo=T}
p_value = mean(abs(null_distribution$test_stat) >= observed_stat)
p_value
```

-   ì´ ê°’ì€ íšŒê·€ ë¶„ì„ í‘œì— ë‚˜ì˜¤ëŠ” ê°’ê³¼ ë™ì¼í•¨.

-   ***ì§ˆë¬¸:*** 5% ìœ ì˜ìˆ˜ì¤€ì—ì„œ ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•  ìˆ˜ ìˆëŠ”ê°€?

------------------------------------------------------------------------

## $\beta_\textrm{small} = 0$ vs $\beta_\textrm{small} \neq 0$ ê²€ì •

-   ê·€ë¬´ê°€ì„¤ (H_0)ì„ ê¸°ê°í• ì§€ ê²°ì •í•˜ë ¤ë©´, **ì–‘ì¸¡ ê²€ì •**ì„ ê³ ë ¤í•´ì•¼ í•¨.\
    *ë” ê·¹ë‹¨ì ì¸ ê°’*ì´ë€ `r round(-observed_stat,2)` ì´í•˜ì´ê±°ë‚˜ `r round(observed_stat,2)` ì´ìƒì„ ì˜ë¯¸í•¨.

-   *p-ê°’*ì„ ê³„ì‚°í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŒ:

```{r, echo=T}
p_value = mean(abs(null_distribution$test_stat) >= observed_stat)
p_value
```

-   ì´ ê°’ì€ íšŒê·€ ë¶„ì„ í‘œì— ë‚˜ì˜¤ëŠ” ê°’ê³¼ ë™ì¼í•¨.

-   ***ë‹µ:***

    -   *p-ê°’*ì´ 0ì´ë¯€ë¡œ, ì–´ë–¤ ìœ ì˜ìˆ˜ì¤€ì—ì„œë„ (H_0)ë¥¼ ê¸°ê°í•  ìˆ˜ ìˆìŒ.\
        p-ê°’ì€ í•­ìƒ (\alpha)ë³´ë‹¤ ì‘ìŒ.

    -   ë‹¤ì‹œ ë§í•´, (b\_\textrm{small})ì€ **ì–´ë–¤ ìœ ì˜ìˆ˜ì¤€ì—ì„œë„ 0ê³¼ í†µê³„ì ìœ¼ë¡œ ë‹¤ë¦„**.

    -   ë˜í•œ (b\_\textrm{small})ì´ *í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•¨* (ì–´ë–¤ ìœ ì˜ìˆ˜ì¤€ì—ì„œë„) ë¼ê³  í•  ìˆ˜ ìˆìŒ.

# Regression Inference: Theory

------------------------------------------------------------------------

## íšŒê·€ ì¶”ë¡ : ì´ë¡ 

-   ì§€ê¸ˆê¹Œì§€ëŠ” ì‹œë®¬ë ˆì´ì…˜ ê¸°ë°˜ ì¶”ë¡ ì„ ì„¤ëª…í–ˆìŒ.

-   í•˜ì§€ë§Œ `R`ì˜ í†µê³„ íŒ¨í‚¤ì§€ì—ì„œ ì œê³µí•˜ëŠ” ê°’ë“¤ì€ ì´ë¡ ì  ë°©ë²•ìœ¼ë¡œ ì–»ì–´ì§„ ê²ƒì„.

-   ì´ë¡ ì  ì¶”ë¡ ì€ **ëŒ€í‘œë³¸ ê·¼ì‚¬**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•¨.

    -   í‘œë³¸ ë¶„í¬ê°€ ì ì ˆí•œ ë¶„í¬ë¡œ *ìˆ˜ë ´*í•¨ì„ ë³´ì¼ ìˆ˜ ìˆìŒ âŸ¶ ***ì¤‘ì‹¬ê·¹í•œì •ë¦¬***

-   ì´ì œ ì´ë¡  ê¸°ë°˜ ì ‘ê·¼ë²•ì„ ê°„ë‹¨íˆ ì‚´í´ë³´ê² ìŒ.

------------------------------------------------------------------------

## íšŒê·€ ì¶”ë¡ : ì´ë¡ 

-   ì´ë¡  ê¸°ë°˜ ì ‘ê·¼ë²•ì€ í•˜ë‚˜ì˜ ê¸°ë³¸ì ì¸ ê²°ê³¼ë¥¼ ì‚¬ìš©í•¨: í‘œë³¸ í†µê³„ëŸ‰ $\frac{b - \beta}{\hat{\textrm{SE}(b)}}$ ì€ í‘œë³¸ í¬ê¸°ê°€ ì»¤ì§ˆìˆ˜ë¡ ***í‘œì¤€ ì •ê·œ ë¶„í¬***ë¡œ *ìˆ˜ë ´*í•¨.

    -   $\hat{\textrm{SE}(b)}$ëŠ” $b$ì˜ í‘œì¤€í¸ì°¨ì— ëŒ€í•œ í‘œë³¸ ì¶”ì •ëŸ‰ì„.
    -   ì´ ê°’ì€ ì´ë¡ ì  ê³µì‹ì„ í†µí•´ ì–»ì–´ì§ ([ì—¬ê¸°ì„œ](https://scpoecon.github.io/ScPoEconometrics/std-errors.html#se-theory)ì—ì„œ í™•ì¸ ê°€ëŠ¥) í•˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ë‹¤ë£¨ì§€ ì•Šê² ìŒ.

-   ***í‘œì¤€ ì •ê·œ ë¶„í¬***ëŠ” í‰ê· ì´ 0ì´ê³  í‘œì¤€í¸ì°¨ê°€ 1ì¸ *ì •ê·œ ë¶„í¬*ì„.

-   ì—¬ê¸°ì„œëŠ” í‘œë³¸ ë¶„í¬ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•  í•„ìš”ê°€ ì—†ìŒ. ì´ë¡ ì ìœ¼ë¡œ ìœ ë„ëœ ë¶„í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹ ë¢°êµ¬ê°„ì„ êµ¬ì„±í•˜ê±°ë‚˜ ê°€ì„¤ ê²€ì •ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ.

-   ë§Œì•½ $\frac{b - \beta}{\hat{\textrm{SE}(b)}}$ê°€ ***í‘œì¤€ ì •ê·œ ë¶„í¬***ë¡œ *ìˆ˜ë ´*í•œë‹¤ë©´, $b$ëŠ” í‰ê· ì´ $\beta$ì´ê³  í‘œì¤€í¸ì°¨ê°€ $\hat{\textrm{SE}(b)}$ì¸ ***ì •ê·œ ë¶„í¬***ë¡œ ìˆ˜ë ´í•¨.

------------------------------------------------------------------------

## ì •ê·œë¶„í¬(Normal Distribution)

```{r, echo = FALSE, out.width = "850px"}
knitr::include_graphics("../img/photos/standard_normal_distrib.png")
```

------------------------------------------------------------------------

## ì´ë¡  ê¸°ë°˜ ì¶”ë¡ : ì‹ ë¢°êµ¬ê°„

-   95% ì‹ ë¢°êµ¬ê°„ì„ ì˜ˆë¡œ ë“¤ì–´ë³´ê² ìŒ.

-   $b$ì˜ í‘œë³¸ ë¶„í¬ê°€ ì •ê·œ ë¶„í¬ë¥¼ ë”°ë¥¸ë‹¤ê³  ê°€ì •í•˜ë©´, ì •ê·œ ë¶„í¬ì— ëŒ€í•œ ***95% ê·¼ì‚¬ ê·œì¹™***ì„ ì ìš©í•  ìˆ˜ ìˆìŒ.

-   ì •ê·œ ë¶„í¬ì—ì„œ 95%ì˜ ê°’ì´ í‰ê· ìœ¼ë¡œë¶€í„° ì•½ 2 í‘œì¤€í¸ì°¨(ì •í™•íˆëŠ” 1.96) ë‚´ì— ì¡´ì¬í•¨ì„ ì•Œê³  ìˆìŒ.

-   ë”°ë¼ì„œ, $\beta$ì— ëŒ€í•œ 95% ì‹ ë¢°êµ¬ê°„ì€ ë‹¤ìŒê³¼ ê°™ì´ ê³„ì‚°í•  ìˆ˜ ìˆìŒ:\
    $$
    \textrm{CI}_{95\%} = [ b \pm 1.96*\hat{\textrm{SE}}(b)]
    $$

::::: columns
::: {.column width="50%"}
```{r, echo=T}
tidy(lm(math ~ small, star_df),
     conf.int = TRUE, conf.level = 0.95) %>%
  filter(term == "smallTRUE") %>%
  select(term, conf.low, conf.high)
```
:::

::: {.column width="50%"}
```{r, echo=T}
bootstrap_distrib %>%
  summarise(
    lower_bound = 8.895 - 1.96*sd(stat),
    upper_bound = 8.895 + 1.96*sd(stat))
```
:::
:::::

-   ì ì ˆí•œ ì •ê·œ ë¶„í¬ì˜ ë¶„ìœ„ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´, ì´ë¥¼ ì‰½ê²Œ ì„ì˜ì˜ ì‹ ë¢°ìˆ˜ì¤€ìœ¼ë¡œ ì¼ë°˜í™”í•  ìˆ˜ ìˆìŒ.

------------------------------------------------------------------------

## Task 2 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 5, top = 0)`
:::

1.  Task 1ì—ì„œ ìƒì„±í•œ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ *í¼ì„¼íƒ€ì¼ ë°©ë²•*ìœ¼ë¡œ 95% ì‹ ë¢°êµ¬ê°„ì„ ê³„ì‚°í•˜ë¼.

2.  ì´ì „ ìŠ¬ë¼ì´ë“œì—ì„œ êµ¬í•œ ì‹ ë¢°êµ¬ê°„ê³¼ ì–¼ë§ˆë‚˜ ìœ ì‚¬í•œê°€?

------------------------------------------------------------------------

## ì‹ ë¢°êµ¬ê°„: ì‹œê°í™”

```{r, echo = FALSE, fig.width = 10, fig.height = 5.5}
ci_pctile = bootstrap_distrib %>%
    summarise(
        lower = quantile(stat, 0.025),
        upper = quantile(stat, 0.975)
    )

ci_stderror <- bootstrap_distrib %>%
  summarise(
    lower = 8.895 - 1.96*sd(stat),
    upper = 8.895 + 1.96*sd(stat))

ci_theory <- tidy(lm(math ~ small, star_df),
     conf.int = TRUE, conf.level = 0.95) %>%
  filter(term == "smallTRUE") %>%
  select(term, conf.low, conf.high)

bootstrap_distrib %>%
    ggplot(aes(x = stat)) +
    geom_histogram(boundary = 9, binwidth = 0.5, col = "white", fill = "#d90502") +
    labs(
        x = "Bootstrap sample slope estimate",
        y = "Frequency",
        title = "95% confidence interval computed with different methods",
        subtitle = "percentile (dashed), standard error (longdashed) and theory (solid)"
    ) +
  geom_vline(xintercept = c(ci_pctile$lower, ci_pctile$upper), linetype = "dashed", show.legend = TRUE) +
  geom_vline(xintercept = c(ci_stderror$lower, ci_stderror$upper), linetype = "longdash", show.legend = TRUE) +
  geom_vline(xintercept = c(ci_theory$conf.low, ci_theory$conf.high)) +
  theme_bw(base_size = 14)
```

------------------------------------------------------------------------

## ì´ë¡  ê¸°ë°˜ ì¶”ë¡ : ê°€ì„¤ ê²€ì •

-   ì´ë¡ ì ìœ¼ë¡œ, $\frac{b - \beta_k}{\hat{\textrm{SE}(b)}}$ ëŠ” í‘œì¤€ ì •ê·œ ë¶„í¬ë¡œ ìˆ˜ë ´í•¨.

-   ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´, ëª¨ë“  í†µê³„ ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ê²€ì •ì€ ë‹¤ìŒê³¼ ê°™ìŒ:

    $$
    \begin{align}
    H_0:& \beta_k = 0 \\
    H_A:& \beta_k \neq 0
    \end{align}
    $$

-   ë”°ë¼ì„œ, **ê·€ë¬´ê°€ì„¤** $H_0$ í•˜ì—ì„œ $\beta_k=0$ì´ê³ , ì´ë¡ ì ìœ¼ë¡œ í‘œë³¸ í†µê³„ëŸ‰ $\frac{b}{\hat{\textrm{SE}(b)}}$ ì˜ ë¶„í¬ê°€ í‘œì¤€ ì •ê·œ ë¶„í¬ë¥¼ ë”°ë¦„.

-   ì¦‰, *í‘œì¤€ ì •ê·œ ë¶„í¬*ê°€ ê²€ì • í†µê³„ëŸ‰ì˜ **ê·€ë¬´ ë¶„í¬**ê°€ ë¨.

-   í•´ë‹¹ ê²€ì •ì— ëŒ€í•œ ***p-ê°’***ì€ í‘œì¤€ ì •ê·œ ë¶„í¬ì—ì„œ$\pm$ ê´€ì¸¡ëœ ê°’ $\frac{b}{\hat{\textrm{SE}(b)}}$ ë°”ê¹¥ìª½ ì˜ì—­ì˜ ë©´ì ê³¼ ê°™ìŒ.

-   ì¼ë°˜ì ì¸ ê¸°ì¤€: *ì¶”ì •ê°’*ì´ ***í‘œì¤€ ì˜¤ì°¨ì˜ ë‘ ë°° ì´ìƒ***ì´ë©´ 5% ìœ ì˜ìˆ˜ì¤€ì—ì„œ ìœ ì˜í•¨. ì™œ ê·¸ëŸ°ê°€?

------------------------------------------------------------------------

## íšŒê·€ ë¶„ì„ í‘œ ì •ë¦¬

-   ì´ì œ íšŒê·€ ë¶„ì„ í‘œì˜ ëª¨ë“  êµ¬ì„± ìš”ì†Œë¥¼ ë°°ì› ìœ¼ë¯€ë¡œ, ì§ì ‘ ìƒì„±í•˜ê³  í•´ì„í•˜ëŠ” ë°©ë²•ì„ ìµí˜€ë³´ê² ìŒ!

```{r, echo=T, eval=FALSE}
reg_simple_math <- lm(math ~ small, data=star_df)
reg_gender_math <- lm(math ~ small + gender , data=star_df)
reg_simple_read <- lm(read ~ small, data=star_df)
reg_gender_read <- lm(read ~ small + gender , data=star_df)

export_summs(reg_simple_math, reg_gender_math, reg_simple_read, reg_gender_read,
             model.names = c("Math score", "Math Score",
                             "Reading score", "Reading score"),
             coefs=c("Intercept" = "(Intercept)",
                     "Small class" = "smallTRUE",
                     "Male gender" = "gendermale"))
```

------------------------------------------------------------------------

## íšŒê·€ ë¶„ì„ í‘œ ì •ë¦¬

```{r, eval=T, echo=F, results='asis'}
reg_simple_math <- lm(math ~ small, data=star_df)
reg_gender_math <- lm(math ~ small + gender , data=star_df)
reg_simple_read <- lm(read ~ small, data=star_df)
reg_gender_read <- lm(read ~ small + gender , data=star_df)

export_summs(reg_simple_math, reg_gender_math, reg_simple_read, reg_gender_read,
             model.names = c("Math score", "Math Score",
                             "Reading score", "Reading score"),
             coefs=c("Intercept" = "(Intercept)",
                     "Small class" = "smallTRUE",
                     "Male gender" = "gendermale"))
```

------------------------------------------------------------------------

## íšŒê·€ ë¶„ì„ í‘œ í•´ì„

```{r, echo = FALSE, out.width = "500px"}
knitr::include_graphics("reg_inference_files/figure-html/reg_table.png")
```

-   ê° ì—´ì€ í•˜ë‚˜ì˜ íšŒê·€ ë¶„ì„ì„ ë‚˜íƒ€ëƒ„. ì²« ë²ˆì§¸ íšŒê·€ ë¶„ì„ì—ì„œ ë‹¤ìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ:

    -   ê²°ê³¼ ë³€ìˆ˜ ì´ë¦„: [íŒŒë€ìƒ‰]{style="color: #2F528F;"}
    -   ì†Œê·œëª¨ í•™ê¸‰ì— ëŒ€í•œ ì¶”ì • ê³„ìˆ˜ $\hat{\beta_\textrm{small}}$: [ì´ˆë¡ìƒ‰]{style="color:#70AD47;"}
    -   ì¶”ì •ëœ í‘œì¤€ ì˜¤ì°¨: [ë…¸ë€ìƒ‰]{style="color: #FFC000;"}
    -   ê´€ì¸¡ì¹˜ ìˆ˜: [ë³´ë¼ìƒ‰]{style="color: #7030A0;"}
    -   ê²°ì •ê³„ìˆ˜ ($R^2$): [ë¹¨ê°„ìƒ‰]{style="color: #C00000;"}
    -   í‘œ í•˜ë‹¨ì˜ ë³„(\*)ì— ëŒ€í•œ í•´ì„

# Classical Regression Model

------------------------------------------------------------------------

## ê³ ì „ì  íšŒê·€ ëª¨í˜• (CRM)

-   ì¶”ë¡ ì´ ì´ë¡ ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ë“  ì‹œë®¬ë ˆì´ì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ë“ , ìœ íš¨í•œ ì¶”ë¡ ì„ ìœ„í•´ì„œëŠ” ëª‡ ê°€ì§€ ê°€ì •ì´ ì¶©ì¡±ë˜ì–´ì•¼ í•¨.

-   ì´ëŸ¬í•œ ê°€ì •ë“¤ì„ ë§Œì¡±í•˜ëŠ” ëª¨í˜•ì„ *ê³ ì „ì  íšŒê·€ ëª¨í˜•* (Classical Regression Model, CRM)ì´ë¼ê³  í•¨.

-   ë³¸ê²©ì ìœ¼ë¡œ ê°€ì •ì„ ì‚´í´ë³´ê¸° ì „ì—, íšŒê·€ ëª¨í˜•ì— ì ìš©í•˜ëŠ” ëª‡ ê°€ì§€ ì‘ì§€ë§Œ ì¤‘ìš”í•œ ìˆ˜ì • ì‚¬í•­ì„ í™•ì¸í•˜ê² ìŒ (\[*ë‹¨ìˆœì„ í˜•íšŒê·€ ê°•ì˜*\] ì°¸ì¡°).

-   ì´ë¯¸ í‘œë³¸ ì¶”ì •ëŸ‰ $b_k$ (ë˜ëŠ” $\hat{\beta_k}$)ì™€ ëª¨ì§‘ë‹¨ ëª¨ìˆ˜ $\beta_k$ì˜ ì°¨ì´ë¥¼ ì–¸ê¸‰í–ˆìŒ.

-   ê°™ì€ ë°©ì‹ìœ¼ë¡œ, í‘œë³¸ ì˜¤ì°¨ (*ì”ì°¨*, $e$)ì™€ ëª¨ì§‘ë‹¨ ëª¨í˜•ì˜ ì˜¤ì°¨í•­ $\varepsilon$ì„ êµ¬ë³„í•´ì•¼ í•¨.

    $$
    y_i = \beta_0 + \beta_1 x_{1,i} + ... + \beta_k x_{k,i} + \varepsilon_i
    $$

-   ê³ ì „ì  íšŒê·€ ëª¨í˜•ì€ **ì˜¬ë°”ë¥´ê²Œ ì§€ì •ëœ ì„ í˜• íšŒê·€**ì— ì ìš©ë¨. ì¦‰,

    -   ëª¨í˜•ì€ ê³„ìˆ˜ì— ëŒ€í•´ ì„ í˜•ì ì´ì–´ì•¼ í•˜ë©°,\
    -   ëª¨ë“  ê´€ë ¨ ë³€ìˆ˜ë¥¼ í¬í•¨í•´ì•¼ í•˜ê³ ,\
    -   ë³€ìˆ˜ë“¤ ê°„ ë‹¤ì¤‘ê³µì„ ì„±ì´ ì—†ì–´ì•¼ í•¨.

------------------------------------------------------------------------

## CRM ê°€ì •

1.  ***ê¸°ëŒ€ê°’ ë…ë¦½ì„± (Mean Independence):*** ì˜¤ì°¨ì˜ ì¡°ê±´ë¶€ í‰ê· ì´ 0ì´ì–´ì•¼ í•¨.\
    $$ E[\varepsilon | x] = 0 $$\
    ì´ëŠ” ë˜í•œ $$ Cov(\varepsilon, x) = 0 $$ ë¥¼ ì˜ë¯¸í•˜ë©°, ì¦‰ ì˜¤ì°¨í•­ê³¼ ì„¤ëª…ë³€ìˆ˜(ë“¤)ê°€ *ìƒê´€ì´ ì—†ì–´ì•¼* í•¨.

-   ì´ ê°€ì •ì„ ìœ„ë°˜í•˜ë©´ $\beta_k$ì˜ ì¶”ì •ê°’ì´ **í¸í–¥ë¨**.

------------------------------------------------------------------------

## ì˜¤ì°¨ ê¸°ëŒ€ê°’ ë…ë¦½ì„± Mean Independence of Error: E\[u \| small\] = ?

```{r, echo = FALSE, warning = FALSE, message = FALSE,fig.width=8,fig.height=5}
library(ggridges)
library(ggthemes)
library(viridis)

# Data work ------------------------------------------------------------------------------
# Set seed
set.seed(555)
# Sample size
n <- 1e5
# Exogenous
e_good <- tibble(
    x = runif(n = n, min = -1, max = 1),
    e = rnorm(n)
) %>% mutate(x = if_else(x < 0, FALSE, TRUE))
# Endogenous
e_bad <- tibble(
    x = runif(n = n, min = -1, max = 1),
    e = rnorm(n) + 2.5 * x
) %>% mutate(x = if_else(x < 0, FALSE, TRUE))

# Figures: Joint densities ---------------------------------------------------------------
# The joint plot: good
joint_good <- ggplot(data = e_good, aes(x = e)) +
    geom_density() +
    theme_pander()
# The joint plot: bad
joint_bad <- ggplot(data = e_bad, aes(x = e)) +
    geom_density() +
    theme_pander()

# Figures: Conditional densities ---------------------------------------------------------
cond_good <- ggplot(data = e_good, aes(x = e, y = as.factor(x))) +
    geom_density_ridges_gradient(
        aes(fill = ..x..),
        color = "white",
        scale = 2.5,
        size = 0.2
    ) +
    # geom_vline(xintercept = 0, alpha = 0.3) +
    scale_fill_viridis(option = "magma") +
    scale_x_continuous(breaks = c(-4,4),limits = c(-6,6)) +
    xlab("u") +
    ylab("small class?") +
    theme_bw() +
    ggtitle("E[u | small] = 0") +
    theme(
        legend.position = "none"
    )
cond_bad <- ggplot(data = e_bad, aes(x = e, y = as.factor(x))) +
    geom_density_ridges_gradient(
        aes(fill = ..x..),
        color = "white",
        scale = 2.5,
        size = 0.2
    ) +
    # geom_vline(xintercept = 0, alpha = 0.3) +
    scale_fill_viridis(option = "magma") +
    scale_x_continuous(breaks = c(-4,4),limits = c(-6,6)) +
    xlab("u") +
    ylab("small class?") +
    ggtitle("E[u | small] != E[u | not small] != 0") +
    theme_bw() +
    theme(
        legend.position = "none"
    )

cond_good
```

------------------------------------------------------------------------

## ì˜¤ì°¨ ê¸°ëŒ€ê°’ ë…ë¦½ì„± Mean Independence of Error: E\[u \| small\] = ?

```{r, echo = FALSE,fig.width=8,fig.height=5}
cond_bad
```

------------------------------------------------------------------------

## ì™¸ìƒì„± (Exogeneity) ê°€ì •

-   CRM ê°€ì • #1ì€ (ì—„ê²©í•œ) **ì™¸ìƒì„± ê°€ì •**ì´ë¼ê³ ë„ ë¶ˆë¦¼.

-   ì´ ê°€ì •ì´ ìœ„ë°˜ë˜ë©´, ì¶”ì •ëŸ‰ $b$ëŠ” $\beta$ì˜ ***í¸í–¥ëœ*** ì¶”ì •ê°’ì´ ë¨, ì¦‰\
    $$ \mathop{\mathbb{E}}[b] \neq \beta $$

-   ì˜ˆë¥¼ ë“¤ì–´, êµìœ¡ì´ ì„ê¸ˆì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¶„ì„í•œë‹¤ê³  ê°€ì •í•˜ì.

    $$ \text{wage}_i = \beta_0 + \beta_1 \text{education}_i + \varepsilon_i $$

    -   ì™¸ìƒì„± ê°€ì •ì´ ì„±ë¦½í•˜ë©´, $\beta_1$ì€ ëª¨ì§‘ë‹¨ì—ì„œ êµìœ¡ì˜ ì¸ê³¼ì  íš¨ê³¼ë¥¼ ë‚˜íƒ€ëƒ„.

-   í•˜ì§€ë§Œ *ê´€ì°°ë˜ì§€ ì•Šì€* ëŠ¥ë ¥ $a_i$ê°€ ì¡´ì¬í•œë‹¤ê³  ê°€ì •í•˜ì.

    -   ë†’ì€ ëŠ¥ë ¥ì„ ê°€ì§„ ì‚¬ëŒì€ ë” ë†’ì€ ì„ê¸ˆì„ ë°›ì„ ê°€ëŠ¥ì„±ì´ í¼.
    -   ë˜í•œ, ëŠ¥ë ¥ì´ ë†’ìœ¼ë©´ í•™êµ ìƒí™œì´ ë” ì‰¬ì›Œì§€ê³ , ë”°ë¼ì„œ ë” ë§ì€ êµìœ¡ì„ ë°›ê²Œ ë  ê°€ëŠ¥ì„±ì´ ë†’ìŒ.

------------------------------------------------------------------------

## ì™¸ìƒì„± (Exogeneity) ê°€ì •

-   ëŠ¥ë ¥ $a_i$ëŠ” *ê´€ì°°ë˜ì§€ ì•Šê¸°* ë•Œë¬¸ì—, ì˜¤ì°¨í•­ $\varepsilon_i$ì— í¬í•¨ë¨.

-   ë”°ë¼ì„œ, *ê¸°íƒ€ ëª¨ë“  ì¡°ê±´ì´ ë™ì¼í•˜ë‹¤*ëŠ” ê°€ì • (*ceteris paribus*) ì´ ì„±ë¦½í•˜ì§€ ì•ŠìŒ.

-   ê·¸ëŸ¬ë©´ ì„ê¸ˆì„ êµìœ¡ ìˆ˜ì¤€ì— íšŒê·€ ë¶„ì„í•˜ë©´, ì‹¤ì œë¡œëŠ” ëŠ¥ë ¥ $a_i$ê°€ *ì›ì¸*ì´ ëœ ì„ê¸ˆ íš¨ê³¼ë¥¼ `education`ì˜ íš¨ê³¼ë¡œ ì˜ëª» ê·€ì†í•˜ê²Œ ë¨.

-   **ëˆ„ë½ëœ ë³€ìˆ˜ í¸í–¥ (Omitted Variable Bias, OVB)** ê³µì‹:

    $$ \text{OVB} = \text{ë‹¤ì¤‘ íšŒê·€ì—ì„œ ëˆ„ë½ëœ ë³€ìˆ˜ì˜ íšŒê·€ ê³„ìˆ˜} \times \frac{Cov(x,z)}{Var(x)} $$

-   ë”°ë¼ì„œ, ë‹¤ìŒì„ ì–»ìŒ:

    $$ \mathbb{E}(b_1) = \beta_1 + OVB > \beta_1 $$

-   **í•´ì„**: ëª¨ì§‘ë‹¨ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ í‘œë³¸ì„ ì¶”ì¶œí•˜ê³  ë§¤ë²ˆ $b_1$ì„ ê³„ì‚°í•˜ë©´, êµìœ¡ì´ ì„ê¸ˆì— ë¯¸ì¹˜ëŠ” íš¨ê³¼ë¥¼ **ì²´ê³„ì ìœ¼ë¡œ ê³¼ëŒ€í‰ê°€**í•˜ê²Œ ë¨.

------------------------------------------------------------------------

## CRM ê°€ì •

1.  ***ê¸°ëŒ€ê°’ ë…ë¦½ì„± (Mean Independence):*** ì˜¤ì°¨ì˜ ì¡°ê±´ë¶€ í‰ê· ì´ 0ì´ì–´ì•¼ í•¨.\
    $$ E[\varepsilon | x] = 0 $$\
    ì´ëŠ” ë˜í•œ $$ Cov(\varepsilon, x) = 0 $$ ë¥¼ ì˜ë¯¸í•˜ë©°, ì¦‰ ì˜¤ì°¨í•­ê³¼ ì„¤ëª…ë³€ìˆ˜(ë“¤)ê°€ *ìƒê´€ì´ ì—†ì–´ì•¼* í•¨.

-   ì´ ê°€ì •ì„ ìœ„ë°˜í•˜ë©´ $\beta_k$ì˜ ì¶”ì •ê°’ì´ **í¸í–¥ë¨**.

2.  ***ë…ë¦½ì ì´ê³  ë™ì¼í•œ ë¶„í¬ (Independently and Identically Distributed, i.i.d.):*** ë°ì´í„°ëŠ” í¬ê¸° $n$ì˜ **ëœë¤ í‘œë³¸**ì—ì„œ ì¶”ì¶œë¨. ê° ê´€ì¸¡ì¹˜ $(x_i, y_i)$ëŠ” ë™ì¼í•œ ë¶„í¬ì—ì„œ ë‚˜ì™”ìœ¼ë©°, ëª¨ë“  $i \neq j$ì— ëŒ€í•´ $(x_j, y_j)$ì™€ **ë…ë¦½ì **ì´ì–´ì•¼ í•¨.

    -   ì´ ê°€ì •ì„ ìœ„ë°˜í•˜ë©´ í‘œë³¸ì´ ëª¨ì§‘ë‹¨ì„ ëœ ëŒ€í‘œí•˜ê²Œ ë¨. ê²°ê³¼ì ìœ¼ë¡œ $\beta_k$ì˜ ì¶”ì •ê°’ì´ **í¸í–¥ë¨**.

------------------------------------------------------------------------

## CRM ê°€ì •

3.  ***ë“±ë¶„ì‚°ì„± (Homoskedasticity):*** ì˜¤ì°¨í•­ $\varepsilon$ì˜ ë¶„ì‚°ì´ ëª¨ë“  $x$ ê°’ì— ëŒ€í•´ ë™ì¼í•´ì•¼ í•¨. $$ Var(\varepsilon|x) = \sigma^2 $$

    -   ì´ ê°€ì •ì´ ìœ„ë°˜ë˜ë”ë¼ë„ $\beta_k$ì˜ ì¶”ì •ê°’ì€ ì—¬ì „íˆ í¸í–¥ë˜ì§€ ì•ŠìŒ. ê·¸ëŸ¬ë‚˜ $\hat{\textrm{SE}}(b_k)$ì˜ ì¶”ì •ê°’ì´ í¸í–¥ë  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ê²€ì • í†µê³„ëŸ‰ê³¼ p-ê°’ì— ì˜í–¥ì„ ë¯¸ì¹¨.

4.  ***ì •ê·œì„± ê°€ì • (Normally Distributed Errors):*** ì˜¤ì°¨í•­ì´ ì •ê·œ ë¶„í¬ë¥¼ ë”°ë¼ì•¼ í•¨. $\varepsilon \sim \mathcal{N}(0, \sigma^2)$

    -   ì—„ê²©íˆ í•„ìˆ˜ì ì¸ ê²ƒì€ ì•„ë‹ˆì§€ë§Œ, í‘œë³¸ í¬ê¸°ê°€ ì‘ì„ ë•Œë„ ì¶”ë¡ ì´ ê°€ëŠ¥í•˜ë„ë¡ ë„ì›€ì„ ì¤Œ.

ğŸ‘‰ **í•µì‹¬ ì •ë¦¬**: ê°€ì •ì´ ìœ„ë°˜ë˜ë©´, ì¶”ë¡ ì´ ìœ íš¨í•˜ì§€ ì•ŠìŒ!

------------------------------------------------------------------------

## Task 3-1 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::

ë‹¤ì‹œ êµìœ¡ê³¼ ì„±ë³„ì´ ì„ê¸ˆì— ë¯¸ì¹˜ëŠ” íš¨ê³¼ì— ëŒ€í•œ ì§ˆë¬¸ìœ¼ë¡œ ëŒì•„ê°€ ë³´ê² ìŒ.

1.  `AER` íŒ¨í‚¤ì§€ì—ì„œ `CPS1985` ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³ , ê° ë³€ìˆ˜ì˜ ì •ì˜ë¥¼ í™•ì¸í•˜ë¼: `?CPS1985`

```{r, eval=F}
library(AER)
data("CPS1985")
?CPS1985
```

1.  `wage`ì˜ ë¡œê·¸ ê°’ì„ `log_wage` ë³€ìˆ˜ë¡œ ìƒì„±í•˜ë¼.

```{r, eval=F}
CPS1985$log_wage <- log(CPS1985$wage)
```

1.  `log_wage`ë¥¼ `gender`ì™€ `education`ì— íšŒê·€ ë¶„ì„í•˜ê³ , ê²°ê³¼ë¥¼ `reg1`ìœ¼ë¡œ ì €ì¥í•˜ë¼.

```{r, eval=F}
reg1 <- lm(log_wage ~ gender + education, data = CPS1985)
summary(reg1)
```

-   ê° ê³„ìˆ˜ë¥¼ í•´ì„í•˜ë¼.
-   ê³„ìˆ˜ë“¤ì´ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œê°€? ì–´ëŠ ìœ ì˜ìˆ˜ì¤€ì—ì„œ ìœ ì˜í•œê°€?

1.  `log_wage`ë¥¼ `gender`, `education` ê·¸ë¦¬ê³  `gender*education`ì˜ ìƒí˜¸ì‘ìš© í•­ê³¼ í•¨ê»˜ íšŒê·€ ë¶„ì„í•˜ê³ , ê²°ê³¼ë¥¼ `reg2`ë¡œ ì €ì¥í•˜ë¼.

```{r, eval=F}
reg2 <- lm(log_wage ~ gender * education, data = CPS1985)
summary(reg2)
```

-   $female \times education$ì— í•´ë‹¹í•˜ëŠ” ê³„ìˆ˜ë¥¼ ì–´ë–»ê²Œ í•´ì„í•  ìˆ˜ ìˆëŠ”ê°€?
-   ì´ ê³„ìˆ˜ì˜ ê·€ë¬´ê°€ì„¤ì„ 5% ìœ ì˜ìˆ˜ì¤€ì—ì„œ ê¸°ê°í•  ìˆ˜ ìˆëŠ”ê°€? 10% ìœ ì˜ìˆ˜ì¤€ì—ì„œëŠ”?

------------------------------------------------------------------------

## Task 3-2 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::

1.  ë¡œê·¸ ì„ê¸ˆê³¼ êµìœ¡ ìˆ˜ì¤€ ê°„ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì‚°ì ë„ë¥¼ ìƒì„±í•˜ë¼.

```{r, eval=FALSE}
ggplot(CPS1985, aes(x = education, y = log_wage)) +
  geom_point()
```

2.  `geom_smooth`ë¥¼ ì‚¬ìš©í•˜ì—¬ *íšŒê·€ì„ *ì„ ì¶”ê°€í•˜ë¼. ì´ ì„ ì´ ë¬´ì—‡ì„ ë‚˜íƒ€ë‚´ëŠ”ê°€?

```{r, eval=FALSE}
ggplot(CPS1985, aes(x = education, y = log_wage)) +
  geom_point() +
  geom_smooth(method = "lm")
```

3.  ìŒì˜ ì˜ì—­ì´ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ì§€ ì„¤ëª…í•˜ë¼.

-   `cps` ë°ì´í„°ì—ì„œ í•˜ë‚˜ì˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© í‘œë³¸ì„ ì¶”ì¶œí•˜ë¼.

```{r, eval=FALSE}
set.seed(123)
cps_bootstrap <- CPS1985[sample(nrow(CPS1985), replace = TRUE), ]
```

-   `log_wage`ë¥¼ `gender`, `education`, ê·¸ë¦¬ê³  `gender*education`ì˜ ìƒí˜¸ì‘ìš© í•­ê³¼ í•¨ê»˜ íšŒê·€ ë¶„ì„í•˜ê³ , ê²°ê³¼ë¥¼ `reg_bootstrap`ìœ¼ë¡œ ì €ì¥í•˜ë¼.

```{r, eval=FALSE}
reg_bootstrap <- lm(log_wage ~ gender * education, data = cps_bootstrap)
```

-   `reg_bootstrap`ì—ì„œ ë‚¨ì„±ì˜ ì ˆí¸ ê°’ì„ `intercept_men_bootstrap`ìœ¼ë¡œ, ê¸°ìš¸ê¸° ê°’ì„ `slope_men_bootstrap`ìœ¼ë¡œ ì¶”ì¶œí•˜ì—¬ ì €ì¥í•˜ë¼. ì—¬ì„±ì˜ ê²½ìš°ë„ ë™ì¼í•˜ê²Œ ìˆ˜í–‰í•˜ë¼.

```{r, eval=FALSE}
intercept_men_bootstrap <- coef(reg_bootstrap)["(Intercept)"]
slope_men_bootstrap <- coef(reg_bootstrap)["education"]

intercept_women_bootstrap <- intercept_men_bootstrap + coef(reg_bootstrap)["genderfemale"]
slope_women_bootstrap <- slope_men_bootstrap + coef(reg_bootstrap)["education:genderfemale"]
```

-   ì´ì „ í”Œë¡¯ì— ì´ ë¶€íŠ¸ìŠ¤íŠ¸ë© í‘œë³¸ì—ì„œ ì˜ˆì¸¡ëœ ë‘ íšŒê·€ì„ ì„ ì¶”ê°€í•˜ë¼ (*íŒíŠ¸*: `geom_abline`ì„ ë‘ ë²ˆ ì‚¬ìš©í•˜ë¼).

```{r, eval=FALSE}
ggplot(CPS1985, aes(x = education, y = log_wage)) +
  geom_point() +
  geom_smooth(method = "lm") +
  geom_abline(intercept = intercept_men_bootstrap, slope = slope_men_bootstrap, color = "blue") +
  geom_abline(intercept = intercept_women_bootstrap, slope = slope_women_bootstrap, color = "red")
```

------------------------------------------------------------------------

## ë¶ˆí™•ì‹¤ì„± ì‹œê°í™”

::::: columns
::: {.column width="50%"}
ì´ì œ ë™ì¼í•œ ì ˆì°¨ë¥¼ 100ë²ˆ ë°˜ë³µí•´ ë³´ê² ìŒ!

```{r, echo=T, eval=FALSE}
library(AER)
data("CPS1985")
cps = CPS1985 %>% mutate(log_wage = log(wage))

set.seed(1)
bootstrap_sample = cps %>% 
    rep_sample_n(size = nrow(cps), reps = 100, replace = TRUE)

ggplot(data=cps,aes(y = log_wage, x = education, colour = gender)) +
  geom_point(size = 1, alpha = 0.7) +
  geom_smooth(method = "lm", alpha = 2) +
  geom_smooth(data=bootstrap_sample,
              size = 0.2,
              aes(y = log_wage, x = education, group = replicate),
              method = "lm", se = FALSE) +
  facet_wrap(~gender) +
  scale_colour_manual(values = c("darkblue", "darkred")) +
  labs(x = "Education", y = "Log wage") +
  guides(colour=FALSE) +
  theme_bw(base_size = 20)
```
:::

::: {.column width="50%"}
```{r,fig.height=7}
library(AER)
data("CPS1985")
cps = CPS1985 %>% mutate(log_wage = log(wage))

set.seed(1)
bootstrap_sample = cps %>% 
    rep_sample_n(size = nrow(cps), reps = 100, replace = TRUE)

ggplot(data=cps,aes(y = log_wage, x = education, colour = gender)) +
  geom_point(size = 1, alpha = 0.7) +
  geom_smooth(method = "lm", alpha = 2) +
  geom_smooth(data=bootstrap_sample,
              size = 0.2,
              aes(y = log_wage, x = education, group = replicate),
              method = "lm", se = FALSE) +
  facet_wrap(~gender) +
  scale_colour_manual(values = c("darkblue", "darkred")) +
  labs(x = "Education", y = "Log wage") +
  guides(colour=FALSE) +
  theme_bw(base_size = 20)
```
:::
:::::

------------------------------------------------------------------------

## ë¶ˆí™•ì‹¤ì„± ì‹œê°í™”

::::: columns
::: {.column width="50%"}
![](../img/gifs/wages.gif)
:::

::: {.column width="50%"}
</br>

[`ungeviz`](https://github.com/wilkelab/ungeviz)ì™€ `gganimate`ë¥¼ ì‚¬ìš©í•˜ë©´ ì›€ì§ì´ëŠ” ì„ ì„ ë§Œë“¤ ìˆ˜ ìˆìŒ!

-   ë°ì´í„°ì—ì„œ 20ê°œì˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© í‘œë³¸ì„ ì¶”ì¶œí–ˆìŒ.
-   ê° ë¶€íŠ¸ìŠ¤íŠ¸ë© í‘œë³¸ì— í¬í•¨ëœ ë°ì´í„° í¬ì¸íŠ¸ê°€ ë‹¤ë¦„ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ.
-   ì´ëŸ¬í•œ ì°¨ì´ëŠ” ì„œë¡œ ë‹¤ë¥¸ íšŒê·€ì„ ì„ ì˜ë¯¸í•¨.
-   í‰ê· ì ìœ¼ë¡œ, ì´ íšŒê·€ì„ ì˜ 95%ê°€ ìŒì˜ ì˜ì—­ ì•ˆì— í¬í•¨ë˜ì–´ì•¼ í•¨.
-   ìŒì˜ ì˜ì—­ì„ ë³¼ ë•Œ, ì´ ì›€ì§ì´ëŠ” ì„ ì„ ê¸°ì–µí•´ì•¼ í•¨!
:::
:::::

------------------------------------------------------------------------

## ğŸ” ì¸ê³¼ ê´€ê³„ë¥¼ ì°¾ì•„ê°€ëŠ” ê¸¸

âœ… ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ë‹¤ë£°ê¹Œ?: ì½ê¸°(Read), ì •ë¦¬(Tidy), ì‹œê°í™”(Visualize)...

âœ… ë³€ìˆ˜ê°„ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ ìš”ì•½í• ê¹Œ? ë‹¨ìˆœ / ë‹¤ì¤‘ ì„ í˜• íšŒê·€...ë¹„ì„ í˜•íšŒê·€, êµì°¨ë³€ìˆ˜...

âœ… ì¸ê³¼ ê´€ê³„(Causality)ë€ ë¬´ì—‡ì¸ê°€?

âœ… ì „ì²´ ëª¨ì§‘ë‹¨ì„ ê´€ì¸¡í•˜ì§€ ëª»í•˜ë©´ ì–´ë–»ê²Œ í• ê¹Œ? Sampling!

âœ… ***ìš°ë¦¬ì˜ ì—°êµ¬ ê²°ê³¼ê°€ ë‹¨ìˆœí•œ ë¬´ì‘ìœ„(Randomness) ë•Œë¬¸ì¼ ìˆ˜ë„ ìˆì„ê¹Œ?*** ì‹ ë¢°êµ¬ê°„ê³¼ ê°€ì„¤ê²€ì •. í†µê³„ì  ì¶”ë¡ 

âŒ ì‹¤ì œë¡œ ì™¸ìƒì„±ì„ ì–´ë–»ê²Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆì„ê¹Œ?

------------------------------------------------------------------------


<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

::: {style="display: flex; justify-content: center; align-items: center; height: 70vh;"}
<h2 style="color: #ff6666; text-align: center; font-family: &#39;Pacifico&#39;, cursive; font-size: 50px;">

THE END!

</h2>
:::
