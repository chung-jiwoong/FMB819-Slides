---
title: "FMB819: Rì„ ì´ìš©í•œ ë°ì´í„°ë¶„ì„"
subtitle: "<span style='font-size:1.5em; color:#a01616;'>Confidence Intervals and Hypothesis Testing</span>"
# date: "`r Sys.Date()`"
format:
  revealjs:
    slide-number: true
    # smaller: true
    scrollable: true
    chalkboard: true
    transition: fade
    transition-speed: fast
    #incremental: true
    #lib_dir: libs
    css: [default, "../css/kubs.css", "../css/kubs-fonts.css"]
    #nature:
      # beforeInit: ["../js/ru_xaringan.js"]
      #highlightStyle: github
      #highlightLines: true
      #countIncrementalSlides: false
    #  ratio: "16:9"
    # includes:
    #   in_header: "../libs/partials/header.html"
revealjs-plugins:
  - revealjs-text-resizer
---

```{r setup, include=FALSE,warning=FALSE,message=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  dev = "svg",
  cache = TRUE,
  fig.align = "center"
  #fig.width = 11,
  #fig.height = 5
)

# define vars
om = par("mar")
lowtop = c(om[1],om[2],0.1,om[4])

library(magrittr)
library(moderndive)
library(dplyr)
library(tidyverse)
library(infer)

library(countdown)

# countdown style
countdown(
  color_border              = "#d90502",
  color_text                = "black",
  color_running_background  = "#d90502",
  color_running_text        = "white",
  color_finished_background = "white",
  color_finished_text       = "#d90502",
  color_finished_border     = "#d90502"
)

overwrite = FALSE

```

------------------------------------------------------------------------

## Today's Agenda

-   *ì‹ ë¢° êµ¬ê°„(Confidence interval)*: ê°€ëŠ¥í•œ ***ê°’ì˜ ë²”ìœ„*** ì œê³µ

-   *ê°€ì„¤ ê²€ì •(Hypothesis testing*: ê·¸ë£¹ ê°„ í†µê³„ëŸ‰ ë¹„êµ

------------------------------------------------------------------------

## í˜„ì‹¤ì€?

-   ì‹¤ì œë¡œëŠ” ëª¨ì§‘ë‹¨ì—ì„œ ***ë‹¨ í•œ ê°œì˜ í‘œë³¸***ë§Œ ì¶”ì¶œí•  ìˆ˜ ìˆìŒ (***1000ê°œ***ê°€ ì•„ë‹˜!).

-   ë˜í•œ, ëª¨ì§‘ë‹¨ì˜ ***ì§„ì§œ ëª¨ìˆ˜***ë¥¼ ëª¨ë¥´ê¸° ë•Œë¬¸ì— ê·¸ê²ƒì„ ì¶”ì •í•˜ëŠ” ê²ƒì´ ëª©í‘œì„.

-   ê·¸ëŸ¼ ìš°ë¦¬ê°€ ë°©ê¸ˆ í–ˆë˜ ëª¨ë“  ê²ƒì€ ë¬´ìŠ¨ ì˜ë¯¸ê°€ ìˆì—ˆì„ê¹Œ? For fun?

<br>

-   ë¹„ë¡ ê´€ì°°í•  ìˆ˜ ì—†ì§€ë§Œ, ***í‘œë³¸ ë¶„í¬ëŠ” ì‹¤ì œë¡œ ì¡´ì¬***í•˜ë©°, ë” ë‚˜ì•„ê°€ ìš°ë¦¬ëŠ” ê·¸ê²ƒì´ ì–´ë–»ê²Œ í–‰ë™í•˜ëŠ”ì§€ ì•Œê³  ìˆìŒ!

-   ì´ì œ ì´ê²ƒì„ ì–´ë–»ê²Œ í™œìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì‚´í´ë³´ì...

# Confidence Intervals

------------------------------------------------------------------------

## ì  ì¶”ì •ì—ì„œ ì‹ ë¢° êµ¬ê°„ìœ¼ë¡œ

-   ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ” í‘œë³¸ì—ì„œ ***ì  ì¶”ì •ì¹˜***ë§Œì„ ê³„ì‚°í–ˆìŒ: *í‘œë³¸ í‰ê· *, *í‘œë³¸ ë¹„ìœ¨*, *íšŒê·€ ê³„ìˆ˜* ë“±.

-   ì´ ***í‘œë³¸ í†µê³„ëŸ‰***ì€ ***í‘œë³¸ ë³€ë™ì„±***ìœ¼ë¡œ ì¸í•´ ***ì§„ì§œ ëª¨ì§‘ë‹¨ ëª¨ìˆ˜***ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ.

-   ì  ì¶”ì •ì¹˜ ëŒ€ì‹ , ëª¨ì§‘ë‹¨ ëª¨ìˆ˜ì— ëŒ€í•œ ***ê°€ëŠ¥í•œ ê°’ì˜ ë²”ìœ„***ë¥¼ ì œê³µí•  ìˆ˜ë„ ìˆìŒ.

-   ì´ê²ƒì´ ë°”ë¡œ ***ì‹ ë¢° êµ¬ê°„*** (Confidence interval)ì´ ì œê³µí•˜ëŠ” ê²ƒì„.

------------------------------------------------------------------------

## ì‹ ë¢° êµ¬ê°„ êµ¬ì¶•

-   ì‹ ë¢° êµ¬ê°„ì„ êµ¬ì¶•í•˜ëŠ” ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ì´ ìˆìŒ:

    1.  *ì´ë¡ ì  ì ‘ê·¼*: ìˆ˜í•™ì  ê³µì‹ (***ì¤‘ì‹¬ ê·¹í•œ ì •ë¦¬***)ì„ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ì¡°ê±´ í•˜ì—ì„œ ì  ì¶”ì •ì¹˜ì˜ í‘œë³¸ ë¶„í¬ë¥¼ ìœ ë„í•¨ â†’ ***`R`ì´ ë‚´ë¶€ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë°©ì‹!***

    2.  *ì‹œë®¬ë ˆì´ì…˜ ì ‘ê·¼*: ***ë¶€íŠ¸ìŠ¤íŠ¸ë˜í•‘(Bootstrapping)*** ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì  ì¶”ì •ì¹˜ì˜ í‘œë³¸ ë¶„í¬ë¥¼ *ì¬êµ¬ì„±*í•¨

-   ìš°ë¦¬ëŠ” ê°œë…ì„ ì§ê´€ì ìœ¼ë¡œ ì´í•´í•˜ê¸° ìœ„í•´ ì‹œë®¬ë ˆì´ì…˜ì— ì´ˆì ì„ ë§ì¶œ ê²ƒì´ë©°, ìˆ˜í•™ì  ì ‘ê·¼ë²•ì€ ë‹¤ìŒì— ë‹¤ë£° ì˜ˆì •ì„.

-   ì‹¤ì œë¡œ, ì‹ ë¢° êµ¬ê°„ì„ ê³„ì‚°í•  ë•Œ ***ë¶€íŠ¸ìŠ¤íŠ¸ë˜í•‘ì„ ì§ì ‘ ìˆ˜í–‰í•  í•„ìš” ì—†ìŒ***. `R`ì´ í†µê³„ì  ì´ë¡ ì„ ì‚¬ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ ê³„ì‚°í•´ ì¤Œ.

------------------------------------------------------------------------

## ë‹¤ì‹œ íŒŒìŠ¤íƒ€ë¡œ ëŒì•„ê°€ê¸°

-   í˜„ì‹¤ì²˜ëŸ¼, ìš°ë¦¬ì˜ íŒŒìŠ¤íƒ€ ê·¸ë¦‡ì—ì„œ *ë‹¨ í•˜ë‚˜ì˜ ëœë¤ í‘œë³¸*ë§Œ ì–»ì„ ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•˜ì.

-   í‘œë³¸ ë³€ë™ì„±(sampling variation)ì„ ë‹¨ì¼ í‘œë³¸ìœ¼ë¡œ ì–´ë–»ê²Œ ì—°êµ¬í•  ìˆ˜ ìˆì„ê¹Œ?\
    `ğŸ‘‰` ***ë³µì›ì¶”ì¶œ(bootstrap resampling)***ì„ ì‚¬ìš©í•˜ë©´ ë¨!

-   ë¨¼ì €, ìš°ë¦¬ì˜ ê·¸ë¦‡ì—ì„œ í¬ê¸° $n = 50$ì¸ ë¬´ì‘ìœ„ í‘œë³¸ì„ í•˜ë‚˜ ì¶”ì¶œí•´ë³´ì.

```{r, echo = FALSE}
bowl <- read.csv("https://www.dropbox.com/s/qpjsk0rfgc0gx80/pasta.csv?dl=1")

set.seed(1234)

sample_size = 50

my_sample = bowl %>%
  mutate(color = as.factor(ifelse(color == "green","green","non-green"))) %>%
  rep_sample_n(size = sample_size) %>%
  ungroup() %>%
  select(pasta_ID, color) %>%
  arrange(pasta_ID)
```

```{r, echo=TRUE, eval = FALSE}
library(tidyverse)
bowl <- read.csv("https://www.dropbox.com/s/qpjsk0rfgc0gx80/pasta.csv?dl=1")

my_sample = bowl %>%
  mutate(color = ifelse(color == "green","green","non-green")) %>%
  rep_sample_n(size = 50) %>%
  ungroup() %>%
  select(pasta_ID, color)
```

::::: columns
::: {.column width="50%"}
```{r, echo=TRUE}
head(my_sample,3)
```
:::

::: {.column width="50%"}
```{r, echo=TRUE}
p_hat = mean(my_sample$color == "green")
p_hat
```

ì´ í‘œë³¸ì—ì„œ ë…¹ìƒ‰ íŒŒìŠ¤íƒ€ì˜ ë¹„ìœ¨ì€: $\hat{p} = `r p_hat`$.
:::
:::::

------------------------------------------------------------------------

## í‘œë³¸ ì¬ì¶”ì¶œ(Resampling)í•˜ê¸°

-   ***ë¶€íŠ¸ìŠ¤íŠ¸ë©(bootstrap) í‘œë³¸***ì„ ì–´ë–»ê²Œ ì–»ì„ ìˆ˜ ìˆì„ê¹Œ?

1.  í‘œë³¸ì—ì„œ ***í•˜ë‚˜ì˜*** íŒŒìŠ¤íƒ€ë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ íƒí•˜ê³  í•´ë‹¹ ìƒ‰ìƒì„ ê¸°ë¡í•œë‹¤.

2.  ì„ íƒí•œ íŒŒìŠ¤íƒ€ë¥¼ í‘œë³¸ì— ë‹¤ì‹œ ë„£ëŠ”ë‹¤.

3.  ìœ„ì˜ 1ë²ˆê³¼ 2ë²ˆ ê³¼ì •ì„ 49ë²ˆ ë°˜ë³µí•˜ì—¬, ***ìƒˆë¡œìš´ í‘œë³¸ì˜ í¬ê¸°ê°€ ì›ë˜ í‘œë³¸ê³¼ ë™ì¼í•´ì§ˆ ë•Œê¹Œì§€*** ì§„í–‰í•œë‹¤.

4.  ë¶€íŠ¸ìŠ¤íŠ¸ë© í‘œë³¸ì—ì„œ ë…¹ìƒ‰ íŒŒìŠ¤íƒ€ì˜ ë¹„ìœ¨ì„ ê³„ì‚°í•œë‹¤.

-   ì´ ê³¼ì •ì€ ***ë³µì›ì¶”ì¶œ(resampling with replacement)***ì´ë¼ê³  ë¶ˆë¦°ë‹¤.

    -   *ì¬ì¶”ì¶œ(resampling)*: í•˜ë‚˜ì˜ í‘œë³¸ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ìƒˆë¡œìš´ í‘œë³¸ì„ ì¶”ì¶œí•˜ëŠ” ê³¼ì •.
    -   *ë³µì›ì¶”ì¶œ(with replacement)*: í•œ ë²ˆ ì„ íƒëœ íŒŒìŠ¤íƒ€ë¥¼ ë‹¤ì‹œ ì›ë˜ í‘œë³¸ì— í¬í•¨ì‹œí‚¤ëŠ” ë°©ì‹.

------------------------------------------------------------------------

## í‘œë³¸ ì¬ì¶”ì¶œ(Resampling)í•˜ê¸°

::::: columns
::: {.column width="50%"}
-   í•˜ë‚˜ì˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© í‘œë³¸ ì˜ˆì‹œ

```{r echo=TRUE}
one_bootstrap = my_sample %>%
  rep_sample_n(size = 50, replace = TRUE) %>%
  arrange(pasta_ID)

head(one_bootstrap, 8)

nrow(one_bootstrap)
```
:::

::: {.column width="50%"}
-   ì™œ ê°™ì€ íŒŒìŠ¤íƒ€ê°€ ì—¬ëŸ¬ ë²ˆ ì„ íƒë ê¹Œ? ì—¬ëŸ¬ ê°œì˜ íŒŒìŠ¤íƒ€ê°€ ë°˜ë³µì ìœ¼ë¡œ ì„ íƒë˜ì—ˆë‹¤. ì™œ ê·¸ëŸ° ê±¸ê¹Œ?

-   ë¶€íŠ¸ìŠ¤íŠ¸ë© í‘œë³¸ì—ì„œ ë…¹ìƒ‰ íŒŒìŠ¤íƒ€ì˜ ë¹„ìœ¨ì„ ê³„ì‚°í•´ë³´ì.

```{r echo=TRUE}
mean(one_bootstrap$color == "green")
```

-   ì´ ë¹„ìœ¨ì€ ì›ë˜ í‘œë³¸ì—ì„œì˜ ë¹„ìœ¨ê³¼ ë‹¤ë¥´ë‹¤! ì´ëŠ” ë³µì›ì¶”ì¶œ(resampling with replacement) ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” í˜„ìƒì´ë‹¤.

-   ì´ ê³¼ì •ì„ ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ê°ê°ì˜ ë¹„ìœ¨ì´ í•­ìƒ ê°™ì„ê¹Œ?
:::
:::::

------------------------------------------------------------------------

## ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ ìƒì„±í•˜ê¸°

-   í‘œë³¸ ì¬ì¶”ì¶œ(ë¶€íŠ¸ìŠ¤íŠ¸ë©) ê³¼ì •ì„ 1,000ë²ˆ ë°˜ë³µí•˜ë©´,\
    1,000ê°œì˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© í‘œë³¸ê³¼ 1,000ê°œì˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© ì¶”ì •ê°’ì„ ì–»ì„ ìˆ˜ ìˆìŒ!

::::: columns
::: {.column width="50%"}
-   `infer` íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶€íŠ¸ìŠ¤íŠ¸ë© ìˆ˜í–‰

```{r, echo=FALSE}
bootstrap_distrib = my_sample %>% # take my random sample
  specify(response = color, success = "green") %>%
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "prop")

percentile_95ci = get_confidence_interval(bootstrap_distrib, level = 0.95, type = "percentile")
percentile_95lb = percentile_95ci[[1]]
percentile_95ub = percentile_95ci[[2]]

```

```{r, echo=TRUE, eval = FALSE}
library(infer)

bootstrap_distrib = my_sample %>%
  # specify the variable and level of interest
  specify(response = color, success = "green") %>% 
  # generate 1000 bootstrap samples 
  generate(reps = 1000, type = "bootstrap") %>% 
  # calculate the proportion of green pasta for each
  calculate(stat = "prop") 
```
:::

::: {.column width="50%"}
-   ë¶€íŠ¸ìŠ¤íŠ¸ë© ê²°ê³¼ í™•ì¸

```{r}
head(bootstrap_distrib)

nrow(bootstrap_distrib)
```

ë¶€íŠ¸ìŠ¤íŠ¸ë© í‘œë³¸ì˜ ë³€ë™ì„±ì„ ì‹œê°í™”í•´ë³´ì!
:::
:::::

------------------------------------------------------------------------

## ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬

```{r,echo = FALSE, fig.height = 4.75, fig.width = 8}
boot_distrib_plot = bootstrap_distrib %>%
  ggplot(aes(x = stat)) +
  geom_histogram(boundary = 0.39, binwidth = 0.02, col = "white", fill = "darkgreen") +
  labs(x = "Proportion of green pasta",
       y = "Frequency") +
  theme_bw(base_size = 14)
boot_distrib_plot
```

-   ***ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬***ëŠ” ***í‘œë³¸ ë¶„í¬***ë¥¼ ê·¼ì‚¬í•˜ëŠ” ì—­í• ì„ í•¨.

------------------------------------------------------------------------

## ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ì™€ í‰ê· 

```{r,echo = FALSE, fig.height = 4.75, fig.width = 8}
boot_distrib_plot +
  geom_vline(xintercept = mean(bootstrap_distrib$stat), linetype = "dashed", size = 1) +
  annotate("text", x = 0.375, y = 127, label = "bootstrap distribution mean", size = 4)
```

-   ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ì˜ í‰ê· ì€ ì›ë˜ í‘œë³¸ ë¹„ìœ¨ê³¼ ë§¤ìš° ê°€ê¹Œì›€.

------------------------------------------------------------------------

## ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ì™€ í‰ê· 

```{r,echo = FALSE, fig.height = 4.75, fig.width = 8}
boot_distrib_plot +
  geom_vline(xintercept = mean(bootstrap_distrib$stat), linetype = "dashed", size = 1) +
  annotate("text", x = 0.375, y = 127, label = "bootstrap distribution mean", size = 4)
```

-   ì´ì œ ì´ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ë¥¼ ì´ìš©í•´ ì‹ ë¢° êµ¬ê°„ì„ ë§Œë“¤ì–´ë³´ì!

------------------------------------------------------------------------

## ì‹ ë¢° êµ¬ê°„ ì´í•´í•˜ê¸°

-   ë‚šì‹œì— ë¹„ìœ :

    -   *ì  ì¶”ì •ì¹˜(point estimate)*: ì‘ì‚´ë¡œ ë¬¼ê³ ê¸°ë¥¼ ì¡ê¸°.

    -   *ì‹ ë¢° êµ¬ê°„(confidence interval)*: ê·¸ë¬¼ë¡œ ë¬¼ê³ ê¸°ë¥¼ ì¡ê¸°.

-   ì—¬ê¸°ì„œ ë¬¼ê³ ê¸°ëŠ” ì „ì²´ ê·¸ë¦‡ì—ì„œ ì´ˆë¡ìƒ‰ íŒŒìŠ¤íƒ€ì˜ ì‹¤ì œ ë¹„ìœ¨ $(p)$.

-   *ì  ì¶”ì •ì¹˜*ëŠ” í‘œë³¸ì—ì„œ ì–»ì€ ì´ˆë¡ìƒ‰ íŒŒìŠ¤íƒ€ì˜ ë¹„ìœ¨ $(\hat{p})$.

-   *ì‹ ë¢° êµ¬ê°„*: ì´ì „ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ì—ì„œ, ***ëŒ€ë¶€ë¶„ì˜ ë¹„ìœ¨ì´ ì–´ë””ì— ìœ„ì¹˜í•˜ëŠ”ê°€?***

-   ì‹ ë¢° êµ¬ê°„ì„ êµ¬ì„±í•˜ëŠ” ë°©ë²•: ***ë°±ë¶„ìœ„ìˆ˜(percentile) ë°©ë²•***.

-   ì‹ ë¢° ìˆ˜ì¤€ ***confidence level***ì„ ì§€ì •í•´ì•¼ í•¨: ì¼ë°˜ì ìœ¼ë¡œ 90%, 95%, 99% ì‚¬ìš©.

------------------------------------------------------------------------

## ë°±ë¶„ìœ„ìˆ˜ ë°©ë²•: 95% ì‹ ë¢° êµ¬ê°„

-   ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ì—ì„œ ì¤‘ì•™ 95%ì˜ ê°’ì„ ì‚¬ìš©í•˜ì—¬ ì‹ ë¢° êµ¬ê°„ì„ ìƒì„±.

-   ì´ë¥¼ ìœ„í•´ 2.5% ë° 97.5% ë°±ë¶„ìœ„ìˆ˜ë¥¼ ê³„ì‚°:

::::: columns
::: {.column width="50%"}
```{r, echo=TRUE}
quantile(bootstrap_distrib$stat,0.025)
```
:::

::: {.column width="50%"}
```{r, echo=TRUE}
quantile(bootstrap_distrib$stat,0.975)
```
:::
:::::

-   ë”°ë¼ì„œ 95% ì‹ ë¢° êµ¬ê°„ì€ $[`r round(percentile_95lb,2)` ; `r round(percentile_95ub,2)`]$.

-   ì´ëŠ” ê°’ì˜ ë²”ìœ„(range).

ì‹ ë¢° êµ¬ê°„ì„ í‘œë³¸ ë¶„í¬ì—ì„œ í™•ì¸í•´ ë³´ì.

------------------------------------------------------------------------

## ë°±ë¶„ìœ„ìˆ˜ ë°©ë²•: 95% ì‹ ë¢° êµ¬ê°„ ì‹œê°í™”

```{r,echo = FALSE,fig.height = 4.75, fig.width = 8}
percentile_95lb = quantile(bootstrap_distrib$stat,0.025)
percentile_95ub = quantile(bootstrap_distrib$stat,0.975)

boot_distrib_plot_ci = boot_distrib_plot +
  geom_vline(xintercept = percentile_95lb, linetype = "dashed", size = 1.5) +
  geom_vline(xintercept = percentile_95ub, linetype = "dashed", size = 1.5) +
  annotate("rect", xmin=percentile_95lb, xmax=percentile_95ub, ymin=0, ymax=Inf, fill = "#d90502", alpha=0.4)
boot_distrib_plot_ci
```

-   ì‹ ë¢° êµ¬ê°„ì´ ëª¨ì§‘ë‹¨ì˜ ì‹¤ì œ ë¹„ìœ¨ì„ í¬í•¨í•˜ëŠ”ê°€?

------------------------------------------------------------------------

## ë°±ë¶„ìœ„ìˆ˜ ë°©ë²•: 95% ì‹ ë¢° êµ¬ê°„ ì‹œê°í™”

```{r,echo = FALSE,fig.height = 4.75, fig.width = 8}
p = mean(bowl$color == "green")

boot_distrib_plot_ci +
  geom_vline(xintercept = p, col = "black", size = 1.25) +
  annotate("text", x = 0.56, y = 125, label = "population proportion", size = 4)
```

-   ëª¨ì§‘ë‹¨ì˜ ì‹¤ì œ ëª¨ìˆ˜ê°’ì´ 95% ì‹ ë¢° êµ¬ê°„ ë‚´ì— í¬í•¨ë¨! í•­ìƒ ê·¸ëŸ°ê°€?

------------------------------------------------------------------------

## 95% ì‹ ë¢° êµ¬ê°„ í•´ì„

-   `bowl`ì—ì„œ 100ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ í‘œë³¸ì„ ë°˜ë³µì ìœ¼ë¡œ ì¶”ì¶œí•˜ê³ , ê° í‘œë³¸ì— ëŒ€í•´ ë°±ë¶„ìœ„ìˆ˜ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ 95% ì‹ ë¢° êµ¬ê°„ì„ ê³„ì‚°í•¨.

```{r, echo=FALSE, fig.width=10, fig.height = 4}
library(purrr)
library(tidyr)
if(!file.exists("../rds/pasta_percentile_cis.rds")){
    set.seed(5)
    
    # Function to run infer pipeline
    bootstrap_pipeline <- function(sample_data){
        sample_data %>% 
            specify(formula = color ~ NULL, success = "green") %>% 
            generate(reps = 1000, type = "bootstrap") %>% 
            calculate(stat = "prop")
    }
    
    # Compute nested data frame with sampled data, sample proportions, all 
    # bootstrap replicates, and percentile_ci
    pasta_percentile_cis <- bowl %>% 
        mutate(color = as.factor(ifelse(color == "green","green","non-green"))) %>%
        rep_sample_n(size = 40, reps = 100, replace = FALSE) %>% 
        group_by(replicate) %>% 
        nest() %>% 
        mutate(sample_prop = map_dbl(data, ~mean(.x$color == "green"))) %>%
        # run infer pipeline on each nested tibble to generated bootstrap replicates
        mutate(bootstraps = map(data, bootstrap_pipeline)) %>% 
        group_by(replicate) %>% 
        # Compute 95% percentile CI's for each nested element
        mutate(percentile_ci = map(bootstraps, get_ci, type = "percentile", level = 0.95))
    
    # Save output to rds object
    saveRDS(object = pasta_percentile_cis, "../rds/pasta_percentile_cis.rds")
} else {
    pasta_percentile_cis <- readRDS("../rds/pasta_percentile_cis.rds")
}

# Identify if confidence interval captured true p
percentile_cis <- pasta_percentile_cis %>% 
    unnest(percentile_ci) %>% 
    mutate(captured = `2.5%` <= p & p <= `97.5%`)

# Plot them!
ggplot(percentile_cis) +
    geom_segment(aes(
        y = replicate, yend = replicate, x = `2.5%`, xend = `97.5%`, 
        alpha = factor(captured, levels = c("TRUE", "FALSE"))
    )) +
    # Removed point estimates since it doesn't necessarily act as center for 
    # percentile-based CI's
    # geom_point(aes(x = sample_prop, y = replicate, color = captured)) +
    labs(x = expression("Proportion of green pasta"), y = "Confidence interval number", 
         alpha = "Contains Truth") +
    geom_vline(xintercept = p, color = "#d90502", size = 1, linetype = "dashed") +
  annotate("text", x = 0.47, y = 5, label = "population proportion", col = "#d90502") +
    geom_point(aes(y = replicate, x = sample_prop ,alpha = factor(captured, levels = c("TRUE", "FALSE")))) +
    coord_cartesian(xlim = c(0.2, 0.8)) + 
  coord_flip() +
    theme_bw(base_size = 14) +
    theme(panel.grid.major.y = element_blank(), panel.grid.minor.y = element_blank(),
          panel.grid.minor.x = element_blank()) +
  theme(legend.position = "top")
```

-   ì–¼ë§ˆë‚˜ ë§ì€ ì‹ ë¢°êµ¬ê°„ì´ ì‹¤ì œ ëª¨ìˆ˜ê°’ì„ í¬í•¨í•˜ê³  ìˆëŠ”ê°€? ì™œ ê·¸ëŸ´ê¹Œ?

------------------------------------------------------------------------

## 95% ì‹ ë¢° êµ¬ê°„ í•´ì„

> ì •í™•í•œ í•´ì„: í‘œë³¸ì¶”ì¶œ ê³¼ì •ì„ ë§¤ìš° ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•œë‹¤ê³  ê°€ì •í•˜ë©´, ìƒì„±ëœ ì‹ ë¢°êµ¬ê°„ì˜ ***ì•½ 95%***ê°€ ëª¨ì§‘ë‹¨ì˜ ì°¸ëœ ëª¨ìˆ˜ë¥¼ í¬í•¨í•  ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë¨.

-   ì¦‰, 95% ì‹ ë¢°êµ¬ê°„ì€ 95%ì˜ í™•ë¥ ë¡œ ëª¨ì§‘ë‹¨ ëª¨ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ì‹ ë¢°êµ¬ê°„ì„ ë°˜ë³µì ìœ¼ë¡œ ìƒì„±í–ˆì„ ë•Œ, ì•½ 95%ì˜ ì‹ ë¢°êµ¬ê°„ì´ ëª¨ì§‘ë‹¨ ëª¨ìˆ˜ë¥¼ í¬í•¨í•  ê²ƒì„ ì˜ë¯¸í•¨.

> ê°„ë‹¨í•œ í•´ì„: ìš°ë¦¬ëŠ” ëª¨ì§‘ë‹¨ ëª¨ìˆ˜ë¥¼ í¬í•¨í•  ê°€ëŠ¥ì„±ì´ 95%ì¸ ì‹ ë¢°êµ¬ê°„ì„ ì–»ì—ˆë‹¤ê³  ë§í•  ìˆ˜ ìˆìŒ.

-   ***ì§ˆë¬¸:***

    -   ì‹ ë¢°ìˆ˜ì¤€ì´ ì¦ê°€í•˜ë©´ ì‹ ë¢°êµ¬ê°„ì˜ í­ì€ ì–´ë–»ê²Œ ë³€í• ê¹Œ?

    -   í‘œë³¸ í¬ê¸°ê°€ ì¦ê°€í•˜ë©´ ì‹ ë¢°êµ¬ê°„ì˜ í­ì€ ì–´ë–»ê²Œ ë³€í• ê¹Œ?

------------------------------------------------------------------------

## 95% ì‹ ë¢° êµ¬ê°„ í•´ì„

> ì •í™•í•œ í•´ì„: í‘œë³¸ì¶”ì¶œ ê³¼ì •ì„ ë§¤ìš° ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•œë‹¤ê³  ê°€ì •í•˜ë©´, ìƒì„±ëœ ì‹ ë¢°êµ¬ê°„ì˜ ***ì•½ 95%***ê°€ ëª¨ì§‘ë‹¨ì˜ ì°¸ëœ ëª¨ìˆ˜ë¥¼ í¬í•¨í•  ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë¨.

-   ì¦‰, 95% ì‹ ë¢°êµ¬ê°„ì€ 95%ì˜ í™•ë¥ ë¡œ ëª¨ì§‘ë‹¨ ëª¨ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ì‹ ë¢°êµ¬ê°„ì„ ë°˜ë³µì ìœ¼ë¡œ ìƒì„±í–ˆì„ ë•Œ, ì•½ 95%ì˜ ì‹ ë¢°êµ¬ê°„ì´ ëª¨ì§‘ë‹¨ ëª¨ìˆ˜ë¥¼ í¬í•¨í•  ê²ƒì„ ì˜ë¯¸í•¨.

> ê°„ë‹¨í•œ í•´ì„: ìš°ë¦¬ëŠ” ëª¨ì§‘ë‹¨ ëª¨ìˆ˜ë¥¼ í¬í•¨í•  ê°€ëŠ¥ì„±ì´ 95%ì¸ ì‹ ë¢°êµ¬ê°„ì„ ì–»ì—ˆë‹¤ê³  ë§í•  ìˆ˜ ìˆìŒ.

-   ***ì‹ ë¢°ìˆ˜ì¤€ì˜ ì˜í–¥:*** ì‹ ë¢°ìˆ˜ì¤€ì´ ì¦ê°€í• ìˆ˜ë¡ ì‹ ë¢°êµ¬ê°„ì€ ë” ë„“ì–´ì§.

    -   **ì§ê´€ì  ì´í•´:** ì‹ ë¢°ìˆ˜ì¤€ì´ ë†’ì•„ì§ˆìˆ˜ë¡, ì‹ ë¢°êµ¬ê°„ì´ ëª¨ì§‘ë‹¨ ëª¨ìˆ˜ë¥¼ í¬í•¨í•´ì•¼ í•˜ëŠ” ë¹ˆë„ê°€ ì¦ê°€í•´ì•¼ í•˜ë¯€ë¡œ, ì´ë¥¼ ë³´ì¥í•˜ê¸° ìœ„í•´ ì‹ ë¢°êµ¬ê°„ì´ ë” ë„“ì–´ì§.

-   ***í‘œë³¸ í¬ê¸°ì˜ ì˜í–¥:*** í‘œë³¸ í¬ê¸°ê°€ ì»¤ì§ˆìˆ˜ë¡ ì‹ ë¢°êµ¬ê°„ì€ ë” ì¢ì•„ì§.

    -   **ì§ê´€ì  ì´í•´:** í‘œë³¸ í¬ê¸°ê°€ ì»¤ì§ˆìˆ˜ë¡ í‘œë³¸ì¶”ì¶œì— ë”°ë¥¸ ë³€ë™(ìƒ˜í”Œë§ ë³€ë™)ì´ ì¤„ì–´ë“¤ë©°, ë”°ë¼ì„œ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶„í¬ì˜ ë¶„ì‚°ì´ ê°ì†Œí•¨. ê²°ê³¼ì ìœ¼ë¡œ ì‹ ë¢°êµ¬ê°„ì´ ë” ì¢ì•„ì§.

------------------------------------------------------------------------

## ì‹ ë¢°êµ¬ê°„ì—ì„œ ê°€ì„¤ê²€ì •ìœ¼ë¡œ

-   *ì‹ ë¢°êµ¬ê°„*ì€ *ì  ì¶”ì •(point estimation)*ì˜ í™•ì¥ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆìŒ.

-   í•˜ì§€ë§Œ ìš°ë¦¬ê°€ **ë‘ ê·¸ë£¹ ê°„ì˜ í‘œë³¸ í†µê³„ë¥¼ ë¹„êµí•˜ê³  ì‹¶ë‹¤ë©´?**

    -   *ì˜ˆì‹œ:* ë‚¨ì„±ê³¼ ì—¬ì„± ê°„ì˜ í‰ê·  ì„ê¸ˆ ì°¨ì´. ì´ ì°¨ì´ê°€ **ìœ ì˜ë¯¸í•œ(significant)** ì°¨ì´ì¼ê¹Œ?

-   ì´ëŸ¬í•œ ë¹„êµëŠ” ***ê°€ì„¤ê²€ì •(hypothesis testing)***ì˜ ì˜ì—­ì„.

-   ì‹ ë¢°êµ¬ê°„ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ, ê°€ì„¤ê²€ì •ë„ ëª¨ì§‘ë‹¨ì— ëŒ€í•œ ì£¼ì¥ì„ í‘œë³¸ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŒë‹¨í•˜ëŠ” ë° ì‚¬ìš©ë¨.

-   ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ì¶”ë¡ ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ë¡ ì  í‹€ì´ ì‹ ë¢°êµ¬ê°„ê³¼ëŠ” **ì•½ê°„ ë‹¤ë¦„**.

------------------------------------------------------------------------

# Hypothesis Testing

------------------------------------------------------------------------

## ì€í–‰ ìŠ¹ì§„ì—ì„œ ì„±ì°¨ë³„ì´ ì¡´ì¬í•˜ëŠ”ê°€?

-   1974ë…„ *Journal of Applied Psychology*ì— ê²Œì¬ëœ [ë…¼ë¬¸](https://pdfs.semanticscholar.org/39f6/d40e907ff08af4ddd3280c2ceee55ee1ddb6.pdf)ì—ì„œëŠ” ì€í–‰ ì—¬ì„± ì§ì›ë“¤ì´ ì°¨ë³„ì„ ë°›ì•˜ëŠ”ì§€ ì¡°ì‚¬í•¨.

-   48ëª…ì˜ (ë‚¨ì„±) ê´€ë¦¬ìì—ê²Œ **ë™ì¼í•œ** ì§€ì›ì ì´ë ¥ì„œë¥¼ ì œê³µí•˜ë˜, ì´ë¦„ë§Œ ë‚¨ì„± ë˜ëŠ” ì—¬ì„±ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì‹¤í—˜ì„ ì§„í–‰í•¨.

    -   ê° ì´ë ¥ì„œëŠ” "*ì§ì›ì„ ì§€ì ì¥ìœ¼ë¡œ ìŠ¹ì§„ì‹œí‚¬ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ëŠ” ìš”ì²­ ë©”ëª¨ í˜•ì‹*"ìœ¼ë¡œ ì‘ì„±ë¨.

-   **ê²€ì¦í•˜ê³ ì í•˜ëŠ” ê°€ì„¤:** *ìŠ¹ì§„ì—ì„œ ì„±ì°¨ë³„ì´ ì¡´ì¬í•˜ëŠ”ê°€?*

::::: columns
::: {.column width="50%"}
-   ì´ ì‹¤í—˜ ë°ì´í„°ëŠ” `moderndive` íŒ¨í‚¤ì§€ì˜ `promotions` ë°ì´í„°ì…‹ì— í¬í•¨ë˜ì–´ ìˆìŒ.
:::

::: {.column width="50%"}
```{r, echo=TRUE}
library(moderndive)
head(promotions)
```
:::
:::::

------------------------------------------------------------------------

## ì°¨ë³„ì˜ ì¦ê±°ê°€ ìˆëŠ”ê°€?

::::: columns
::: {.column width="50%"}
-   ì§€ì› ì—¬ë¶€ì— ë”°ë¼ ë‚¨ì„±ê³¼ ì—¬ì„±ì˜ ìŠ¹ì§„ íšŸìˆ˜ë¥¼ í™•ì¸.

```{r,echo= FALSE}
promotions %>% 
  group_by(gender, decision) %>% 
  tally() %>%
  mutate(percentage = 100 * n / sum(n))
```

-   ë‚¨ì„±ê³¼ ì—¬ì„± ê°„ ìŠ¹ì§„ë¥  ì°¨ì´ëŠ” 29.2%í¬ì¸íŠ¸ì„!
:::

::: {.column width="50%"}
```{r,echo= FALSE, fig.height=6}
ggplot(promotions, aes(x = gender, fill = decision)) +
  geom_bar(width = 0.75) +
  labs(x = "Gender of name on resume",
       y = "Frequency") +
  labs(title = "Promotion decision") +
  theme_bw(base_size = 20) +
  theme(legend.position = "top")
```
:::
:::::

-   ***ì§ˆë¬¸:***
    -   ì´ ì°¨ì´ê°€ ê²°ì •ì ì¸ ì¦ê±°ì¸ê°€?
    -   ë‚¨ì„±ê³¼ ì—¬ì„± ê°„ ìŠ¹ì§„ë¥  ì°¨ì´ê°€ ìš°ì—°íˆ ë°œìƒí•  ê°€ëŠ¥ì„±ì€ ì—†ëŠ”ê°€?

------------------------------------------------------------------------

## ê°€ìƒì˜ ì„¸ê³„ ì„¤ì •: ì„±ì°¨ë³„ì´ ì—†ëŠ” ê²½ìš°

-   ë§Œì•½ ì„±ì°¨ë³„ì´ ì „í˜€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì„¸ìƒì´ ìˆë‹¤ë©´? ìŠ¹ì§„ ê²°ì •ì€ ì„±ë³„ê³¼ ***ì™„ì „íˆ ë…ë¦½ì ***ì´ì–´ì•¼ í•¨.

-   ì´ë¥¼ ì‹¤í—˜ì ìœ¼ë¡œ ì¬í˜„í•˜ê¸° ìœ„í•´, ê¸°ì¡´ ë°ì´í„°ì—ì„œ `gender` ë³€ìˆ˜ë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ì–´(`shuffle`)\
    ê° í–‰ì— ë‹¤ì‹œ í• ë‹¹í•œ í›„, ìŠ¹ì§„ìœ¨ì´ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ ì‚´í´ë³´ì.

::::: columns
::: {.column width="50%"}
```{r, echo = TRUE}
promotions %>%
       left_join(promotions_shuffled %>%
                   rename(shuffled_gender = gender)) %>%
  head()
```

-   ì¬ë°°ì—´ëœ ìƒ˜í”Œì—ì„œ ìŠ¹ì§„ë¥ ì€ ì–´ë–»ê²Œ ë‚˜íƒ€ë‚ ê¹Œ?
:::

::: {.column width="50%"}
```{r}
promotions_shuffled %>% 
  group_by(gender, decision) %>% 
  tally() %>%
  mutate(percentage = 100 * n / sum(n))
```

-   ë¬´ì‘ìœ„ë¡œ ì„ì¸ í›„ ìŠ¹ì§„ìœ¨ ì°¨ì´ëŠ” 4.2%í¬ì¸íŠ¸ë¡œ ê°ì†Œí•¨!
:::
:::::

------------------------------------------------------------------------

## ê°€ìƒì˜ ì„¸ê³„ ì„¤ì •: ì„±ì°¨ë³„ì´ ì—†ëŠ” ê²½ìš°

-   ë§Œì•½ ì„±ì°¨ë³„ì´ ì „í˜€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì„¸ìƒì´ ìˆë‹¤ë©´? ìŠ¹ì§„ ê²°ì •ì€ ì„±ë³„ê³¼ ***ì™„ì „íˆ ë…ë¦½ì ***ì´ì–´ì•¼ í•¨.

-   ì´ë¥¼ ì‹¤í—˜ì ìœ¼ë¡œ ì¬í˜„í•˜ê¸° ìœ„í•´, ê¸°ì¡´ ë°ì´í„°ì—ì„œ `gender` ë³€ìˆ˜ë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ì–´(`shuffle`)\
    ê° í–‰ì— ë‹¤ì‹œ í• ë‹¹í•œ í›„, ìŠ¹ì§„ìœ¨ì´ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ ì‚´í´ë³´ì.

::::: columns
::: {.column width="50%"}
```{r, echo = TRUE}
promotions %>%
       left_join(promotions_shuffled %>%
                   rename(shuffled_gender = gender)) %>%
  head()
```

-   ì¬ë°°ì—´ëœ ìƒ˜í”Œì—ì„œ ìŠ¹ì§„ë¥ ì€ ì–´ë–»ê²Œ ë‚˜íƒ€ë‚ ê¹Œ?
:::

::: {.column width="50%"}
```{r,echo=FALSE,fig.height = 5.5}
p1 = ggplot(promotions, aes(x = gender, fill = decision)) +
  geom_bar(width = 0.75) +
  theme_bw(base_size = 15) +
  theme(legend.position = "top") +
  labs(x = "Gender of resume name", y = "Frequency", title = "Original")
p2 = ggplot(promotions_shuffled, aes(x = gender, fill = decision)) +
  geom_bar(width = 0.75) +
  theme_bw(base_size = 15) +
  labs(x = "Gender of resume name", y = "Frequency", title = "Reshuffled") +
  theme(legend.position = "top")
cowplot::plot_grid(p1,p2,rel_widths = c(1.3,1.3))
```
:::
:::::

------------------------------------------------------------------------

## í‘œë³¸ ë³€ë™ì„±(Sampling Variation)

-   ê°€ìƒì˜ ì„¸ê³„ì—ì„œ ìŠ¹ì§„ìœ¨ ì°¨ì´ëŠ” ***4.2%í¬ì¸íŠ¸***ì— ë¶ˆê³¼í–ˆìŒ.

-   ê·¸ë ‡ë‹¤ë©´, ì´ì œ ì„±ì°¨ë³„ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì‹¤íˆ ë‹µí•  ìˆ˜ ìˆì„ê¹Œ?

-   No! ***í‘œë³¸ ë³€ë™ì„±ì„ ê³ ë ¤í•´ì•¼ í•¨!***

    -   **í•œ ë²ˆ ë” ë¬´ì‘ìœ„ ì¬ë°°ì—´(shuffling)ì„ í•˜ë©´, 4.2%í¬ì¸íŠ¸ì™€ ì–¼ë§ˆë‚˜ ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì˜¬ê¹Œ?**\
    -   ì¦‰, 4.2%í¬ì¸íŠ¸ë¼ëŠ” ê°’ì´ ***ê°€ìƒì˜ ì„¸ê³„ì—ì„œ ì–¼ë§ˆë‚˜ ëŒ€í‘œì ì¸ ê°’ì¸ì§€*** í‰ê°€í•´ì•¼ í•¨.\
    -   ë” ë‚˜ì•„ê°€, ***ê°€ìƒì˜ ì„¸ê³„ì—ì„œ 29.2%í¬ì¸íŠ¸ ì°¨ì´ê°€ ë°œìƒí•  í™•ë¥ ì€ ì–¼ë§ˆë‚˜ ë ê¹Œ?***

-   ***"ì„±ì°¨ë³„ì´ ì—†ë‹¤"ëŠ” ê°€ì„¤í•˜ì—ì„œ*** ì „ì²´ ìƒ˜í”Œ ë¶„í¬ë¥¼ ì‚´í´ë³´ì•„ì•¼ í•¨.

-   ì–´ë–»ê²Œ? ***ë¬´ì‘ìœ„ ì¬ë°°ì—´ì„ ì•„ì£¼ ë§ì´ ë°˜ë³µí•˜ê³ , ë§¤ë²ˆ ìŠ¹ì§„ìœ¨ ì°¨ì´ë¥¼ ê³„ì‚°***.

<!-- ì¦‰,   -->

<!-- 1. ì„±ë³„ì„ ë¬´ì‘ìœ„ë¡œ ì„ëŠ” ê³¼ì •ì„ ì—¬ëŸ¬ ë²ˆ ìˆ˜í–‰í•˜ê³ ,   -->

<!-- 2. ë§¤ë²ˆ ë‚¨ì„±ê³¼ ì—¬ì„±ì˜ ìŠ¹ì§„ìœ¨ ì°¨ì´ë¥¼ ê¸°ë¡í•˜ì—¬   -->

<!-- 3. ì „ì²´ì ì¸ ë¶„í¬ë¥¼ í™•ì¸í•˜ë©´,   -->

<!-- 4. ì‹¤ì œ ê´€ì¸¡ëœ 29.2%í¬ì¸íŠ¸ ì°¨ì´ê°€ ìš°ì—°íˆ ë°œìƒí•  ìˆ˜ ìˆëŠ”ì§€ íŒë‹¨í•  ìˆ˜ ìˆìŒ. -->

------------------------------------------------------------------------

## 1000ë²ˆì˜ ë¬´ì‘ìœ„ ì¬ë°°ì—´ë¡œ í‘œë³¸ ë¶„í¬ ìƒì„±

```{r,echo = FALSE, fig.height = 4.75, fig.width = 8}
set.seed(2)
null_distribution <- promotions %>% 
  # ê²°ì •(decision)ê³¼ ì„±ë³„(gender) ê°„ ê´€ê³„ë¥¼ ì •ì˜í•˜ê³ , "promoted"ë¥¼ ì„±ê³µìœ¼ë¡œ ì„¤ì •
  specify(formula = decision ~ gender, success = "promoted") %>% 
  # ì„±ë³„ê³¼ ìŠ¹ì§„ ê²°ì •ì´ ë…ë¦½ì ì´ë¼ê³  ê°€ì •
  hypothesize(null = "independence") %>% 
  # ë°ì´í„°ë¥¼ 1000ë²ˆ ë¬´ì‘ìœ„ ì¬ë°°ì—´
  generate(reps = 1000, type = "permute") %>% 
  # ê° ì¬ë°°ì—´ì—ì„œ ë‚¨ì„±ê³¼ ì—¬ì„±ì˜ ìŠ¹ì§„ìœ¨ ì°¨ì´ë¥¼ ê³„ì‚°
  calculate(stat = "diff in props", order = c("male", "female"))

# í‘œë³¸ ë¶„í¬ ì‹œê°í™”
visualize(null_distribution, bins = 10, fill = "darkred") + 
  labs(title = "Sampling distribution", x = "Difference in promotion rates (male - female)", y = "Frequency") +
  xlim(-0.4, 0.4)+
  theme_bw(base_size = 14)
```

------------------------------------------------------------------------

## 1000ë²ˆì˜ ë¬´ì‘ìœ„ ì¬ë°°ì—´ë¡œ í‘œë³¸ ë¶„í¬ ìƒì„±

```{r,echo = FALSE, fig.height = 4.75, fig.width = 8}
visualize(null_distribution, bins = 10, fill = "darkred") + 
  geom_vline(xintercept = 0.292, size =1.25) +
  labs(x = "Difference in promotion rates (male - female)", y = "Frequency") +
  xlim(-0.4, 0.4)+
  theme_bw(base_size = 14) +
  annotate("text", x = 0.17, y = 485, label = "observed sample difference", size = 4)
```

-   ì„±ì°¨ë³„ì´ ì—†ë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ, 0.292 ì°¨ì´ê°€ ë°œìƒí•  í™•ë¥ ì€ ì–¼ë§ˆë‚˜ ë ê¹Œ?

------------------------------------------------------------------------

## ë°©ê¸ˆ ë­˜í•œ ê²ƒì´ì§€?

-   ìš°ë¦¬ëŠ” ***ê°€ì„¤ ê²€ì •(hypothesis testing)*** ì ˆì°¨ë¥¼ ì‹¤í–‰í–ˆìœ¼ë©°, ê·¸ì¤‘ì—ì„œë„ ***ìˆœì—´ ê²€ì •(permutation test)*** ì„ ì‚¬ìš©í•¨.

-   ì§ˆë¬¸: *ì„±ì°¨ë³„ì´ ì—†ëŠ” ê°€ìƒì˜ ì„¸ê³„ì—ì„œ, ì‹¤ì œ ê´€ì¸¡ëœ ìŠ¹ì§„ìœ¨ ì°¨ì´ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì€ ì–¼ë§ˆë‚˜ ë ê¹Œ?*

-   ê²°ë¡ : ***ê·¸ëŸ´ ê°€ëŠ¥ì„±ì´ ë‚®ìŒ*** â†’ ë”°ë¼ì„œ ìš°ë¦¬ëŠ” ***"ì„±ì°¨ë³„ì´ ì—†ë‹¤"ëŠ” ê°€ì„¤ì„ ê¸°ê°í•  ê°€ëŠ¥ì„±ì´ ë†’ìŒ***.

-   ì´ì œë¶€í„° ê°€ì„¤ ê²€ì •ì˜ ê³µì‹ì ì¸ ì´ë¡ ì  í‹€ì„ ì†Œê°œí•¨.

------------------------------------------------------------------------

## ê°€ì„¤ ê²€ì •ì˜ í‘œê¸°ë²•ê³¼ ì •ì˜

-   ***ê°€ì„¤ ê²€ì •(hypothesis test)*** ì€ ***ë‘ ê°œì˜ ê²½ìŸ ê°€ì„¤*** ì„ ë¹„êµí•˜ëŠ” ê³¼ì •ì„:

    -   ***ê·€ë¬´ê°€ì„¤(null hypothesis,*** $H_0$): ì¼ë°˜ì ìœ¼ë¡œ ì°¨ì´ê°€ ì—†ë‹¤ëŠ” ê°€ì„¤ì„ ì˜ë¯¸í•¨.

    -   ***ëŒ€ë¦½ê°€ì„¤(alternative hypothesis,*** $H_A$ ë˜ëŠ” $H_1$): ì—°êµ¬ìê°€ ì£¼ì¥í•˜ëŠ” ê°€ì„¤.

-   ì•ì„  ìŠ¹ì§„ ì‹¤í—˜ì˜ ê²½ìš°: $$\begin{align}H_0&: p_m - p_f = 0\\H_A&: p_m - p_f > 0,\end{align}$$ ì—¬ê¸°ì„œ $p_m =$ ë‚¨ì„±ì˜ ìŠ¹ì§„ ë¹„ìœ¨, $p_f =$ ì—¬ì„±ì˜ ìŠ¹ì§„ ë¹„ìœ¨.

    -   ìœ„ì˜ ëŒ€ë¦½ê°€ì„¤ì€ *í•œìª½ ê²€ì •(one-sided test)* ìœ¼ë¡œ, $p_m > p_f$, ì¦‰ ì—¬ì„±ì—ê²Œ ì°¨ë³„ì´ ì¡´ì¬í•œë‹¤ê³  ì£¼ì¥í•¨.
    -   *ì–‘ìª½ ê²€ì •(two-sided test)* ì˜ ê²½ìš° $H_A: p_m - p_f \neq 0$ ë¡œ í‘œí˜„ë¨.

------------------------------------------------------------------------

## ê°€ì„¤ ê²€ì •ì˜ í‘œê¸°ë²•ê³¼ ì •ì˜

-   ***ê²€ì • í†µê³„ëŸ‰(test statistic)***: ê°€ì„¤ ê²€ì •ì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” *ì  ì¶”ì •ê°’ ë˜ëŠ” í‘œë³¸ í†µê³„ëŸ‰*.

    -   *ì•ì„  ì‚¬ë¡€ì—ì„œ*: í‘œë³¸ ë¹„ìœ¨ ì°¨ì´ $\hat{p}_m - \hat{p}_f$.

-   ***ê´€ì¸¡ëœ ê²€ì • í†µê³„ëŸ‰(observed test statistic)***: ì‹¤ì œ ë°ì´í„°ì—ì„œ ê´€ì¸¡ëœ ê²€ì • í†µê³„ëŸ‰ì˜ ê°’.

    -   *ì•ì„  ì‚¬ë¡€ì—ì„œ*: ì‹¤ì œ ê´€ì¸¡ëœ ì°¨ì´ $\hat{p}_m - \hat{p}_f = 0.292 = 29.2\%$í¬ì¸íŠ¸.

-   ***ê·€ë¬´ë¶„í¬(null distribution)***: *ê·€ë¬´ê°€ì„¤* $H_0$ ì´ ì°¸ì´ë¼ê³  ê°€ì •í–ˆì„ ë•Œ ê²€ì • í†µê³„ëŸ‰ì˜ í‘œë³¸ ë¶„í¬.

    -   *ì•ì„  ì‚¬ë¡€ì—ì„œ*: ì°¨ë³„ì´ ì—†ë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ $\hat{p}_m - \hat{p}_f$ ê°€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ëª¨ë“  ê°’ë“¤ì˜ ë¶„í¬.
    -   ë°”ë¡œ ìš°ë¦¬ê°€ ì•ì„œ ë³¸ ë¶„í¬ì„.

------------------------------------------------------------------------

## ê·€ë¬´ë¶„í¬ (Null Distribution)

```{r,echo = FALSE, fig.height = 4.75, fig.width = 8}
visualize(null_distribution, bins = 10, fill = "red") + 
  geom_vline(xintercept = 0.292, size =1.25) +
  labs(x = "Difference in sample proportions (male - female)", y = "Frequency") +
  xlim(-0.4, 0.4)+
  theme_bw(base_size = 14) +
  annotate("text", x = 0.19, y = 485, label = "observed test statistic", size = 4)
```

------------------------------------------------------------------------

## ê°€ì„¤ ê²€ì •ì˜ í‘œê¸°ë²•ê³¼ ì •ì˜

> ***p-ê°’(p-value)***: ê·€ë¬´ê°€ì„¤ $H_0$ ì´ ì°¸ì¼ ë•Œ, ìš°ë¦¬ê°€ ê´€ì¸¡í•œ ê²€ì • í†µê³„ëŸ‰ê³¼ *ê°™ê±°ë‚˜ ë” ê·¹ë‹¨ì ì¸* ê°’ì„ ê´€ì¸¡í•  í™•ë¥ .

-   ê·€ë¬´ê°€ì„¤ $H_0$ ì´ ì°¸ì´ë¼ë©´, ì¦‰ ì°¨ë³„ì´ ì—†ëŠ” ì„¸ìƒì—ì„œ ìš°ë¦¬ê°€ 0.292ì˜ ìŠ¹ì§„ ë¹„ìœ¨ ì°¨ì´ë¥¼ ê´€ì¸¡í•œ ê²ƒì´ ì–¼ë§ˆë‚˜ *ë†€ë¼ìš´* ì¼ì¸ê°€? ë§¤ìš° ë†€ë¼ìš´ê°€? ì•½ê°„ ë†€ë¼ìš´ê°€?

-   ***ë” ê·¹ë‹¨ì ì¸ ê°’***ì´ë€ ë¬´ì—‡ì¸ê°€?

    -   ëŒ€ë¦½ê°€ì„¤ì— ë”°ë¼ ì •ì˜ë¨: ì´ ê²½ìš°, ë‚¨ì„±ì´ ì—¬ì„±ë³´ë‹¤ ìŠ¹ì§„í•  ***ê°€ëŠ¥ì„±ì´ ë” ë†’ë‹¤***ëŠ” ê°€ì •. ë”°ë¼ì„œ, ***ë” ê·¹ë‹¨ì ì¸ ê°’***ì´ë€ ***0.292ë³´ë‹¤ ë” í° ìŠ¹ì§„ ë¹„ìœ¨ ì°¨ì´***ë¥¼ ì˜ë¯¸í•¨.

-   ***í•´ì„***: p-ê°’ì´ ì‘ì„ìˆ˜ë¡, *ê´€ì¸¡ëœ í†µê³„ëŸ‰ì´ ê·€ë¬´ê°€ì„¤ê³¼ ì¼ì¹˜í•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†’ìŒ*.

-   ì–¸ì œ ê·€ë¬´ê°€ì„¤ $H_0$ ì„ ***ê¸°ê°***í• ì§€ ê²°ì •í•˜ëŠ” ê¸°ì¤€ì€?

------------------------------------------------------------------------

## ê°€ì„¤ ê²€ì •ì˜ í‘œê¸°ë²•ê³¼ ì •ì˜

-   ê·€ë¬´ê°€ì„¤ $H_0$ ì„ ê¸°ê°í• ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ê¸° ìœ„í•´ ***ìœ ì˜ìˆ˜ì¤€***ì„ ì„¤ì •í•¨.

-   ***ìœ ì˜ìˆ˜ì¤€*** $(\alpha)$: p-ê°’ì˜ *ì»·ì˜¤í”„ ê¸°ì¤€* ì—­í• ì„ í•¨.

    -   ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê°’: $\alpha = 0.01$, $0.05$, ë˜ëŠ” $0.1$.

-   ***íŒë‹¨ ê¸°ì¤€***:

    -   p-ê°’ì´ ***ìœ ì˜ìˆ˜ì¤€*** $\alpha$ë³´ë‹¤ ì‘ìœ¼ë©´, "$\alpha$ ìœ ì˜ìˆ˜ì¤€ì—ì„œ ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•œë‹¤."

    -   ë°˜ëŒ€ë¡œ, p-ê°’ì´ $\alpha$ë³´ë‹¤ í¬ë©´, "$\alpha$ ìœ ì˜ìˆ˜ì¤€ì—ì„œ ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•  ìˆ˜ ì—†ë‹¤."ë¼ê³  í‘œí˜„í•¨.

-   ***í•´ì„***: ê·€ë¬´ê°€ì„¤ì´ ì°¸ì¼ ë•Œ ê´€ì¸¡ê°’ì´ *ë„ˆë¬´ ì¼ì–´ë‚  ê°€ëŠ¥ì„±ì´ ë‚®ë‹¤ë©´*, í•´ë‹¹ ê°€ì„¤ì´ ***ê±°ì§“ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŒ***.

-   ìš°ë¦¬ ì˜ˆì œì—ì„œ ì´ë¥¼ ì–´ë–»ê²Œ ì ìš©í•˜ëŠ”ì§€ ì‚´í´ë³´ì.

------------------------------------------------------------------------

## p-value ì‹œê°í™”

```{r,fig.height = 4.75, fig.width = 8, echo = FALSE}
obs_diff_prop <- promotions %>%
  specify(decision ~ gender, success = "promoted") %>%
  calculate(stat = "diff in props", order = c("male", "female"))

visualize(null_distribution, bins = 10, fill = "#d90502") + 
  shade_p_value(obs_stat = obs_diff_prop,
                size = 0.5,
                direction = "right", 
                fill = "black") +
  labs(x = "Differences in sample proportions (male - female)",
       y = "Frequency") +
  xlim(-0.4, 0.4)+
  theme_bw(base_size = 14) +
  geom_vline(xintercept = 0.292, size = 1.25) +
  annotate("text", x = 0.19, y = 485, label = "observed test statistic", size = 4)
```

-   ê²€ì€ ë¶€ë¶„ì´ p-valueì— í•´ë‹¹!

------------------------------------------------------------------------

## p-value ê³„ì‚° ë° ì˜ì‚¬ ê²°ì •

-   p-ê°’ì˜ ì •ì˜ë¥¼ ë‹¤ì‹œ ë– ì˜¬ë ¤ ë³´ì: ***ê·€ë¬´ê°€ì„¤*** $H_0$ì´ ì°¸ì´ë¼ê³  ê°€ì •í•  ë•Œ, ìš°ë¦¬ê°€ ì–»ì€ í†µê³„ëŸ‰ë³´ë‹¤ ê°™ê±°ë‚˜ ë” ê·¹ë‹¨ì ì¸\* ê°’ì„ ê´€ì¸¡í•  í™•ë¥ .\*

```{r}
p_value <- mean(null_distribution$stat >= 0.292)
p_value
```

-   ì°¨ë³„ì´ ì—†ëŠ” ì„¸ìƒì—ì„œëŠ” $\hat{p_m} - \hat{p_f}$ ê°’ì´ 0.292 ì´ìƒì¼ í™•ë¥ ì´ r 100\*p_value%ì— ë¶ˆê³¼í•¨.

-   ë”°ë¼ì„œ 5% ìœ ì˜ìˆ˜ì¤€ì—ì„œ ê·€ë¬´ê°€ì„¤ $H_0$ (ì¦‰, ì°¨ë³„ì´ ì—†ë‹¤ëŠ” ê°€ì„¤)ì„ ê¸°ê°í•  ìˆ˜ ìˆìŒ.

    -   ì¦‰, $\hat{p_m} - \hat{p_f} = 0.292$ëŠ” 5% ìœ ì˜ìˆ˜ì¤€ì—ì„œ 0ê³¼ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•˜ê²Œ ë‹¤ë¦„.

-   **ì§ˆë¬¸:** ë§Œì•½ ìœ ì˜ìˆ˜ì¤€ì„ $\alpha = 0.01 = 1%$ë¡œ ì„¤ì •í–ˆë‹¤ë©´, ì°¨ë³„ì´ ì—†ë‹¤ëŠ” ê°€ì„¤ì„ ê¸°ê°í•  ìˆ˜ ìˆì—ˆì„ê¹Œ?

------------------------------------------------------------------------

## ê²€ì • ì˜¤ë¥˜ (Testing Errors)

-   í™•ë¥ ì„ ë‹¤ë£¨ê¸° ë•Œë¬¸ì— **ì˜¤ë¥˜**ë¥¼ ë²”í•  ìˆ˜ ìˆìŒ.

-   29%p ì°¨ì´ëŠ” $H_0$ í•˜ì—ì„œ *ë“œë¬¼ê²Œ* ë°œìƒí•  ìˆ˜ ìˆì§€ë§Œ, **ì ˆëŒ€ ë¶ˆê°€ëŠ¥í•œ ê²ƒì€ ì•„ë‹˜**.

    -   ì‹¤ì œë¡œ, ì´ëŸ¬í•œ ì°¨ì´(ë˜ëŠ” ë” í° ì°¨ì´)ëŠ” ì•½ **0.007%ì˜ í™•ë¥ **ë¡œ ë°œìƒí•  ìˆ˜ ìˆìŒ.

-   ë”°ë¼ì„œ, ë•Œë•Œë¡œ ìš°ë¦¬ëŠ” $H_0$ë¥¼ ê¸°ê°í•˜ì§€ë§Œ, ì‚¬ì‹¤ $H_0$ê°€ ì°¸ì¼ ìˆ˜ë„ ìˆìŒ.

    -   5% ìœ ì˜ ìˆ˜ì¤€ì„ ì„¤ì •í•˜ë©´, ì´ëŸ¬í•œ ì˜¤ë¥˜ê°€ **5%ë¥¼ ë„˜ì§€ ì•Šë„ë¡** ë³´ì¥í•  ìˆ˜ ìˆìŒ.

------------------------------------------------------------------------

## ê²€ì • ì˜¤ë¥˜ (Testing Errors)

-   ê°€ì„¤ ê²€ì •ì—ì„œëŠ” ***ë‘ ê°€ì§€ ìœ í˜•ì˜ ì˜¤ë¥˜***ê°€ ì¡´ì¬í•¨.

::::: columns
::: {.column width="50%"}
![:scale 100%](../img/photos/gt_error_table_ht.png)
:::

::: {.column width="50%"}
**ì œ1ì¢… ì˜¤ë¥˜ (Type I Error)**: ê·€ë¬´ê°€ì„¤($H_0$)ì´ ì°¸ì¸ë°ë„ ì´ë¥¼ ê¸°ê°í•˜ëŠ” ê²½ìš°. ***ê±°ì§“ ì–‘ì„± (False Positive)***

**ì œ2ì¢… ì˜¤ë¥˜ (Type II Error)**: ê·€ë¬´ê°€ì„¤($H_0$)ì´ ê±°ì§“ì¸ë°ë„ ì´ë¥¼ ê¸°ê°í•˜ì§€ ì•ŠëŠ” ê²½ìš°. ***ê±°ì§“ ìŒì„± (False Negative)***
:::
:::::

-   ì‹¤ì œë¡œ, ìš°ë¦¬ëŠ” **ì œ1ì¢… ì˜¤ë¥˜ì˜ ë°œìƒ ë¹ˆë„ë¥¼** $\alpha$ ë¡œ ì„¤ì •í•˜ì—¬ í†µì œí•˜ê³ , **ì œ2ì¢… ì˜¤ë¥˜ë¥¼ ìµœì†Œí™”í•˜ë ¤ê³  ë…¸ë ¥í•¨**.

------------------------------------------------------------------------

## ì´ ëª¨ë“  ê²ƒì´ íšŒê·€ ë¶„ì„ê³¼ ì–´ë–»ê²Œ ê´€ë ¨ë ê¹Œ?

-   ì´ì œ ***í†µê³„ì  ì¶”ë¡  (statistical inference)*** ì„ ì‹¤ì œë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ë„êµ¬ë¥¼ ê°–ì¶¤!

-   íšŒê·€ ë¶„ì„ì€ ***í‘œë³¸ ë°ì´í„° (sample)*** ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•¨.

-   ë”°ë¼ì„œ ***íšŒê·€ ê³„ìˆ˜ (regression coefficient)*** ë„ ***í‘œë³¸ ë³€ë™ì„± (sampling variation)*** ì— ì˜í–¥ì„ ë°›ìœ¼ë©°, ì´ëŠ” ëª¨ì§‘ë‹¨ì˜ ì°¸ëœ ê³„ìˆ˜ê°€ ì•„ë‹˜.

-   ***ì§ˆë¬¸***: ì¶”ì •ëœ íš¨ê³¼ê°€ íŠ¹ì • ê°’ $z$ ì™€ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•˜ê²Œ ë‹¤ë¥¸ê°€? ë‹¤ìŒ ì‹œê°„! ğŸµ

------------------------------------------------------------------------

## ğŸ” ì¸ê³¼ ê´€ê³„ë¥¼ ì°¾ì•„ê°€ëŠ” ê¸¸

âœ… ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ë‹¤ë£°ê¹Œ?: ì½ê¸°(Read), ì •ë¦¬(Tidy), ì‹œê°í™”(Visualize)...

âœ… ë³€ìˆ˜ê°„ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ ìš”ì•½í• ê¹Œ? ë‹¨ìˆœ / ë‹¤ì¤‘ ì„ í˜• íšŒê·€...ë¹„ì„ í˜•íšŒê·€, êµì°¨ë³€ìˆ˜...

âœ… ì¸ê³¼ ê´€ê³„(Causality)ë€ ë¬´ì—‡ì¸ê°€?

âœ… ì „ì²´ ëª¨ì§‘ë‹¨ì„ ê´€ì¸¡í•˜ì§€ ëª»í•˜ë©´ ì–´ë–»ê²Œ í• ê¹Œ? Sampling!

ğŸš§ ***ìš°ë¦¬ì˜ ì—°êµ¬ ê²°ê³¼ê°€ ë‹¨ìˆœí•œ ë¬´ì‘ìœ„(Randomness) ë•Œë¬¸ì¼ ìˆ˜ë„ ìˆì„ê¹Œ?*** ì‹ ë¢°êµ¬ê°„ê³¼ ê°€ì„¤ê²€ì •..

âŒ ì‹¤ì œë¡œ ì™¸ìƒì„±ì„ ì–´ë–»ê²Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆì„ê¹Œ?

------------------------------------------------------------------------


<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

::: {style="display: flex; justify-content: center; align-items: center; height: 70vh;"}
<h2 style="color: #ff6666; text-align: center; font-family: &#39;Pacifico&#39;, cursive; font-size: 50px;">

THE END!

</h2>
:::

------------------------------------------------------------------------

## Appendix: code to generate the null distribution

::::: columns
::: {.column width="50%"}
```{r, echo=TRUE, eval = FALSE}
null_distribution <- promotions %>% 
  # takes formula, defines success
  specify(formula = decision ~ gender,
          success = "promoted") %>%
  # decisions are independent of gender
  hypothesize(null = "independence") %>% 
  # generate 1000 reshufflings of data
  generate(reps = 1000, type = "permute") %>% 
  # compute p_m - p_f from each reshuffle
  calculate(stat = "diff in props",
            order = c("male", "female"))

visualize(null_distribution,
          bins = 10,
          fill = "#d90502") + 
  labs(title = "Sampling distribution",
       x = "Difference in promotion rates (male - female)",
       y = "Frequency") +
  xlim(-0.4, 0.4) +
  theme_bw(base_size = 14)
```
:::

::: {.column width="50%"}
```{r,echo = FALSE, fig.height=6}
visualize(null_distribution, bins = 10, fill = "#d90502") + 
  labs(title = "Sampling distribution", x = "Difference in promotion rates (male - female)", y = "Frequency") +
  xlim(-0.4, 0.4)+
  theme_bw(base_size = 14)
```
:::
:::::
