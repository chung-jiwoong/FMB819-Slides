---
title: "FMB819: Rì„ ì´ìš©í•œ ë°ì´í„°ë¶„ì„"
subtitle: "<span style='font-size:1.5em; color:#a01616;'>Introduction to Causality</span>"
# date: "`r Sys.Date()`"
format:
  revealjs:
    slide-number: true
    # smaller: true
    scrollable: true
    chalkboard: true
    transition: fade
    transition-speed: fast
    #incremental: true
    #lib_dir: libs
    css: [default, "../css/kubs.css", "../css/kubs-fonts.css"]
    #nature:
      # beforeInit: ["../js/ru_xaringan.js"]
      #highlightStyle: github
      #highlightLines: true
      #countIncrementalSlides: false
    #  ratio: "16:9"
    # includes:
    #   in_header: "../libs/partials/header.html"
---

```{r setup, include=FALSE,warning=FALSE,message=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  dev = "svg",
  cache = TRUE,
  fig.align = "center"
  #fig.width = 11,
  #fig.height = 5
)

# define vars
om = par("mar")
lowtop = c(om[1],om[2],0.1,om[4])

overwrite = FALSE

library(tidyverse)
library(ggplot2)
library(dplyr)
library(png)
library(grid)
library(pander)
library(countdown)

# countdown style
countdown(
  color_border              = "#d90502",
  color_text                = "black",
  color_running_background  = "#d90502",
  color_running_text        = "white",
  color_finished_background = "white",
  color_finished_text       = "#d90502",
  color_finished_border     = "#d90502"
)
```

------------------------------------------------------------------------

## Today's Agenda

-   ì¸ê³¼ê´€ê³„(Causality) vs. ìƒê´€ê´€ê³„(Correlation)

-   ì ì¬ ê²°ê³¼ í”„ë ˆì„ì›Œí¬(Potential Outcomes Framework) (a.k.a. Rubinì˜ ì¸ê³¼ ëª¨ë¸)

-   ë¬´ì‘ìœ„ í†µì œ ì‹¤í—˜(Randomized Controlled Trials, RCTs)

-   í•™ê¸‰ ê·œëª¨(class size)ì™€ í•™ìƒ ì„±ì·¨(student performance)ì— ëŒ€í•œ ì‹¤ì¦ ë¶„ì„ ì‹¬í™”

------------------------------------------------------------------------

## ì¸ê³¼ê´€ê³„ì˜ ê°œë…

***ì¸ê³¼ê´€ê³„(Causality)***ë€ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ê°€?

-   `X`ê°€ `Y`ë¥¼ *ìœ ë°œí•œë‹¤(causes)*.. ì˜ë¯¸?

-   ë§Œì•½ ***ë‹¤ë¥¸ ëª¨ë“  ê²ƒì€ ê·¸ëŒ€ë¡œ ë‘” ì±„(unchanged)*** ìš°ë¦¬ê°€ `X`ì˜ ê°’ì„ **ë³€ê²½(intervene and change)**í•œë‹¤ë©´,

-   ê·¸ ê²°ê³¼ë¡œ `Y`ë„ ***ë³€í™”***í•˜ê²Œ ëœë‹¤ëŠ” ì˜ë¯¸.

-   ì—¬ê¸°ì„œ í•µì‹¬ì€ **"ë‹¤ë¥¸ ëª¨ë“  ê²ƒì€ ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤"**ëŠ” ê°€ì •ì„.\
    ì´ëŠ” í”íˆ **"ì„¸í…Œë¦¬ìŠ¤ íŒŒë¦¬ë¶€ìŠ¤(ceteris paribus, all else equal)"** ê°€ì •ì´ë¼ê³  ë¶ˆë¦¼.

-   **ì£¼ì˜í•  ì :** ì´ê²ƒì€ `X`ê°€ `Y`ë¥¼ ìœ ë°œí•˜ëŠ” **ìœ ì¼í•œ ìš”ì¸**ì´ë¼ëŠ” ëœ»ì´ ì•„ë‹˜!

------------------------------------------------------------------------

## ìƒê´€ê´€ê³„ vs. ì¸ê³¼ê´€ê³„

-   ***"ìƒê´€ê´€ê³„ëŠ” ì¸ê³¼ê´€ê³„ê°€ ì•„ë‹ˆë‹¤"***ë¼ëŠ” ë§ì€ ë§¤ìš° í”í•˜ê²Œ ì‚¬ìš©ë¨.\
    ê·¸ëŸ°ë° ì™œ ì´ê²ƒì´ ì‚¬ì‹¤ì¸ì§€ ì„¤ëª…í•  ìˆ˜ ìˆëŠ”ê°€?

-   **ì¼ë¶€ ìƒê´€ê´€ê³„ëŠ” ëª…ë°±íˆ ì¸ê³¼ê´€ê³„ë¥¼ ì˜ë¯¸í•˜ì§€ ì•ŠìŒ.**\
    ([ì˜ˆ: ê°€ì§œ ìƒê´€ê´€ê³„ ëª¨ìŒ](https://www.tylervigen.com/spurious-correlations))

```{r, echo = FALSE, out.width = "800px"}
knitr::include_graphics("../img/photos/spurious.png")
```

------------------------------------------------------------------------

## ìƒê´€ê´€ê³„ vs. ì¸ê³¼ê´€ê³„: í¡ì—°ê³¼ íì•”

-   ê·¸ëŸ¬ë‚˜ ëª¨ë“  ìƒê´€ê´€ê³„ê°€ ì‰½ê²Œ ê¸°ê°ë  ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹˜.

-   **í¡ì—°ì´ íì•”ì„ ìœ ë°œí•˜ëŠ”ê°€?**

::::: columns
::: {.column width="50%"}
-   ì˜¤ëŠ˜ë‚  ìš°ë¦¬ëŠ” ë‹µì´ *"ì˜ˆ(YES)"*ë¼ëŠ” ê²ƒì„ ì•Œê³  ìˆìŒ!

-   í•˜ì§€ë§Œ **1950ë…„ëŒ€**ë¡œ ëŒì•„ê°€ ë³´ì.

    -   ë‹¹ì‹œ íì•” ì‚¬ë§ë¥ ì´ ê¸‰ê²©íˆ ì¦ê°€í•˜ê¸° ì‹œì‘í•¨...\
    -   â€¦ ê·¸ë¦¬ê³  ê·¸ ì´ì „ì— **ë‹´ë°° ì†Œë¹„ê°€ ë¹ ë¥´ê²Œ ì¦ê°€**í–ˆìŒ.
:::

::: {.column width="50%"}
```{r, echo = FALSE, eval=TRUE, out.width = "400px"}
knitr::include_graphics("../img/photos/Smoking_lung_cancer.png")
```
:::
:::::

-   ì´ ê·¸ë˜í”„ë§Œ ë³´ë©´, "í¡ì—°ì´ íì•”ì„ ìœ ë°œí•œë‹¤"ê³  ì‰½ê²Œ ê²°ë¡  ë‚´ë¦´ ìˆ˜ ìˆìŒ.

------------------------------------------------------------------------

## ìƒê´€ê´€ê³„ vs. ì¸ê³¼ê´€ê³„: í¡ì—°ê³¼ íì•”

-   ë‹¹ì‹œì—ëŠ” ì—¬ì „íˆ íšŒì˜ì ì¸ ì‚¬ëŒë“¤ì´ ë§ì•˜ìœ¼ë©°, ìœ ëª…í•œ í†µê³„í•™ìë“¤ì¡°ì°¨ë„ ì´ë¥¼ ì˜ì‹¬í–ˆìŒ.

::::: columns
::: {.column width="50%"}
**ê±°ì‹œì  êµë€ ìš”ì¸ (Macro Confounding Factors)**

-   íì•”ì„ ìœ ë°œí•  ìˆ˜ ìˆëŠ” *ë‹¤ë¥¸ ê±°ì‹œì  ìš”ì¸*ë“¤ë„ 1900ë…„\~1950ë…„ ì‚¬ì´ì— ë³€í™”í–ˆìŒ:

    -   ë„ë¡œ í¬ì¥(tarring of roads),
    -   ìë™ì°¨ ë°°ê¸°ê°€ìŠ¤(ë‚© í•¨ìœ  ê°€ì†”ë¦° ì—°ê¸°) í¡ì…,
    -   ì „ë°˜ì ì¸ ëŒ€ê¸° ì˜¤ì—¼ ì¦ê°€.
:::

::: {.column width="50%"}
**ìê¸° ì„ íƒ í¸í–¥ (Self Selection)**

-   í¡ì—°ìì™€ ë¹„í¡ì—°ìëŠ” ì›ë˜ë¶€í„° ë‹¤ë¥¼ ê°€ëŠ¥ì„±ì´ ìˆìŒ:

    -   **ê´€ì¸¡ ê°€ëŠ¥í•œ íŠ¹ì§•ì— ë”°ë¥¸ ì„ íƒ(selection on observables):** ì—°ë ¹, êµìœ¡ ìˆ˜ì¤€, ì†Œë“ ë“±.

    -   **ê´€ì¸¡ ë¶ˆê°€ëŠ¥í•œ íŠ¹ì§•ì— ë”°ë¥¸ ì„ íƒ(selection on unobservables):** ìœ ì „ì (Fisherê°€ ì œì•ˆí•œ [ê°€ì„¤ì  ìœ ì „ì êµë€ ì´ë¡ ](https://en.wikipedia.org/wiki/Ronald_Aylmer_Fisher)).\
:::
:::::

------------------------------------------------------------------------

## ìƒê´€ê´€ê³„ vs. ì¸ê³¼ê´€ê³„: ë‹¤ë¥¸ ì˜ˆì‹œë“¤

::: incremental
-   ***êµìœ¡ ì—°ìˆ˜(years of education)***ì™€ ***ì†Œë“(income)*** ê°„ì˜ ê´€ì¸¡ëœ ìƒê´€ê´€ê³„ê°€ ì‹¤ì œë¡œ êµìœ¡ì˜ ì¸ê³¼ì  íš¨ê³¼ë¥¼ ë°˜ì˜í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆëŠ” ì´ìœ ëŠ”?

    -   ê°œì¸ì´ êµìœ¡ ìˆ˜ì¤€ì„ ì„ íƒí•˜ëŠ” ë°©ì‹ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ. ê³ ë“± êµìœ¡ì„ ë°›ëŠ” ì‚¬ëŒë“¤ì€ ì›ë˜ë¶€í„° ë†’ì€ ì„ ì²œì  ëŠ¥ë ¥ì„ ê°€ì¡Œê±°ë‚˜, í•™êµ ìƒí™œì„ ì¦ê¸°ë©° í•™ì—…ì— ê°•í•œ ì„±í–¥ì„ ê°€ì§ˆ ê°€ëŠ¥ì„±ì´ ë†’ìŒ. $\rightarrow$ ***ìê¸° ì„ íƒ í¸í–¥(Self-selection)***

-   ***ê³ ìš©ë¥ (employment rate)***ê³¼ ***ìµœì €ì„ê¸ˆ(minimum wage)*** ê°„ì˜ ê´€ì¸¡ëœ ìƒê´€ê´€ê³„ê°€ ì‹¤ì œë¡œ ìµœì €ì„ê¸ˆì˜ ì¸ê³¼ì  íš¨ê³¼ë¥¼ ë°˜ì˜í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆëŠ” ì´ìœ ëŠ”?

    -   ì •ì±… ê²°ì •ìë“¤ì€ ê³ ìš©ë¥ ì´ ë†’ì€ ì‹œê¸°ì— ìµœì €ì„ê¸ˆì„ ì¸ìƒí•  ê°€ëŠ¥ì„±ì´ ìˆìŒ $\rightarrow$ ***ì—­ì¸ê³¼ê´€ê³„(reverse causality) / ë™ì‹œì„±(simultaneity)***

-   ***ê²½ì œ ì„±ì¥(economic growth)***ê³¼ ***ê¸ˆìœµ ë°œì „(financial development)*** ê°„ì˜ ê´€ì¸¡ëœ ìƒê´€ê´€ê³„ê°€ ì‹¤ì œë¡œ ê¸ˆìœµ ë¶€ë¬¸ì˜ ì¸ê³¼ì  íš¨ê³¼ë¥¼ ë°˜ì˜í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆëŠ” ì´ìœ ëŠ”?

    -   **ê²½ì œ ì„±ì¥ì´ ê¸ˆìœµ ë°œì „ì„ ì´‰ì§„í•˜ëŠ” ê²ƒì¼ ìˆ˜ë„ ìˆìŒ** (ë°˜ëŒ€ë¡œ ê¸ˆìœµ ë°œì „ì´ ê²½ì œ ì„±ì¥ì„ ìœ ë°œí•˜ëŠ” ê²ƒì´ ì•„ë‹ ê°€ëŠ¥ì„±) $\rightarrow$ ***ì—­ì¸ê³¼ê´€ê³„(reverse causality) / ë™ì‹œì„±(simultaneity)***
:::

------------------------------------------------------------------------

## ê²½ì œ ì´ë¡ ê³¼ì˜ ì—°ê²°

::: incremental
-   **ê²½ì œ ì´ë¡ (Economic theory)**ì— ë”°ë¥´ë©´, ê°œì¸ì€ ìì‹ ì˜ **íš¨ìš©(utility)ì„ ê·¹ëŒ€í™”(maximise)í•˜ê¸° ìœ„í•´ í–‰ë™**í•¨.

-   ë”°ë¼ì„œ ê°œì¸ë“¤ì€ **ë¬´ì‘ìœ„(random ways)**ë¡œ í–‰ë™í•˜ì§€ ì•ŠìŒ. $\rightarrow$ ì¦‰, ê°œì¸ì˜ í–‰ë™ì€ **ë‚´ìƒì (endogenous)**ì´ë¼ê³  ë³¼ ìˆ˜ ìˆìŒ.

-   **ë°ì´í„°ì—ì„œ ë°œê²¬ëœ ìƒê´€ê´€ê³„ë¥¼ ë¬´ì¡°ê±´ ë¯¿ì–´ì„œëŠ” ì•ˆ ë¨.** ì–¸ì œë‚˜ *ì˜ì‹¬í•˜ëŠ” íƒœë„(suspicious)*ê°€ í•„ìš”í•¨.

-   ğŸ“Œ ê·¸ë ‡ë‹¤ë©´, ì–´ë–»ê²Œ **ì¸ê³¼ì  ì£¼ì¥(causal claims)**ì„ í•  ìˆ˜ ìˆì„ê¹Œ?

-   **ì ì¬ ê²°ê³¼ í”„ë ˆì„ì›Œí¬(Potential Outcomes Framework)**ê°€ ìœ ìš©í•œ ê¸¸ì¡ì´
:::

# Causal Inference

------------------------------------------------------------------------

## ì ì¬ ê²°ê³¼ í”„ë ˆì„ì›Œí¬ (The Potential Outcomes Framework)

ì´ ëª¨ë¸ì€ **Rubinì˜ ì¸ê³¼ ëª¨ë¸(Rubin Causal Model)**ì´ë¼ê³ ë„ ë¶ˆë¦¬ë©°, í†µê³„í•™ì **Donald Rubin**ì´ 1970ë…„ëŒ€ì— ì´ë¥¼ ì¼ë°˜í™”í•˜ê³  ì²´ê³„í™”í•¨.

-   í•µì‹¬ ì•„ì´ë””ì–´ (Key Idea)

    -   ê° ê°œì¸ì€ **ì—¬ëŸ¬ ê°œì˜ ëŒ€ì²´ì  ì²˜ì¹˜ ìƒíƒœ(alternative treatment states)**ì— ë…¸ì¶œë  ìˆ˜ ìˆìŒ.

        -   ë‹´ë°°ë¥¼ í”¼ìš°ê±°ë‚˜, ì‹œê°€ë¥¼ í”¼ìš°ê±°ë‚˜, ì•„ì˜ˆ í”¼ìš°ì§€ ì•Šê±°ë‚˜.
        -   ê°€ë‚œí•œ ì§€ì—­, ì¤‘ì‚°ì¸µ ì§€ì—­, ë¶€ìœ í•œ ì§€ì—­ì—ì„œ ì„±ì¥í•˜ëŠ” ê²ƒ.
        -   ì†Œê·œëª¨ í•™ê¸‰ê³¼ ëŒ€ê·œëª¨ í•™ê¸‰ì—ì„œ ë°°ìš°ëŠ” ê²ƒ.

::::: columns
::: {.column width="50%"}
**ì‹¤ìš©ì ì¸ ì •ì˜**\
ì²˜ì¹˜ ë³€ìˆ˜ $D_i$ë¥¼ **ì´ì§„ ë³€ìˆ˜(binary variable)**ë¡œ ì •ì˜ $$
D_i = \begin{cases} 
                    1 \textrm{ if individual $i$ is treated} \\\\ 
                    0 \textrm{ if individual $i$ is not treated} 
      \end{cases}
$$
:::

::: {.column width="50%"}
***âœ… Treatment group***\
all the individuals such that $D_i = 1$.

***âŒ Control group***\
all the individuals such that $D_i = 0$.
:::
:::::

------------------------------------------------------------------------

## ì ì¬ ê²°ê³¼ í”„ë ˆì„ì›Œí¬ (The Potential Outcomes Framework)

-   ì´ í”„ë ˆì„ì›Œí¬ì—ì„œëŠ” ê° ê°œì¸ì´ ë‘ ê°œì˜ **ì ì¬ì  ê²°ê³¼(potential outcomes)**ë¥¼ ê°€ì§. í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” **í•˜ë‚˜ì˜ ê´€ì¸¡ëœ ê²°ê³¼(observed outcome)** $Y_i$ë§Œ í™•ì¸ ê°€ëŠ¥í•¨.

    -   $Y_i^1$: *ê°œì¸* $i$ê°€ ì²˜ì¹˜ë¥¼ ë°›ì•˜ì„ ê²½ìš°ì˜ ì ì¬ì  ê²°ê³¼ $(D_i = 1)$\
    -   $Y_i^0$: *ê°œì¸* $i$ê°€ ì²˜ì¹˜ë¥¼ ë°›ì§€ ì•Šì•˜ì„ ê²½ìš°ì˜ ì ì¬ì  ê²°ê³¼ $(D_i = 0)$

-   í˜„ì‹¤ì—ì„œëŠ” ë‹¨ í•˜ë‚˜ì˜ ê²°ê³¼ $Y_i$ë§Œì„ ê´€ì¸¡í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì´ í‘œí˜„ë¨:

$$
Y_i = D_i \times Y_i^1 + (1- D_i) \times Y_i^0
$$

-   ğŸ”¥ **ì¸ê³¼ ì¶”ë¡ ì˜ ê·¼ë³¸ì ì¸ ë¬¸ì œ (Fundamental Problem of Causal Inference)** ì–´ë–¤ ê°œì¸ $i$ì— ëŒ€í•´, **ë‘ ê°œì˜ ì ì¬ì  ê²°ê³¼ ì¤‘ ì˜¤ì§ í•˜ë‚˜ë§Œ ê´€ì¸¡í•  ìˆ˜ ìˆìŒ.**\
    [(Holland, 1986)](http://people.umass.edu/~stanek/pdffiles/causal-holland.pdf)

------------------------------------------------------------------------

## ì ì¬ ê²°ê³¼ í”„ë ˆì„ì›Œí¬ (The Potential Outcomes Framework)

-   ê´€ì¸¡ë˜ì§€ ì•Šì€ ì ì¬ì  ê²°ê³¼ë„ ì´ë¡ ì ìœ¼ë¡œ ì¡´ì¬í•˜ë©°, ì´ë¥¼ **ë°˜ì‚¬ì‹¤ì  ê²°ê³¼(counterfactual outcome)**ë¼ê³  í•¨.

| Group | $Y_i^1$ | $Y_i^0$ |
|--------------------|:------------------------:|:------------------------:|
| **ì²˜ì¹˜ ê·¸ë£¹** $(D_i = 1)$ | âœ… **ê´€ì¸¡ ê°€ëŠ¥ (Observed as** $Y_i$) | âŒ *ë°˜ì‚¬ì‹¤ì  ê²°ê³¼ (Counterfactual)* |
| **í†µì œ ê·¸ë£¹** $(D_i = 0)$ | âŒ *ë°˜ì‚¬ì‹¤ì  ê²°ê³¼ (Counterfactual)* | âœ… **ê´€ì¸¡ ê°€ëŠ¥ (Observed as** $Y_i$) |

-   ìœ„ ê°œë…ì„ ë°”íƒ•ìœ¼ë¡œ, **ê°œë³„ ì²˜ì¹˜ íš¨ê³¼(individual treatment effect)** $\delta_i$ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŒ.

$$
\delta_i = Y_i^1 - Y_i^0
$$

-   $\delta_i$ëŠ” ì²˜ì¹˜ $(D_i)$ê°€ ê°œì¸ $i$ì˜ ê²°ê³¼ ë³€ìˆ˜ $Y$ì— ë¯¸ì¹˜ëŠ” **ì¸ê³¼ì  íš¨ê³¼(causal effect)**ë¥¼ ì¸¡ì •í•¨.

-   âš ï¸ **í•µì‹¬ ë¬¸ì œ** ê°œë³„ ì²˜ì¹˜ íš¨ê³¼ $\delta_i$ëŠ” **ê°œì¸ ìˆ˜ì¤€ì—ì„œëŠ” ì ˆëŒ€ ê´€ì¸¡í•  ìˆ˜ ì—†ìŒ!** ë”°ë¼ì„œ **ì§‘ë‹¨ í‰ê· (population averages)**ì„ ì´ìš©í•´ ì¶”ì •í•´ì•¼ í•¨.

------------------------------------------------------------------------

## ë³´ì¶© ì„¤ëª…: ê¸°ëŒ€ê°’ (Expectation)

-   ğŸ² ì£¼ì‚¬ìœ„ë¥¼ ë¬´í•œíˆ ë˜ì§€ë©´ í‰ê· ì ìœ¼ë¡œ ëª‡ì´ ë‚˜ì˜¬ê¹Œ?

    -   $X$ê°€ ë‚˜ì˜¨ ìˆ«ìë¥¼ ë‚˜íƒ€ë‚´ëŠ” **í™•ë¥  ë³€ìˆ˜(random variable)**ë¼ í•˜ë©´, ê¸°ëŒ€ê°’(expectation)ì€:

$$
\mathop{\mathbb{E}}(X) = \frac{1}{6} \times 1 + \frac{1}{6} \times 2 + \frac{1}{6} \times 3 + \frac{1}{6} \times 4 + \frac{1}{6} \times 5 + \frac{1}{6} \times 6 = 3.5
$$

-   $\mathop{\mathbb{E}}(.)$ ì—°ì‚°ìëŠ” **ê¸°ëŒ€ê°’(expectation)** ë˜ëŠ” **ëª¨ì§‘ë‹¨ í‰ê· (population mean)**ì„ ì˜ë¯¸í•¨.

-   $\mathop{\mathbb{E}}(.)$ ì—°ì‚°ìëŠ” **ì„ í˜•(linear) ì—°ì‚°ì**ì´ë¯€ë¡œ,

$$
\mathop{\mathbb{E}}(X+Y) = \mathop{\mathbb{E}}(X) + \mathop{\mathbb{E}}(Y)
$$ - ì—¬ê¸°ì„œ $X$ì™€ $Y$ëŠ” ë‘ ê°œì˜ í™•ë¥  ë³€ìˆ˜ì„.

------------------------------------------------------------------------

## ë³´ì¶© ì„¤ëª…: ì¡°ê±´ë¶€ ê¸°ëŒ€ê°’

-   ğŸ² ë‘ ê°œì˜ ì£¼ì‚¬ìœ„ë¥¼ ë˜ì§ˆ ë•Œ, í•œ ì£¼ì‚¬ìœ„ê°€ í•­ìƒ 5ì¼ ê²½ìš° í•©ì˜ í‰ê· ì€?

-   $X$ê°€ ì²« ë²ˆì§¸ ì£¼ì‚¬ìœ„ì˜ ìˆ«ìë¥¼ ë‚˜íƒ€ë‚´ëŠ” í™•ë¥  ë³€ìˆ˜, $Y$ê°€ ë‘ ë²ˆì§¸ ì£¼ì‚¬ìœ„ì˜ ìˆ«ìë¥¼ ë‚˜íƒ€ë‚´ëŠ” í™•ë¥  ë³€ìˆ˜ë¼ í•˜ë©´:

$$
\begin{align}
\mathop{\mathbb{E}}(X+Y|Y = 5) &= \mathop{\mathbb{E}}(X|Y = 5) + \mathop{\mathbb{E}}(Y|Y = 5) \\  
&= \mathop{\mathbb{E}}(X) + 5 \\  
&= 3.5 + 5 \\  
&= 8.5  
\end{align}
$$

-   $\mathop{\mathbb{E}}(.|D = x)$ ì—°ì‚°ìëŠ” **ì¡°ê±´ë¶€ ê¸°ëŒ€ê°’(conditional expectation)**ì„ ì˜ë¯¸í•¨. ì´ëŠ” ëª¨ì§‘ë‹¨ ì „ì²´ê°€ ì•„ë‹ˆë¼, **íŠ¹ì • ì¡°ê±´(**$D = x$)ì„ ë§Œì¡±í•˜ëŠ” í•˜ìœ„ ì§‘ë‹¨(subcategory)ì— ëŒ€í•œ ê¸°ëŒ€ê°’ì„ ê³„ì‚°í•˜ëŠ” ê²ƒ.

------------------------------------------------------------------------

## í‰ê·  ì²˜ì¹˜ íš¨ê³¼ (Average Treatment Effect, ATE) {#ate}

-   ğŸ“Œ ê°€ì¥ í¬ê´„ì ì¸ í‰ê·  íš¨ê³¼

$$
\begin{align}
ATE &= \mathop{\mathbb{E}}(\delta_i) \\  
    &= \mathop{\mathbb{E}}(Y_i^1 - Y_i^0) \\  
    &= \mathop{\mathbb{E}}(Y_i^1) - \mathop{\mathbb{E}}(Y_i^0)  
\end{align}
$$

-   ATEëŠ” ë‹¨ìˆœíˆ **ì „ì²´ ëª¨ì§‘ë‹¨ì—ì„œ ê°œë³„ ì²˜ì¹˜ íš¨ê³¼(individual treatment effects)ì˜ í‰ê· **ì„ ì¸¡ì •í•˜ëŠ” ê²ƒ.

ğŸ”— [**ë¶€ë¡(Appendix):**](#attandatu) ì²˜ì¹˜êµ°ì— ëŒ€í•œ í‰ê·  ì²˜ì¹˜ íš¨ê³¼(ATT)ì™€ ë¹„ì²˜ì¹˜êµ°ì— ëŒ€í•œ í‰ê·  ì²˜ì¹˜ íš¨ê³¼(ATU)

------------------------------------------------------------------------

## ì˜ˆì œ: ì†Œê·œëª¨ vs. ëŒ€ê·œëª¨ í•™ê¸‰

-   í•™ìƒì´ **ì†Œê·œëª¨ í•™ê¸‰(**$Y^1$) ë˜ëŠ” ëŒ€ê·œëª¨ í•™ê¸‰($Y^0$)ì—ì„œ ìˆ˜ì—…ì„ ë“¤ì„ ê²½ìš°, í‰ê·  í‰ì (GPA, 0-10)ì˜ ì ì¬ì  ê²°ê³¼(potential outcomes).

::::: columns
::: {.column width="55%"}
### ğŸ“Š ì ì¬ì  ê²°ê³¼ í…Œì´ë¸”

| í•™ìƒ     |  $Y^1$  |  $Y^0$  | $\delta$ |
|----------|:-------:|:-------:|:--------:|
| 1        |    5    |    2    |    3     |
| 2        |    6    |    4    |    2     |
| 3        |    3    |    6    |    -3    |
| 4        |    5    |    4    |    1     |
| 5        |   10    |    8    |    2     |
| 6        |    2    |    4    |    -2    |
| 7        |    5    |    2    |    3     |
| 8        |    6    |    4    |    2     |
| 9        |    2    |    9    |    -7    |
| 10       |    8    |    2    |    6     |
| **í‰ê· ** | **5.2** | **4.5** | **0.7**  |
:::

::: {.column width="45%"}
### ğŸ”¢ í‰ê·  ì²˜ì¹˜ íš¨ê³¼ (ATE) ê³„ì‚°

$$
\begin{align}
\color{#d90502}{\text{ATE}} &= \mathbb{E}(\delta) \\  
&=\mathbb{E}(Y^1) - \mathbb{E}(Y^0) \\  
&= 5.2 - 4.5 \\  
&= 0.7
\end{align}
$$

$\rightarrow$ **ì†Œê·œëª¨ í•™ê¸‰ì´ ëŒ€ê·œëª¨ í•™ê¸‰ë³´ë‹¤ í‰ê· ì ìœ¼ë¡œ GPAë¥¼ 0.7ì  ë†’ì´ëŠ” íš¨ê³¼**ê°€ ìˆìŒ.

-   âš ï¸ í•˜ì§€ë§Œ ëª¨ë“  í•™ìƒì´ **ë™ì¼í•œ ì²˜ì¹˜ íš¨ê³¼ë¥¼ ê²½í—˜í•œ ê²ƒì€ ì•„ë‹˜!**
:::
:::::

------------------------------------------------------------------------

## ì¸ê³¼ ì¶”ë¡ ì˜ ë¬¸ì œ (The Problem of Causal Inference)

-   ì‹¤ì œë¡œ ATEë¥¼ ê³„ì‚°í•  ë•Œ, **ê²°ì¸¡ ë°ì´í„° ë¬¸ì œ(missing data problem)**ê°€ ë°œìƒí•¨.\
    $\delta_i$ë¥¼ ê³„ì‚°í•  ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ, **ê° ê°œì¸ì— ëŒ€í•´** $Y_i^1$ ë˜ëŠ” $Y_i^0$ ì¤‘ í•˜ë‚˜ê°€ í•­ìƒ ëˆ„ë½ë¨.

-ğŸ“Š ë°ì´í„°ë¥¼ ì´ìš©í•˜ë©´, ì²˜ì¹˜êµ°ê³¼ í†µì œêµ°ì˜ **ë‹¨ìˆœ í‰ê·  ì°¨(Simple Difference in mean Outcomes, SDO)**ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆìŒ.

$$
\begin{align}
SDO &= \mathop{\mathbb{E}}(Y_i^1|D_i=1) - \mathop{\mathbb{E}}(Y_i^0|D_i=0) \\  
&= \underbrace{\frac{1}{N_T}\sum_{i=1}^{N_T}(Y_i|D_i=1)}_{\text{ì²˜ì¹˜êµ°ì˜ í‰ê·  ê²°ê³¼}}  
- \underbrace{\frac{1}{N_C}\sum_{i=1}^{N_C}(Y_i|D_i=0)}_{\text{í†µì œêµ°ì˜ í‰ê·  ê²°ê³¼}}
\end{align}
$$

------------------------------------------------------------------------

## ë‹¨ìˆœ í‰ê·  ì°¨ì´ (Simple Difference in Mean Outcomes): ì˜ˆì œ

-   ğŸ“ **ëª¨ë“  ì •ë³´ë¥¼ ì•„ëŠ” í•™êµì¥ì´ í•™ìƒì„ ìµœì ì˜ ì²˜ì¹˜ ê·¸ë£¹ì— ë°°ì •í•œë‹¤ê³  ê°€ì •í•˜ì.**

:::: columns
::: {.column width="100%"}
| í•™ìƒ     | $Y^1$ | $Y^0$ | $\delta$ | $Y$ | $D$ |
|----------|:-----:|:-----:|:--------:|:---:|:---:|
| 1        |   5   |   2   |    3     |  5  |  1  |
| 2        |   6   |   4   |    2     |  6  |  1  |
| 3        |   3   |   6   |    -3    |  6  |  0  |
| 4        |   5   |   4   |    1     |  5  |  1  |
| 5        |  10   |   8   |    2     | 10  |  1  |
| 6        |   2   |   4   |    -2    |  4  |  0  |
| 7        |   5   |   2   |    3     |  5  |  1  |
| 8        |   6   |   4   |    2     |  6  |  1  |
| 9        |   2   |   9   |    -7    |  9  |  0  |
| 10       |   8   |   2   |    6     |  8  |  1  |
| **í‰ê· ** |       |       | **0.7**  |     |     |
:::
::::

------------------------------------------------------------------------

## ë‹¨ìˆœ í‰ê·  ì°¨ì´ (Simple Difference in Mean Outcomes): ê³„ì‚°

::::: columns
::: {.column width="50%"}
| í•™ìƒ     | $Y$ (ê´€ì¸¡ê°’) | $D$ | $\delta$ |
|----------|:------------:|:---:|:--------:|
| 1        |      5       |  1  |    3     |
| 2        |      6       |  1  |    2     |
| 3        |      6       |  0  |    -3    |
| 4        |      5       |  1  |    1     |
| 5        |      10      |  1  |    2     |
| 6        |      4       |  0  |    -2    |
| 7        |      5       |  1  |    3     |
| 8        |      6       |  1  |    2     |
| 9        |      9       |  0  |    -7    |
| 10       |      8       |  1  |    6     |
| **í‰ê· ** |              |     | **0.7**  |
:::

::: {.column width="50%"}
ğŸ”¢ **ë‹¨ìˆœ í‰ê·  ì°¨ì´ (SDO) ê³„ì‚°**

$$
\begin{align}
SDO &= \frac{5+6+5+10+5+6+8}{7} - \frac{6+4+9}{3} \\  
&\approx 6.43 - 6.33 \approx 0.1
\end{align}
$$

ğŸ“Œ SDO ê°’ì´ ATE(0.7)ë³´ë‹¤ í›¨ì”¬ ì‘ìŒ!

ğŸ“Œ ì´ëŸ¬í•œ ì°¨ì´ëŠ” ì²˜ì¹˜ íš¨ê³¼(causal treatment effect)ë¥¼ ì œëŒ€ë¡œ ë°˜ì˜í•˜ì§€ ëª»í•  ê°€ëŠ¥ì„±ì´ ë†’ìŒ.

ğŸ“Œ ì´ëŸ° "ë‹¨ìˆœ ë¹„êµ" ë°©ì‹ì€ ì¢…ì¢… ê¸°ì, ì •ì¹˜ì¸, ê·¸ë¦¬ê³  í›ˆë ¨ì´ ë¶€ì¡±í•œ ì—°êµ¬ìë“¤ì— ì˜í•´ ì‚¬ìš©ë¨. (But not you now! ğŸ˜‰)
:::
:::::

------------------------------------------------------------------------

## ë‹¨ìˆœ ë¹„êµì˜ ë¬¸ì œì  {#naive_comp}

ğŸ“Œ ë‹¨ìˆœ í‰ê·  ì°¨ì´ (SDO)ë¥¼ ë‹¤ì‹œ ì‘ì„±í•˜ì—¬ ê°œë³„ ì²˜ì¹˜ íš¨ê³¼ $(\delta_i)$ê°€ ë‚˜íƒ€ë‚˜ë„ë¡ ë³€í˜•

$$
\begin{align}
  SDO &= \mathop{\mathbb{E}}(Y_i^1|D_i=1) - \mathop{\mathbb{E}}(Y_i^0|D_i=0) \\  
  &= \mathop{\mathbb{E}}(Y_i^0 + \delta_i | D_i = 1) - \mathop{\mathbb{E}}(Y_i^0 | D_i = 0)
\end{align}
$$

âœ¨ ê°€ì •: ëª¨ë“  ê°œì¸ì— ëŒ€í•´ ì²˜ì¹˜ íš¨ê³¼ê°€ ì¼ì •í•˜ë‹¤ê³  ê°€ì • ($\delta_i = \delta$) ê·¸ëŸ¬ë©´,

$$
  SDO = \delta + \mathop{\mathbb{E}}(Y_i^0 | D_i = 1) - \mathop{\mathbb{E}}(Y_i^0 | D_i = 0)
$$

ê·¸ë¦¬ê³ ,

$$
ATE = \mathop{\mathbb{E}}(\delta_i) = \mathop{\mathbb{E}}(\delta) = \delta
$$

(ìœ„ ê°€ì •ì— ì˜í•´) ë”°ë¼ì„œ:

$$
\begin{equation}
  SDO = ATE + \underbrace{\mathop{\mathbb{E}}(Y_i^0 | D_i = 1) - \mathop{\mathbb{E}}(Y_i^0 | D_i = 0)}_\text{ì„ íƒ í¸í–¥ (Selection Bias)}
\end{equation}
$$

ğŸ”— [**ë¶€ë¡(Appendix)**](#naive_comp_extended): ë§Œì•½ ì²˜ì¹˜ íš¨ê³¼ê°€ ì¼ì •í•˜ë‹¤ëŠ” ê°€ì •ì´ ì™„í™”ë˜ë©´, **ì¶”ê°€ì ì¸ í¸í–¥ í•­(bias term)**ì´ ë‚˜íƒ€ë‚¨.

------------------------------------------------------------------------

## Task 1 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::

**ğŸ“Š ì§ì ‘ ìƒì„±í•œ ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬ ë‹¤ì–‘í•œ ì§€í‘œì™€ í¸í–¥ì„ ê³„ì‚°**

```{r, echo = FALSE, eval = FALSE}
set.seed(1)
id = 1:10000
group = sample(c("treatment","control"), replace = T, size = 10000)
Y0 = sample(c(1:10), replace = T, size = 10000) + ifelse(group == "treatment",1,0)
delta = sample(c(1:3), replace = T, size = 10000) + 0.2*ifelse(group == "treatment",1,0)
cor(Y0, ifelse(group == "treatment",1,0))
cor(delta, ifelse(group == "treatment",1,0))
Y1 = Y0 + delta
set.seed(3)
group_random = sample(c("treatment","control"), replace = T, size = 10000)
cor(Y0, ifelse(group_random == "treatment",1,0))
cor(delta, ifelse(group_random == "treatment",1,0))

toy_data = data.frame(id, group, Y0, Y1)
toy_data <- toy_data %>%
  mutate(group_dummy = ifelse(group == "treatment", 1, 0)) %>%
  select(id, group, group_dummy, Y0, Y1)
toy_data_random = data.frame(id, group_random, Y0, Y1)
toy_data_random <- toy_data_random %>%
  mutate(group_random_dummy = ifelse(group_random == "treatment", 1, 0)) %>%
  select(id, group_random, group_random_dummy, Y0, Y1)

# fwrite(toy_data, here::here("../ScPoEconometrics/introduction/pierre_gustave/toy_data_2.csv"))
# fwrite(toy_data_random, here::here("../ScPoEconometrics/introduction/pierre_gustave/toy_data_random.csv"))
```

ğŸ“‚ **1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë° ë³€ìˆ˜ ìƒì„±**

-   [**ë°ì´í„° ë‹¤ìš´ë¡œë“œ**](https://www.dropbox.com/s/oqc3vq1m9eyp1d6/toy_data_2.csv?dl=1)\
    `read.csv()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸°.

-   **ë³€ìˆ˜ ì„¤ëª…**

    -   `group`: ì²˜ì¹˜ë¥¼ ë°›ì•˜ëŠ”ì§€ ì—¬ë¶€ (`1 = ì²˜ì¹˜êµ°`, `0 = í†µì œêµ°`).\
    -   `Y0`: ì²˜ì¹˜ë¥¼ ë°›ì§€ ì•Šì•˜ì„ ê²½ìš°ì˜ ì ì¬ì  ê²°ê³¼ $(Y_i^0)$.\
    -   `Y1`: ì²˜ì¹˜ë¥¼ ë°›ì•˜ì„ ê²½ìš°ì˜ ì ì¬ì  ê²°ê³¼ $(Y_i^1)$.

-   **ìƒˆë¡œìš´ ë³€ìˆ˜ ìƒì„±**

    -   **ê´€ì¸¡ëœ ê²°ê³¼** $Y_i$: $$
        Y_i = D_i \times Y_i^1 + (1 - D_i) \times Y_i^0
        $$
    -   **ê°œë³„ ì²˜ì¹˜ íš¨ê³¼** $\delta_i$: $$
        \delta_i = Y_i^1 - Y_i^0
        $$

ğŸ“Š **2. ATE ë° SDO ê³„ì‚°**

-   **ATE (Average Treatment Effect) ê³„ì‚°**\
-   **SDO (Simple Difference in Mean Outcomes) ê³„ì‚°**\
-   *Biasê°€ ì¡´ì¬í•˜ëŠ”ê°€? í¬ê¸°ëŠ” ì–¼ë§ˆë‚˜ í°ê°€?*

ğŸ”€ **3. ë¬´ì‘ìœ„ ë°°ì •ëœ ë°ì´í„°ì—ì„œ SDO ê³„ì‚°**

-   [**ìƒˆë¡œìš´ ë°ì´í„° ë‹¤ìš´ë¡œë“œ**](https://www.dropbox.com/s/0qfsonzz1t9gkxi/toy_data_random.csv?dl=1)\
    ì´ ë°ì´í„°ì—ì„œëŠ” ë™ì¼í•œ ê°œì¸ì„ **ì„ì˜ë¡œ ë¬´ì‘ìœ„ ë°°ì •(random assignment)**.

-   $Y_i$ ì¬ê³„ì‚° í•„ìš”!

    -   ìƒˆë¡œìš´ ì²˜ì¹˜ ë°°ì •ì— ë§ì¶° ë‹¤ì‹œ ê³„ì‚°í•´ì•¼ í•¨.

-   **ë¬´ì‘ìœ„ ë°°ì •ì—ì„œ SDO ê³„ì‚°**

    -   í¸í–¥ì´ **ê±°ì˜ 0**ì— ê°€ê¹Œì›Œì•¼ í•¨.\
    -   í•˜ì§€ë§Œ ì •í™•íˆ 0ì´ ë˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ?

ğŸ“Œ **4. (Optional) í¸í–¥ ìš”ì†Œ í™•ì¸**

1.  **ì„ íƒ í¸í–¥(Selection Bias) ê³„ì‚°**\
2.  **ì´ì§ˆì  ì²˜ì¹˜ íš¨ê³¼ í¸í–¥(Heterogeneous Treatment Effect Bias) ê³„ì‚°**\
3.  ì•„ë˜ ì‹ì´ ì„±ë¦½í•˜ëŠ”ì§€ í™•ì¸: $$
    SDO = ATE + \text{Selection Bias} + \text{Heterogeneous Treatment Effect Bias}
    $$

------------------------------------------------------------------------

## ë¬´ì‘ìœ„ ë°°ì •(Randomization)ì€ ì¸ê³¼ ì¶”ë¡  ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤!

**ğŸ“Œ ë¬´ì‘ìœ„ ì‹¤í—˜(Randomized experiments)**:\
- ì‚¬ëŒë“¤ì„ **ë¬´ì‘ìœ„(randomly)**ë¡œ ì²˜ì¹˜êµ°ê³¼ í†µì œêµ°ì— ë°°ì •í•¨.\
- ì´ ê²½ìš°, ì²˜ì¹˜ ë°°ì •ì€ **ì ì¬ì  ê²°ê³¼(potential outcomes)ì™€ ë…ë¦½ì (independent)**.

íŠ¹íˆ, $\mathbb{E}(Y_i^0 | D_i = 1) = \mathbb{E}(Y_i^0 | D_i = 0)$ ì´ ì„±ë¦½í•´ì•¼ í•  ì´ìœ ê°€ ì—†ìŒ.

-   ë”°ë¼ì„œ, **ì„ íƒ í¸í–¥(selection bias)ì´ 0ì´ ë¨**.

âœ… ë¬´ì‘ìœ„ ë°°ì •ì´ ì´ë£¨ì–´ì§„ë‹¤ë©´:

$$
SDO = \mathop{\mathbb{E}}(Y_i^1|D_i=1) - \mathop{\mathbb{E}}(Y_i^0|D_i=0) = ATE
$$

ğŸ‘‰ **ì¦‰, ë°ì´í„°ë¥¼ ì´ìš©í•´ ì§ì ‘ ATEë¥¼ ì¶”ì •í•  ìˆ˜ ìˆìŒ!**

# Randomized Experiments

------------------------------------------------------------------------

## ë¬´ì‘ìœ„ ì‹¤í—˜ (Randomized Experiments)

-   í”íˆ **ë¬´ì‘ìœ„ í†µì œ ì‹¤í—˜(Randomized Controlled Trials, RCTs)**ì´ë¼ê³  ë¶ˆë¦¼.

-   ìµœì´ˆì˜ RCTëŠ” **18\~19ì„¸ê¸°**ì— ì£¼ë¡œ **ì˜í•™** ë¶„ì•¼ì—ì„œ ìˆ˜í–‰ë¨.

-   **20ì„¸ê¸° ì´ˆë°˜**, ìœ ëª…í•œ í†µê³„í•™ì **J. Neyman**ê³¼ **R.A. Fisher**ì— ì˜í•´ ë„ë¦¬ ë³´ê¸‰ë¨.

-   ì´í›„ **ê³µê³µì •ì±… í‰ê°€(public policy evaluation)ì˜ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë„êµ¬**ë¡œ ì ì°¨ ìë¦¬ ì¡ìŒ.\
    ğŸ‘‰ [ì°¸ê³  ìë£Œ](https://www.povertyactionlab.org/fr)

-   **ê²½ì œí•™(Economics)ì—ì„œë„ RCTì˜ ì˜í–¥ë ¥ ì¦ê°€**

    -   **2019ë…„ ë…¸ë²¨ ê²½ì œí•™ìƒ(Nobel Prize in Economics)**ì´ RCT ì—°êµ¬ìë“¤ì—ê²Œ ìˆ˜ì—¬ë¨.\
    -   [Abhijit Banerjee, Esther Duflo, Michael Kremer](https://www.economist.com/finance-and-economics/2019/10/17/a-nobel-economics-prize-goes-to-pioneers-in-understanding-poverty)\
    -   ğŸ“Œ *"ì‹¤í—˜ì  ì ‘ê·¼ì„ í†µí•´ ê¸€ë¡œë²Œ ë¹ˆê³¤ì„ ì™„í™”í•˜ëŠ” ì—°êµ¬"*ì— ê¸°ì—¬.

------------------------------------------------------------------------

## í•™ê¸‰ ê·œëª¨ì™€ í•™ìƒ ì„±ì·¨: ì˜ˆì œ

ì§€ë‚œ ì£¼, **í•™ìƒë“¤ì˜ í‰ê·  ìˆ˜í•™ ë˜ëŠ” ì½ê¸° ì ìˆ˜(math/reading score)ë¥¼ í•™ê¸‰ ê·œëª¨(class size)ì— ëŒ€í•´ íšŒê·€ ë¶„ì„**í•˜ì˜€ìŒ.

$$
\textrm{math score}_i = b_0 + b_1 \textrm{class size}_i + e_i
$$

ê·¸ëŸ¬ë‚˜ $b_1^{OLS}$ëŠ” ì¸ê³¼ê´€ê³„(causal relationship)ê°€ ì•„ë‹ˆë¼ ë‹¨ìˆœí•œ ìƒê´€ê´€ê³„(association)ë§Œì„ ë³´ì—¬ì¤Œ. ê·¸ ì´ìœ ëŠ”?

ğŸ“Œ ì™œ OLS ê³„ìˆ˜ $b_1$ì´ ì¸ê³¼ê´€ê³„ë¥¼ ì¶”ì •í•  ìˆ˜ ì—†ëŠ”ê°€?

1.  **í•™ìƒì˜ ìê¸° ì„ íƒ(Student sorting)**: í•™ë¶€ëª¨ë“¤ì´ **ì‘ì€ í•™ê¸‰ì´ ë” ë‚«ë‹¤**ëŠ” ì„ ì…ê²¬ì„ ê°€ì§€ê³  ìˆë‹¤ë©´, ìë…€ë¥¼ ê·¸ëŸ° í•™êµì— ë³´ë‚´ë ¤ê³  í•  ê²ƒ.

2.  **êµì‚¬ì˜ ìê¸° ì„ íƒ(Teacher sorting)**: **ì‘ì€ í•™ê¸‰ì´ ê°€ë¥´ì¹˜ê¸° ë” ì‰¬ì›€** â†’ êµì‚¬ë“¤ì€ ì‘ì€ í•™ê¸‰ì´ ìˆëŠ” í•™êµë¡œ ì´ë™í•˜ë ¤ í•  ê²ƒ. ë§Œì•½ ì‘ì€ í•™ê¸‰ì´ ìˆëŠ” í•™êµì— **ê²½ìŸì´ ì¡´ì¬í•œë‹¤ë©´**, **ìš°ìˆ˜í•œ êµì‚¬(high-quality teachers)**ê°€ ë” ìœ ë¦¬í•  ê°€ëŠ¥ì„±ì´ í¼.

3.  **ì§€ì—­(Location effect)**: **ëŒ€ê·œëª¨ í•™ê¸‰**ì€ **ë¶€ìœ í•œ ëŒ€ë„ì‹œ**ì—ì„œ ë” í”í•  ìˆ˜ ìˆìŒ. **ì†Œê·œëª¨ í•™ê¸‰**ì€ **ê°€ë‚œí•œ ë†ì´Œ ì§€ì—­**ì—ì„œ ë” í”í•  ê°€ëŠ¥ì„±ì´ ìˆìŒ.

âœ… **RCTë¥¼ ìˆ˜í–‰í•˜ë©´ ì´ëŸ¬í•œ ëª¨ë“  í¸í–¥(bias)ì„ ì œê±°í•  ìˆ˜ ìˆìŒ!**

------------------------------------------------------------------------

## í”„ë¡œì íŠ¸ STAR ì‹¤í—˜ (The Project STAR Experiment)

**í…Œë„¤ì‹œ í•™ìƒ-êµì‚¬ ì„±ì·¨ ë¹„ìœ¨ ì‹¤í—˜ (Tennessee Student/Teacher Achievement Ratio Experiment)**\
ğŸ“– [Krueger (1999)](http://piketty.pse.ens.fr/files/Krueger1999.pdf) ì°¸ê³ .

-   **í…Œë„¤ì‹œ ì£¼ì˜íšŒ(Tennessee legislature)ì—ì„œ ì´ ì•½ 1,200ë§Œ ë‹¬ëŸ¬(\$12 million) ì˜ˆì‚° ì§€ì›**.\
-   **1985-1986 í•™ë…„ë„ì— ì‹œì‘**, ì´ **4ë…„ê°„ ì§„í–‰ë¨**.

ğŸ”¬ **ì‹¤í—˜ ì„¤ê³„**

-   **11,600ëª…ì˜ í•™ìƒê³¼ êµì‚¬**ê°€ **ë¬´ì‘ìœ„ë¡œ(randomly assigned)** ì•„ë˜ 3ê°œ ê·¸ë£¹ ì¤‘ í•˜ë‚˜ì— ë°°ì •ë¨.\

-   ì‹¤í—˜ì€ **ìœ ì¹˜ì›ë¶€í„° 3í•™ë…„ê¹Œì§€(Kindergarten \~ 3rd grade) ì§€ì†ë¨.**

    1ï¸âƒ£ **ì†Œê·œëª¨ í•™ê¸‰(Small clas**\*): **í•™ìƒ ìˆ˜: 13\~17ëª… / êµì‚¬ 1ì¸**

    2ï¸âƒ£ **ì¼ë°˜ í•™ê¸‰(Regular class)** :**í•™ìƒ ìˆ˜: 22\~25ëª… / êµì‚¬ 1ì¸**

    3ï¸âƒ£ \*\*ì¼ë°˜ í•™ê¸‰ + ë³´ì¡° êµì‚¬(Regular/aide class)\*: **í•™ìƒ ìˆ˜: 22\~25ëª… / êµì‚¬ 1ì¸ + í’€íƒ€ì„ ë³´ì¡° êµì‚¬(full-time aide)**

ğŸ“Š **ì‹¤í—˜ ê³¼ì •**

-   **ê° í•™êµ ë‚´ì—ì„œ ë¬´ì‘ìœ„ ë°°ì •(randomization within schools)** ì§„í–‰.\
-   **ë§¤ë…„ 3ì›”ê²½ í•™ìƒë“¤ì˜ ìˆ˜í•™(Math) ë° ì½ê¸°(Reading) ëŠ¥ë ¥ í‰ê°€ ì‹¤ì‹œ**.

âš ï¸ **ë¹„ëœë¤ íƒˆë½ ë¬¸ì œ(Non-random Attrition)**

-   ì¼ë¶€ í•™ìƒë“¤ì´ **ë¬´ì‘ìœ„ ë°°ì • ì´í›„ ì‹¤í—˜ì—ì„œ ì´íƒˆ**í•˜ëŠ” ë¬¸ì œ ë°œìƒ.\
-   **ê·¸ëŸ¬ë‚˜ ì—¬ê¸°ì—ì„œëŠ” í•´ë‹¹ ë¬¸ì œë¥¼ ë¬´ì‹œí•¨.**

------------------------------------------------------------------------

## Task 2 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::

ğŸ“‚ 1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° - [**STAR ë°ì´í„° ë‹¤ìš´ë¡œë“œ**](https://www.dropbox.com/s/bf1fog8yasw3wjj/star_data.csv?dl=1)\
- ë°ì´í„°ë¥¼ `star_df` ê°ì²´ì— ì €ì¥.\
- ë³€ìˆ˜ ì„¤ëª…ì„ ì´í•´í•˜ë ¤ë©´ [**ë„ì›€ë§ í™•ì¸**](https://rdrr.io/cran/AER/man/STAR.html).\
(ğŸ“Œ**ë°ì´í„°ê°€ ì¬êµ¬ì„±(reshaped)ë˜ì—ˆìœ¼ë¯€ë¡œ, ë³€ìˆ˜ëª… ëì˜ "k", "1" ë“±ì˜ ìˆ«ìëŠ” ë¬´ì‹œ.**)

```{r}
star_df = readr::read_csv(file = "https://www.dropbox.com/s/bf1fog8yasw3wjj/star_data.csv?dl=1")
```

ğŸ” 2. ë°ì´í„°ì˜ ê¸°ë³¸ ì •ë³´ í™•ì¸

-   **ê´€ì°° ë‹¨ìœ„(Unit of observation)**ëŠ” ë¬´ì—‡ì¸ê°€?
-   ë‹¤ìŒ ë‚´ìš©ì„ í¬í•¨í•˜ëŠ” ë³€ìˆ˜ëŠ”? (i) ëœë¤ í•™ê¸‰ ë°°ì •(random class assignment), (ii) í•™ìƒì˜ í•™ë…„(class grade), (iii) ê´€ì‹¬ ìˆëŠ” ê²°ê³¼ ë³€ìˆ˜(outcomes of interest)

```{r, eval=FALSE}
# ë°ì´í„° êµ¬ì¡° í™•ì¸
str(star_df)
```

ğŸ“Š 3. ë°ì´í„° í¬ê¸° ë° ê²°ì¸¡ê°’(NA) ë¶„ì„

-   ì´ ê´€ì¸¡ì¹˜ ìˆ˜ëŠ” ëª‡ ê°œì¸ê°€? 11,598ëª…ì˜ í•™ìƒì´ ì‹¤í—˜ì— ì°¸ì—¬í–ˆëŠ”ë°, ì™œ ê´€ì¸¡ì¹˜ê°€ ë” ë§ì€ê°€? NA ê°’ì´ ë§ì€ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€? ì´ë“¤ì´ ì˜ë¯¸í•˜ëŠ” ê²ƒì€?

```{r, eval=FALSE}
# ì´ ê´€ì¸¡ì¹˜ ìˆ˜ í™•ì¸
nrow(star_df)

# ê²°ì¸¡ê°’ ê°œìˆ˜ í™•ì¸
sum(is.na(star_df))

# ê²°ì¸¡ê°’ì´ í¬í•¨ëœ ë³€ìˆ˜ í™•ì¸
colSums(is.na(star_df))
```

ğŸš€ 4. ê²°ì¸¡ê°’ ì²˜ë¦¬ (NA ì œê±°)

-   ë‹¤ìŒ ì½”ë“œ ì‹¤í–‰í•˜ì—¬ ê²°ì¸¡ê°’ì´ ì—†ëŠ” ê²½ìš°ë§Œ ìœ ì§€:

```{r, eval=FALSE}
star_df <- star_df[complete.cases(star_df)
```

ğŸ“ˆ 5. ë¬´ì‘ìœ„ ë°°ì • í™•ì¸ (Balancing Checks)

-   ëœë¤ ë°°ì •ì´ ì˜ ì´ë£¨ì–´ì¡ŒëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´, ê·¸ë£¹ë³„ ê¸°ì´ˆ í†µê³„ëŸ‰ì„ ê³„ì‚°.
-   ë‹¤ìŒ í•­ëª©ë³„ í‰ê·  ë¹„ìœ¨(%)ì„ í•™ë…„ë³„(grade) ë° ì²˜ì¹˜êµ°ë³„(treatment class)ë¡œ ë¹„êµ: 1ï¸âƒ£ ì—¬í•™ìƒ ë¹„ìœ¨ (percentage of girls), 2ï¸âƒ£ ì•„í”„ë¦¬ì¹´ê³„ ë¯¸êµ­ì¸ ë¹„ìœ¨ (percentage of African Americans), 3ï¸âƒ£ ë¬´ë£Œ ê¸‰ì‹ ëŒ€ìƒ ë¹„ìœ¨ (percentage of free lunch qualifiers)

(ğŸ“Œ íŒíŠ¸: ë‹¤ìŒ ì½”ë“œë¡œ ì—¬í•™ìƒ ë¹„ìœ¨ ê³„ì‚° ê°€ëŠ¥ (dplyr í™œìš© í•„ìš”): `share_female = mean(gender == "female") * 100`.)

```{r, echo = FALSE}
# data("STAR", package = "AER")
# star <- STAR %>%
#     pivot_longer(
#         cols = -c(gender, ethnicity, birth),
#         names_to = c(".value", "grade"),
#         names_pattern = "(.+)(k|1|2|3)$")
# write.csv2(star, file = "star_data.csv", row.names = F)
star_df = readr::read_csv(file = "https://www.dropbox.com/s/bf1fog8yasw3wjj/star_data.csv?dl=1")
star_df <- star_df[complete.cases(star_df),]
```

------------------------------------------------------------------------

## í”„ë¡œì íŠ¸ STAR ì‹¤í—˜

âœ… RCTì—ì„œ í‰ê·  ì²˜ì¹˜ íš¨ê³¼(ATE) ì¶”ì • ë°©ë²•

-   **ë¬´ì‘ìœ„ í†µì œ ì‹¤í—˜(Randomized Controlled Trial, RCT)**ì—ì„œëŠ” **ì²˜ì¹˜êµ°(treatment group)ê³¼ í†µì œêµ°(control group)ì˜ ê²°ê³¼ ì°¨ì´**ë¥¼ ì´ìš©í•´ **í‰ê·  ì²˜ì¹˜ íš¨ê³¼(Average Treatment Effect, ATE)**ë¥¼ ì¶”ì •í•  ìˆ˜ ìˆìŒ.

ë‹¤ìŒê³¼ ê°™ì€ ì„¤ì •í•˜ì:

-   **ì²˜ì¹˜êµ°(Treatment Group)**: **ì†Œê·œëª¨ í•™ê¸‰(Small class)**\
-   **í†µì œêµ°(Control Group)**: **ì¼ë°˜ í•™ê¸‰(Regular class)**\
-   **ëŒ€ìƒ í•™ë…„(Grade)**: **ìœ ì¹˜ì›(Kindergarten, k)**

```{r, echo = FALSE}
diff_table = data.frame(
    grade = rep(c("1","2","3","k"), each = 2),
    test = rep(c("math","read"), times = 4),
    star_df  %>%
        pivot_longer(cols = c("math","read"), names_to = "test", values_to = "score") %>%
        filter(star == "regular") %>%
        group_by(grade, test) %>%
        summarise(mean_regular = round(mean(score), 3)) %>%
        ungroup() %>%
        select(mean_regular),
    star_df %>%
        pivot_longer(cols = c("math","read"), names_to = "test", values_to = "score") %>%
        filter(star == "small") %>% group_by(grade, test) %>%
        summarise(mean_small = round(mean(score), 3)) %>%
        ungroup() %>%
        select(mean_small),
    star_df %>%
        pivot_longer(cols = c("math","read"), names_to = "test", values_to = "score") %>%
        filter(star == "regular+aide") %>%
        group_by(grade, test) %>%
        summarise(mean_regular_aide = round(mean(score), 3)) %>%
        ungroup() %>%
        select(mean_regular_aide)) %>%
    mutate(
        diff_small_regular = round(mean_small - mean_regular, 3),
        diff_regular_aide_regular = round(mean_regular_aide - mean_regular, 3)
    ) %>%
    arrange(factor(grade, levels = c("k","1","2","3")))
```

| grade | test | mean regular | mean small | ATE |
|---------------|---------------|:-------------:|:-------------:|:-------------:|
| k | math | `r round(diff_table[1,3], 2)` | `r round(diff_table[1,4], 2)` | `r round(diff_table[1,4] - diff_table[1,3], 2)` |
| k | read | `r round(diff_table[2,3], 2)` | `r round(diff_table[2,4], 2)` | `r round(diff_table[2,4] - diff_table[2,3], 2)` |

ğŸ“Œ ì´ ATE ê°’ë“¤ì˜ í•´ì„ì€?

ğŸ“‰ íšŒê·€ë¶„ì„(regression)ìœ¼ë¡œ í‘œí˜„í•œë‹¤ë©´?

------------------------------------------------------------------------

## RCTë¥¼ íšŒê·€ ë¶„ì„ í˜•íƒœë¡œ í‘œí˜„í•˜ê¸°

ğŸ¯ **RCTì—ì„œ ê²°ê³¼ ë³€ìˆ˜ì˜ ê¸°ë³¸ í‘œí˜„**

$$
Y_i = D_i Y_i^1 + (1 - D_i) Y_i^0
$$

âœ¨ $D_i$ë¥¼ ì¸ìˆ˜ë¶„í•´í•˜ê³ , $Y_i^1 - Y_i^0$ë¥¼ $\delta_i$ë¡œ ëŒ€ì²´í•˜ë©´:

$$
\begin{align} 
Y_i &= Y_i^0 + D_i (Y_i^1 - Y_i^0) \\  
&= Y_i^0 + D_i \delta_i  
\end{align}
$$

ğŸ“Œ $\delta_i = \delta$ (ëª¨ë“  $i$ì— ëŒ€í•´ ë™ì¼í•œ ì²˜ì¹˜ íš¨ê³¼ ê°€ì •)

$$
Y_i = Y_i^0 + D_i \delta
$$

ğŸ”„ **ìš°í•­ì—** $\mathbb{E}[Y_i^0] - \mathbb{E}[Y_i^0] = 0$ì„ ì¶”ê°€í•˜ë©´:

$$
\begin{align} 
Y_i &= \mathbb{E}[Y_i^0] + D_i \delta + Y_i^0 - \mathbb{E}[Y_i^0] \\  
&= b_0 + \delta D_i + e_i  
\end{align}
$$

ì—¬ê¸°ì„œ,\
- $b_0 = \mathbb{E}[Y_i^0]$ (í†µì œêµ°ì˜ í‰ê·  ê²°ê³¼)\
- $e_i = Y_i^0 - \mathbb{E}[Y_i^0]$ (ì˜¤ì°¨í•­, ê°œë³„ì  ë³€ë™)

âœ… **ì¦‰, RCTë¥¼ ë‹¨ìˆœí•œ íšŒê·€ ë¶„ì„ í˜•íƒœë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŒ!**\
ì´ì œ ì‹¤ì œ ë°ì´í„°ì—ì„œ ì´ë¥¼ ì–´ë–»ê²Œ ì¶”ì •í• ì§€ ì‚´í´ë³´ì. ğŸš€

------------------------------------------------------------------------

## í”„ë¡œì íŠ¸ STAR ì‹¤í—˜: íšŒê·€ ë¶„ì„

ğŸ¯ **ì§€ë‚œ ë²ˆ ë³¸ ë‹¨ìˆœ íšŒê·€ ëª¨ë¸ê³¼ ë™ì¼í•œ í˜•íƒœ!** - ë§ˆì§€ë§‰ ì‹ì€ ìš°ë¦¬ê°€ ì§€ë‚œì£¼ì— í•™ìŠµí•œ **ë‹¨ìˆœ íšŒê·€ ëª¨ë¸(simple regression model)**ê³¼ ë™ì¼. - ì—¬ê¸°ì„œ $\delta = b_1$ë¡œ í•´ì„ ê°€ëŠ¥.

âœ… **ë”°ë¼ì„œ, ì†Œê·œëª¨ í•™ê¸‰(small class)ì— ë°°ì •ëœ ê²ƒì´ ìˆ˜í•™ ì„±ì (math score)ì— ë¯¸ì¹˜ëŠ” ATEë¥¼ ì¶”ì •í•´ë³´ì.**

ğŸ“Š **ì¶”ì •í•  íšŒê·€ ëª¨ë¸** $$
\text{math score}_i = b_0 + \delta \text{small}_i + e_i
$$

ì—¬ê¸°ì„œ,\
$$
\text{small}_i = 
\begin{cases} 
1 \quad \text{(ì†Œê·œëª¨ í•™ê¸‰ ë°°ì •)}  \\\\ 
0 \quad \text{(ì¼ë°˜ í•™ê¸‰ ë°°ì •)}
\end{cases}
$$

::::: columns
::: {.column width="60%"}
```{r, echo = TRUE}
star_df_k_small <- star_df %>%
    filter(star %in% c("regular", "small") &
           grade == "k") %>% 
  mutate(small = (star == "small"))
```

```{r, eval = F}
star_df_k_small %>% count(star, grade)

star_df_k_small %>% count(small)
```
:::

::: {.column width="40%"}
```{r, echo = FALSE}
star_df_k_small %>%
  count(star, grade)

star_df_k_small %>%
  count(small)
```
:::
:::::

------------------------------------------------------------------------

## í”„ë¡œì íŠ¸ STAR ì‹¤í—˜: íšŒê·€ ë¶„ì„

ğŸ“Œ ì¶”ì •í•  íšŒê·€ ëª¨ë¸ $$
\text{math score}_i = b_0 + \delta \text{small}_i + e_i
$$

```{r}
# íšŒê·€ ë¶„ì„ ì‹¤í–‰
lm(math ~ small, data = star_df_k_small)
```

ğŸ“Œ íšŒê·€ ë¶„ì„ ê³„ìˆ˜ ì˜ë¯¸ ì •ë¦¬

$b_0 = \mathbb{E}[Y_i^0]$ and $\delta = \mathbb{E}[Y_i | D_i = 1] - \mathbb{E}[Y_i | D_i = 0]$

-   $b_0$: í†µì œêµ°(ì¼ë°˜ í•™ê¸‰)ì˜ í‰ê·  ìˆ˜í•™ ì ìˆ˜
-   $\delta$: ì†Œê·œëª¨ í•™ê¸‰ê³¼ ì¼ë°˜ í•™ê¸‰ì˜ í‰ê·  ì ìˆ˜ ì°¨ì´

::::: columns
::: {.column width="50%"}
```{r, echo=TRUE}
b_0 = mean(star_df_k_small$math[
    star_df_k_small$small == FALSE])
b_0
```
:::

::: {.column width="50%"}
```{r, echo=TRUE}
delta = mean(star_df_k_small$math[
    star_df_k_small$small == TRUE]) - 
  mean(star_df_k_small$math[
    star_df_k_small$small == FALSE])
delta
```
:::
:::::

------------------------------------------------------------------------

## ë”ë¯¸ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œ íšŒê·€ ë¶„ì„: ê·¸ë˜í”„

**ğŸ“Œ ì´ë²ˆ íšŒê·€ ë¶„ì„ì˜ ë…ë¦½ ë³€ìˆ˜(regressor)ëŠ” ë”ë¯¸ ë³€ìˆ˜(dummy variable)**

```{r, echo = F, fig.height=4.75, fig.width = 8}
# ë”ë¯¸ ë³€ìˆ˜ë¥¼ ìˆ«ìë¡œ ë³€í™˜í•˜ì—¬ ì‹œê°í™”
baseline_graph <- star_df_k_small %>%
    mutate(small = ifelse(small == "TRUE",1,0)) %>%
    ggplot(aes(x = small, y = math)) +
    geom_count(alpha = .7) +
    labs(
      x = "Assigned to a small class", 
      y = "Math score", 
      size = "Number of students"
    ) +
    scale_x_continuous(
      lim = c(-.5,1.5), 
      breaks = c(0,1), 
      labels = c("0\nFALSE", "1\nTRUE")
    ) +
    theme_bw(base_size = 20) +
    theme(
      legend.position = c(0,1),
      legend.justification = c(0,1),
      legend.background = element_blank(),
      legend.key = element_blank(),
      legend.text = element_text(size = 12),
      legend.title = element_text(size = 12, face = "italic")
    ) 

baseline_graph
```

------------------------------------------------------------------------

## ë”ë¯¸ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œ íšŒê·€ ë¶„ì„: ê·¸ë˜í”„

**ğŸ“Œ ì´ë²ˆ íšŒê·€ ë¶„ì„ì˜ ë…ë¦½ ë³€ìˆ˜(regressor)ëŠ” ë”ë¯¸ ë³€ìˆ˜(dummy variable)**

```{r, echo = F, fig.height=4.75, fig.width = 8}
# ê¸°ì¡´ baseline ê·¸ë˜í”„ì— í‰ê· ê°’ í‘œì‹œ ì¶”ê°€
baseline_graph_mean = baseline_graph + 
    stat_summary(fun = mean, colour = c("#d90502","#DE9854"), size = .75, alpha = 0.9) +
    annotate("text", x = 0.04, y = b_0 - 12, hjust = 0, 
             label = "E(Y | small = 0)", size = 5, colour = "#d90502") +
    annotate("text", x = 0.04 + 1, y = b_0 + delta + 16, hjust = 0, 
             label = "E(Y | small = 1)", size = 5, colour = "#DE9854")

# ê·¸ë˜í”„ ì¶œë ¥
baseline_graph_mean
```

------------------------------------------------------------------------

## ë”ë¯¸ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œ íšŒê·€ ë¶„ì„: ê·¸ë˜í”„

**ğŸ“Œ ì´ë²ˆ íšŒê·€ ë¶„ì„ì˜ ë…ë¦½ ë³€ìˆ˜(regressor)ëŠ” ë”ë¯¸ ë³€ìˆ˜(dummy variable)**

```{r, echo = F, fig.height=4.75, fig.width = 8}
# íšŒê·€ì„ (Regression Line) ì¶”ê°€
baseline_graph_mean + 
    geom_abline(slope = delta, intercept = b_0) +
    geom_curve(aes(x = -0.3, xend = -0.2, y = 425 , yend = b_0 - .5*delta - 5), size = .5, linetype = 1, colour = "black", arrow = arrow(length = unit(0.3, "cm"))) +
    annotate("text", x = -0.5, y = 415, hjust = 0, label = "Regression line", size = 5)
```

------------------------------------------------------------------------

## ë”ë¯¸ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œ íšŒê·€ ë¶„ì„: ê·¸ë˜í”„

**ğŸ“Œ ì´ë²ˆ íšŒê·€ ë¶„ì„ì˜ ë…ë¦½ ë³€ìˆ˜(regressor)ëŠ” ë”ë¯¸ ë³€ìˆ˜(dummy variable)**

```{r, echo = FALSE, fig.height=4.75, fig.width = 8}
#ë”ë¯¸ ë³€ìˆ˜(small = 1 ë˜ëŠ” small = 0)ì— ë”°ë¥¸ ìˆ˜í•™ ì ìˆ˜(Math Score) ë¶„í¬ í™•ì¸
star_df_k_small %>%
    mutate(small = ifelse(small == "TRUE",1,0)) %>%
    filter(math >= 475 & math <= 500) %>%
    ggplot(aes(x = small, y = math)) +
    geom_segment(aes(x = 0, xend = 1.25, y = b_0, yend = b_0), 
                 size = .5, linetype = 2, colour = "grey") +
    geom_segment(aes(x = 1, xend = 1.25, y = b_0 + delta, yend = b_0 + delta), 
                 size = .5, linetype = 2, colour = "grey") +
    geom_count(alpha = .7) +
    stat_summary(data = star_df_k_small %>%
                     mutate(small = ifelse(small == "TRUE",1,0)), 
                 fun = mean, colour = c("#d90502","#DE9854"), 
                 size = .75, alpha = 0.9) +
    geom_abline(slope = delta, intercept = b_0) +
    geom_segment(aes(x = 1.25, xend = 1.25, y = b_0, yend = b_0 + delta), 
                 size = .5, linetype = 1, colour = "black", 
                 arrow = arrow(length = unit(0.3, "cm"), ends = "both")) +
    annotate("text", x = 0.06, y = b_0 - 1, hjust = 0, 
             label = "E(Y | small = 0)", col = "#d90502", size = 5) +
    annotate("text", x = 0.5, y = b_0 + delta + .5, hjust = 0, 
             label = "E(Y | small = 1)", col = "#DE9854", size = 5) +
    annotate("text", x = 1.28, y = b_0 + (delta/2), hjust = 0, 
             parse = TRUE, label = "delta", col = "black", size = 8) +
    labs(x = "Assigned to a small class", 
         y = "Math score", 
         size = "Number of students") +
    scale_x_continuous(lim = c(-.5,1.5), 
                       breaks = c(0,1), 
                       labels = c("0\nFALSE","1\nTRUE")) +
    theme_bw(base_size = 20) +
    theme(legend.position = c(0,1),
          legend.justification = c(0,1),
          legend.background = element_blank(),
          legend.key=element_blank(),
          legend.text = element_text(size = 12),
          legend.title = element_text(size = 12, face = "italic"))
```

------------------------------------------------------------------------

## ë”ë¯¸ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œ íšŒê·€ ë¶„ì„: ê³µì‹ìœ¼ë¡œ í‘œí˜„

ğŸ“Œ íšŒê·€ ëª¨ë¸: $\text{math score}_i = b_0 + \delta \text{small}_i + e_i$

ğŸ“Œ ì¼ë°˜ í•™ê¸‰(í†µì œêµ°, $small_i = 0$)ì—ì„œì˜ ê¸°ëŒ€ê°’ $$
\begin{align} 
\mathbb{E}[\textrm{math score} | \text{small}_i = 0] 
&= \mathbb{E}[b_0 + \delta \text{small}_i + e_i | \text{small}_i = 0] \\  
&= b_0 + \delta \mathbb{E}[\text{small}_i| \text{small}_i = 0] + \mathbb{E}[e_i|\text{small}_i = 0] \\  
&= b_0  
\end{align}
$$

ğŸ“Œ ì†Œê·œëª¨ í•™ê¸‰(ì²˜ë¦¬êµ°, $small_i = 1$)ì—ì„œì˜ ê¸°ëŒ€ê°’ $$
\begin{align} 
\mathbb{E}[\textrm{math score} | \text{small}_i = 1]  
&= \mathbb{E}[b_0 + \delta \text{small}_i + e_i | \text{small}_i = 1] \\  
&= b_0 + \delta \mathbb{E}[\text{small}_i| \text{small}_i = 1] + \mathbb{E}[e_i|\text{small}_i = 1] \\  
&= b_0 + \delta  
\end{align}
$$

ğŸ“Œ í‰ê·  ì²˜ì¹˜ íš¨ê³¼ (ATE) ê³„ì‚° $$
\begin{align} 
ATE &= \mathbb{E}[\textrm{math score} | \text{small}_i = 1] - \mathbb{E}[\textrm{math score} | \text{small}_i = 0] \\  
&= b_0 + \delta - b_0 \\  
&= \delta  
\end{align}
$$

âœ… **ì´ë¯¸ ì•Œê³  ìˆì—ˆì§€ë§Œ, ì´ì œ ì´ ê²°ê³¼ê°€ ì™œ ì„±ë¦½í•˜ëŠ”ì§€ ê³µì‹ì ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆìŒ!** ğŸ‰

------------------------------------------------------------------------

## Task 3 {background-color="#ffebf0"}

::: {style="position: absolute; top: -30px; right: 10px; font-size: 0.8em;"}
`r countdown(minutes = 10, top = 0)`
:::

ğŸ“Œ 1. ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ **1í•™ë…„(grade == "1")ì´ë©°, ì¼ë°˜ í•™ê¸‰(regular) ë˜ëŠ” ì†Œê·œëª¨ í•™ê¸‰(small)ì— ì†í•œ í•™ìƒë“¤ë§Œ ì„ íƒ**.

```{r, echo=FALSE}
star_df_clean <- star_df %>%
    filter(grade == "1" & star %in% c("small", "regular"))
```

ğŸ“Š 2. ë‘ ê·¸ë£¹ì˜ í‰ê·  ìˆ˜í•™ ì ìˆ˜ ë° ì°¨ì´ ê³„ì‚° (Base R ì‚¬ìš©)

```{r, echo=FALSE, eval = FALSE}
# ì¼ë°˜ í•™ê¸‰(regular)ê³¼ ì†Œê·œëª¨ í•™ê¸‰(small) í‰ê·  ìˆ˜í•™ ì ìˆ˜ ê³„ì‚°
mean_math_regular <- mean(star_df_clean$math[star_df_clean$star == "regular"])
mean_math_small <- mean(star_df_clean$math[star_df_clean$star == "small"])

# ë‘ ê·¸ë£¹ ê°„ ì°¨ì´ ê³„ì‚°
diff_math <- mean_math_small - mean_math_regular

# ê²°ê³¼ ì¶œë ¥
mean_math_regular
mean_math_small
diff_math
```

ğŸ”„ 3. ë”ë¯¸ ë³€ìˆ˜ ìƒì„±: ì†Œê·œëª¨ í•™ê¸‰(small) = 1 (TRUE), ì¼ë°˜ í•™ê¸‰(regular) = 0 (FALSE) *íŒíŠ¸:* `treatment = (star == "small")`.

```{r, echo=FALSE, eval = FALSE}
star_df_clean <- star_df_clean %>%
    mutate(treatment = (star == "small"))
```

ğŸ“ˆ 4. íšŒê·€ ë¶„ì„ ì‹¤í–‰

```{r, echo=FALSE, eval = FALSE}
lm_result <- lm(math ~ treatment, data = star_df_clean)
summary(lm_result)
```

â“ 5. ê²°ê³¼ í•´ì„: íšŒê·€ ë¶„ì„ ê²°ê³¼ê°€ 2ë²ˆ ì§ˆë¬¸ì—ì„œ êµ¬í•œ í‰ê·  ì°¨ì´ì™€ ì¼ì¹˜í•˜ëŠ”ê°€?

------------------------------------------------------------------------

## RCTì˜ í•œê³„

âœ… **RCTsëŠ” ê°•ë ¥í•œ ë‚´ë¶€ íƒ€ë‹¹ì„±(Internal Validity)ì„ ê°€ì§€ë©°, ì¸ê³¼ê´€ê³„ë¥¼ ëª…í™•íˆ í™•ì¸í•  ìˆ˜ ìˆìŒ.** í•˜ì§€ë§Œ ëª‡ ê°€ì§€ ì¤‘ìš”í•œ í•œê³„ì ì´ ì¡´ì¬í•¨.

-   âš ï¸ **1. RCT ì‹¤í–‰ì˜ ì–´ë ¤ì›€**
    -   **RCTëŠ” ì¢…ì¢… ì‹¤í–‰ì´ ë¶ˆê°€ëŠ¥í•¨.**
        -   ğŸ¦ **ë¹„ìš© ë¬¸ì œ**: RCTëŠ” **ë§¤ìš° ë¹„ìš©ì´ ë§ì´ ë“¦**\
        -   âš–ï¸ **ìœ¤ë¦¬ì  ë¬¸ì œ**: ì¼ë¶€ ì²˜ì¹˜(treatment)ëŠ” **ìœ¤ë¦¬ì  ë¬¸ì œ**ë¡œ ì¸í•´ íŠ¹ì • ê·¸ë£¹ì— ì ìš©í•  ìˆ˜ ì—†ìŒ\
        -   â³ **ì‹œê°„ ì œì•½**: RCTëŠ” ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ë©°, ê¸‰í•˜ê²Œ ê²°ê³¼ê°€ í•„ìš”í•œ ê²½ìš°ì—ëŠ” ì ì ˆí•˜ì§€ ì•ŠìŒ
-   ğŸ” **2. ê²°ê³¼ í•´ì„ì˜ ì–´ë ¤ì›€**
    -   ğŸŒ **ì™¸ë¶€ íƒ€ë‹¹ì„±(External Validity)**:
        -   íŠ¹ì • RCTì˜ ê²°ê³¼ê°€ ë‹¤ë¥¸ **êµ­ê°€, ì¸êµ¬ì§‘ë‹¨ ë“±ìœ¼ë¡œ ì¼ë°˜í™” ê°€ëŠ¥í• ê¹Œ?**\
        -   ì—°êµ¬ ëŒ€ìƒì´ ì œí•œì ì´ë©´ **ë‹¤ë¥¸ í™˜ê²½ì—ì„œë„ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜¬ê¹Œ?**
    -   ğŸ”¬ **ë©”ì»¤ë‹ˆì¦˜ ë¶„ì„ì˜ ì–´ë ¤ì›€**:
        -   ì–´ë–¤ **ë©”ì»¤ë‹ˆì¦˜**ì´ ì‘ë™í–ˆëŠ”ì§€ ë¶„ì„í•˜ëŠ” ê²ƒì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ
    -   ğŸ² **ì™„ë²½í•˜ì§€ ì•Šì€ ë¬´ì‘ìœ„ ë°°ì •**
        -   **ì‹¤ì œ RCTì—ì„œëŠ” ì™„ì „í•œ ëœë¤í™”ê°€ ì–´ë µê³ **, **ì´íƒˆ(Attrition) ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ**

âœ… **RCTëŠ” ì¸ê³¼ê´€ê³„ë¥¼ ë¶„ì„í•˜ëŠ” ê°•ë ¥í•œ ë„êµ¬ì§€ë§Œ, í•œê³„ë¥¼ ì´í•´í•˜ê³  ë³´ì™„í•  í•„ìš”ê°€ ìˆìŒ!** ğŸ¯

------------------------------------------------------------------------

## ğŸš€ ì•ìœ¼ë¡œ ë°°ìš¸ ë‚´ìš©

âœ… **RCTì— ì˜ì¡´í•  ìˆ˜ ì—†ë‹¤ë©´?**\
- ìš°ë¦¬ëŠ” ***ì‹¤í—˜ ë°ì´í„°(Experimental Data)*** ê°€ ì•„ë‹Œ, ***ê´€ì¸¡ ë°ì´í„°(Observational Data)*** ë¥¼ ì´ìš©í•˜ì—¬ **ì¸ê³¼ ì¶”ë¡ (Causal Inference)** ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ.

ğŸ“Œ ë‘ ê°€ì§€ ì£¼ìš”í•œ ê²½ìš°

-   **âœ… ì„ íƒì´ ê´€ì¸¡ ê°€ëŠ¥í•œ íŠ¹ì„±(Observable Characteristics)ì—ì„œ ë°œìƒí•˜ëŠ” ê²½ìš°**
    -   **ë‹¤ì¤‘ íšŒê·€(Multiple Regression)** â†’ **ë‹¤ìŒ ì£¼ì— í•™ìŠµ!**
-   **âš ï¸ ì„ íƒì´ ê´€ì¸¡ ë¶ˆê°€ëŠ¥í•œ íŠ¹ì„±(Unobservable Characteristics)ì—ì„œ ë°œìƒí•˜ëŠ” ê²½ìš°**
    -   **íšŒê·€ ë¶ˆì—°ì† ì„¤ê³„(Regression Discontinuity Design, RDD)** â†’ **ê°•ì˜ 10ì—ì„œ ë‹¤ë£¸**\
    -   **ì´ì¤‘ ì°¨ë¶„ë²•(Difference-in-Differences, DID)** â†’ **ê°•ì˜ì—ì„œëŠ” ë‹¤ë£¨ì§€ ì•Šì§€ë§Œ, ìŠ¬ë¼ì´ë“œ ì œê³µ!**

------------------------------------------------------------------------

## ğŸ” ì¸ê³¼ ê´€ê³„ë¥¼ ì°¾ì•„ê°€ëŠ” ê¸¸

âœ… ***ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ë‹¤ë£°ê¹Œ?*** : ì½ê¸°(Read), ì •ë¦¬(Tidy), ì‹œê°í™”(Visualize)...

ğŸš§ ***ë³€ìˆ˜ê°„ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ ìš”ì•½í• ê¹Œ?*** ...ë‹¨ìˆœ ì„ í˜• íšŒê·€(Simple Linear Regression) ...ê³„ì† í•™ìŠµ

âœ… ì¸ê³¼ ê´€ê³„(Causality)ë€ ë¬´ì—‡ì¸ê°€?

âŒ ì „ì²´ ëª¨ì§‘ë‹¨ì„ ê´€ì¸¡í•˜ì§€ ëª»í•˜ë©´ ì–´ë–»ê²Œ í• ê¹Œ?

âŒ ìš°ë¦¬ì˜ ì—°êµ¬ ê²°ê³¼ê°€ ë‹¨ìˆœí•œ ë¬´ì‘ìœ„(Randomness) ë•Œë¬¸ì¼ ìˆ˜ë„ ìˆì„ê¹Œ?

âŒ ì‹¤ì œë¡œ ì™¸ìƒì„±ì„ ì–´ë–»ê²Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆì„ê¹Œ?

------------------------------------------------------------------------


<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

::: {style="display: flex; justify-content: center; align-items: center; height: 70vh;"}
<h2 style="color: #ff6666; text-align: center; font-family: &#39;Pacifico&#39;, cursive; font-size: 50px;">

THE END!

</h2>
:::



# Appendix

---


## **ì²˜ë¦¬ ì§‘ë‹¨ê³¼ í†µì œ ì§‘ë‹¨ì—ì„œì˜ í‰ê·  ì²˜ì¹˜ íš¨ê³¼** (Average Treatment on the Treated and on the Untreated) {#attandatu}

**ë‹¤ë¥¸ ì¡°ê±´ë¶€(Conditional) í‰ê·  ì²˜ì¹˜ íš¨ê³¼ë„ ì¤‘ìš”í•  ìˆ˜ ìˆìŒ.**  

**ğŸ“Œ ì²˜ë¦¬ ì§‘ë‹¨ì—ì„œì˜ í‰ê·  ì²˜ì¹˜ íš¨ê³¼ (ATT)** (Average Treatment on the Treated, **ATT**)  

$$
\begin{align}
 ATT &= \mathop{\mathbb{E}}(\delta_i | D_i = 1) \\
     &= \mathop{\mathbb{E}}(Y_i^1 - Y_i^0 | D_i = 1) \\
     &= \mathop{\mathbb{E}}(Y_i^1 | D_i = 1) - \mathop{\mathbb{E}}(Y_i^0 | D_i = 1)
\end{align}
$$

  - **ATTëŠ” ì²˜ì¹˜ ê·¸ë£¹(Treatment Group)ì— ì†í•œ ê°œì¸ë“¤ì˜ í‰ê·  ì²˜ì¹˜ íš¨ê³¼ë¥¼ ì¸¡ì •í•¨.**  
  - *ì˜ˆì œ:* ì§ì—… í›ˆë ¨ í”„ë¡œê·¸ë¨(**ì²˜ì¹˜**)ì„ ë°›ì€ ì‚¬ëŒë“¤ì—ê²Œ ë¯¸ì¹˜ëŠ” íš¨ê³¼ (**ì²˜ì¹˜ ê·¸ë£¹** ë‚´ì—ì„œ í‰ê°€).


**ğŸ“Œ í†µì œ ì§‘ë‹¨ì—ì„œì˜ í‰ê·  ì²˜ì¹˜ íš¨ê³¼ (ATU)**  (Average Treatment on the Untreated, **ATU**)  

$$
\begin{align}
 ATU &= \mathop{\mathbb{E}}(\delta_i | D_i = 0) \\
     &= \mathop{\mathbb{E}}(Y_i^1 - Y_i^0 | D_i = 0) \\
     &= \mathop{\mathbb{E}}(Y_i^1 | D_i = 0) - \mathop{\mathbb{E}}(Y_i^0 | D_i = 0)
\end{align}
$$

  - **ATUëŠ” í†µì œ ê·¸ë£¹(Control Group)ì— ì†í•œ ê°œì¸ë“¤ì´ ì²˜ì¹˜ë¥¼ ë°›ì•˜ì„ ê²½ìš°ì˜ í‰ê·  ì²˜ì¹˜ íš¨ê³¼ë¥¼ ì¸¡ì •í•¨.** 
  - *ì˜ˆì œ:* ì‚¬ë¦½í•™êµ(**ì²˜ì¹˜**)ì— ë‹¤ë‹ˆëŠ” ê²ƒì´ ê³µë¦½í•™êµ í•™ìƒ(**í†µì œ ê·¸ë£¹**)ì—ê²Œ ë¯¸ì¹  íš¨ê³¼ë¥¼ ì¶”ì •.


ğŸ“Œ **ì¤‘ìš”:** ëŒ€ë¶€ë¶„ì˜ ê²½ìš°, **ATE â‰  ATT â‰  ATU!**  

ğŸ”™ [ì´ì „ìœ¼ë¡œ ëŒì•„ê°€ê¸°](#ate)

---


## **ë‹¨ìˆœ ë¹„êµ(Naive Comparisons)ì˜ ë¬¸ì œì ** (Problems with Naive Comparisons) {#naive_comp_extended}

**ì²˜ì¹˜ íš¨ê³¼ê°€ ëª¨ë“  ê°œì¸ì—ê²Œ ë™ì¼í•˜ë‹¤ëŠ” ê°€ì •ì„ ì™„í™”í•´ ë³´ì.**  
ìˆ˜ì‹ì„ ì „ê°œí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¡œ **SDO**(Simple Difference in Outcomes)ë¥¼ ë¶„í•´í•  ìˆ˜ ìˆìŒ:

$$
\begin{align}
  SDO &= ATE + \underbrace{\mathop{\mathbb{E}}(Y_i^0 | D_i = 1) - \mathop{\mathbb{E}}(Y_i^0 | D_i = 0)}_\text{Selection bias} \\
  & \quad \quad  \quad \quad + \underbrace{(1-\pi)(ATT - ATU)}_\text{Heterogeneous treatment effect bias}
\end{align}
$$

ì—¬ê¸°ì„œ $1 - \pi$ëŠ” **í†µì œ ê·¸ë£¹(Control Group)ì˜ ë¹„ìœ¨**ì„ ì˜ë¯¸í•¨.  

ğŸ“Œ ìƒˆë¡œìš´ í¸í–¥ ìš”ì†Œ: **ê°œì¸ë³„ ì²˜ì¹˜ íš¨ê³¼ì˜ ì´ì§ˆì„± (Heterogeneity)**
  1ï¸âƒ£ **ì„ íƒ í¸í–¥(Selection Bias):**  
    - ëŒ€í•™ì— ì§„í•™í•˜ëŠ” í•™ìƒë“¤ì€ **ê¸°ë³¸ì ì¸ ì¸ì§€ ëŠ¥ë ¥ì´ ë” ë†’ì„ ê°€ëŠ¥ì„±**ì´ ë†’ìŒ (ëŒ€í•™ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´).  
  2ï¸âƒ£ **ì´ì§ˆì  ì²˜ì¹˜ íš¨ê³¼ í¸í–¥(Heterogeneous Treatment Effect Bias):**  
    - ëŒ€í•™ì— ê°€ëŠ” í•™ìƒë“¤ì´ **ëŒ€í•™ì—ì„œ ë” ë§ì€ í•™ìŠµ íš¨ê³¼ë¥¼ ì–»ì„ ê°€ëŠ¥ì„±**ì´ ë†’ìŒ (ë” ë™ê¸° ë¶€ì—¬ëœ í•™ìƒë“¤ì¼ ìˆ˜ ìˆìŒ).  

ğŸ”™ [ì´ì „ìœ¼ë¡œ ëŒì•„ê°€ê¸°](#naive_comp)



